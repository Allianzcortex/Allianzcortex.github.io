<!DOCTYPE html>

<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Allianzcortex-Blog</title>
  <meta name="description" content="Promised Land">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Allianzcortex-Blog" href="http://localhost:4000/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="hzcortex">
  <meta name="twitter:title" content="Allianzcortex-Blog">
  <meta name="twitter:description" content="Promised Land">
  
    <meta name="twitter:creator" content="hzcortex">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Allianzcortex-Blog</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="/projects/">Projects</a>
      
        
        <a class="page-link" href="/about/">About</a>
      
        
        <a class="page-link" href="/board/">board</a>
      
        
        <a class="page-link" href="/feed.xml">RSS</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="home">

  

  

  <ul class="post-list">
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/04/22/How-I-Finish-My-Database-Project/">How I Finish My Database Project</a>
          </h1>

          <p class="post-meta">Apr 22, 2019</p>
        </header>

        <div class="post-content">
          

        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/02/27/Cache-Design-Pattern/">Cache Design Pattern</a>
          </h1>

          <p class="post-meta">Feb 27, 2019</p>
        </header>

        <div class="post-content">
          

        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/02/25/Database-Normalization-Explanation/">Database Normalization Explanation</a>
          </h1>

          <p class="post-meta">Feb 25, 2019</p>
        </header>

        <div class="post-content">
          

        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/02/22/Spring-Security-Usage-Examples/">Spring Security Usage Examples</a>
          </h1>

          <p class="post-meta">Feb 22, 2019</p>
        </header>

        <div class="post-content">
          

        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/02/11/Using-Storm-Or-JStorm-Kafka-Build-Online-Porcessing-System/">Using Storm Or Jstorm Kafka Build Online Porcessing System</a>
          </h1>

          <p class="post-meta">Feb 11, 2019</p>
        </header>

        <div class="post-content">
          

        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/02/10/How-To-Design-A-Follower-And-Followee/">How To Design A Follower And Followee</a>
          </h1>

          <p class="post-meta">Feb 10, 2019</p>
        </header>

        <div class="post-content">
          
<p>这里主要说的是如何实现一个 follow 的表</p>

<p>followee 的定义参见：https://en.oxforddictionaries.com/definition/followee</p>

<p>具体思路分为两种：</p>

<ol>
  <li>用关系型数据库 MySQL 设计来实现</li>
  <li>用 NoSQL 如 redis 设计来实现</li>
</ol>

<p>有的人会担心 redis 的稳定性，因为通常 redis 的作用是缓存，分担查询压力，对于准确性要求并没有那么高。对于
这种，我们需要主要到关注行为和【钱的数额】这类数据不一样，前者是允许一定量的误差。
就算是用户点击了关注行为发现没有关注，过其中一个非常重要的特点是</p>

        </div>
        
          <p class="post-continue">
            <a href="/2019/02/10/How-To-Design-A-Follower-And-Followee/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/02/10/FAQ-For-Java-And-Spring/">Faq For Java And Spring</a>
          </h1>

          <p class="post-meta">Feb 10, 2019</p>
        </header>

        <div class="post-content">
          

        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/01/28/Some-Interesting-SQL-Queries/">Some Interesting Sql Queries</a>
          </h1>

          <p class="post-meta">Jan 28, 2019</p>
        </header>

        <div class="post-content">
          
<p>Grouping sites/window function</p>


        </div>
        
          <p class="post-continue">
            <a href="/2019/01/28/Some-Interesting-SQL-Queries/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/01/27/Improve-Java-Performace-20-times-discussing-from-assignment/">Improve Java Project Performace 20 times ！</a>
          </h1>

          <p class="post-meta">Jan 27, 2019 • 
  
  

</p>
        </header>

        <div class="post-content">
          <!-- more -->
<p>Recently, I completed the first Assignment of Business Development. The teacher has already publish the course requirements to his <a href="https://github.com/DanielPenny/MCDA5510_Assignments/blob/master/Assignment%201.pdf">github</a>.
To sum it up, <strong>you need to read all the CSV files in a folder and write the contents of the file to the new same CSV file.</strong></p>

<p>I will not discuss the code itself much as required, mainly talk about the idea.</p>

<p>In addition to the trivial requirements of using log to record execution time and valid rows, this project can be divided into three parts:</p>

<ol>
  <li>Read the absolute path of all files in a folder</li>
  <li>Read the contents of a CSV file</li>
  <li>Write to the CSV file</li>
</ol>

<p>Performance improvement itself mainly can be done from two ways:</p>

<hr />

<h4 id="firstuse-apaches-csvprinter">First:Use Apache’s CSVPrinter</h4>

<p>If we open the CSV file with any text editor (vscode/sublime/vim), we can see that its’ difference from the .txt file is mainly  that it 
Use <code class="highlighter-rouge">,</code> to separate objects as columns, so I used this idea to write to the CSV file at the beginning:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">BufferedWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">Writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="n">OutputStreamWriter</span><span class="o">(</span>
        <span class="n">New</span> <span class="nf">FileOutputStream</span><span class="o">(</span><span class="s">"result.csv"</span><span class="o">),</span> <span class="s">"utf-8"</span><span class="o">));</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
    <span class="o">}</span>
<span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
<span class="n">For</span> <span class="o">(</span><span class="n">String</span> <span class="n">item</span> <span class="o">:</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">item</span><span class="o">);</span>
    <span class="n">Sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">Sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
    <span class="n">Writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span></code></pre></figure>

<p>But as we said, CSV is a very common file format, so there must be a library optimized for this,  and CSVPrinter in the apache common CSV library is exactly what we need:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Import</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">csv</span><span class="o">.</span><span class="na">CSVPrinter</span><span class="o">;</span>

<span class="n">CSVPrinter</span> <span class="n">writer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="c1">//initialize FileWriter object
</span>
    <span class="n">FileWriter</span> <span class="n">fileWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileWriter</span><span class="o">(</span><span class="n">config</span><span class="o">.</span><span class="na">ResulF</span>
    <span class="n">CSVFormat</span> <span class="n">csvFileFormat</span> <span class="o">=</span> <span class="n">CSVFormat</span><span class="o">.</span><span class="na">DEFAULT</span><span class="o">.</span><span class="na">withRecordSeparator</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
    <span class="n">Writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CSVPrinter</span><span class="o">(</span><span class="n">fileWriter</span><span class="o">,</span> <span class="n">csvFileFormat</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

<span class="n">printer</span><span class="o">.</span><span class="na">printRecord</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
<span class="n">validRows</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span></code></pre></figure>

<hr />

<h4 id="secondchange-time-processing-logic">Second:Change Time Processing Logic</h4>
<p>The second optimization part is mainly for the bonus point mentioned in the Assignment. Simply put, there is a string such as <code class="highlighter-rouge">prefix2019/01/27suffix</code> which needs to be converted to <code class="highlighter-rouge">2019/01/27</code> format that conforms to <code class="highlighter-rouge">YYYY/MM/DD</code>.</p>

<p>In the beginning, my approach was to split string to get the value of year/month/date and then add leading zero to satisfy  conversion such as “1”-&gt;”01”, “12”-&gt;”12” .So naturally my idea is:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Month = String.format("%02d", Integer.parseInt(month));
</code></pre>
</div>

<p>This practice also works but it takes too long. Hundreds of files contain a total of 280,000 lines, and  approach took nearly 800,000 ms. My optimization method is quite similar to an optimization technique in ACM/ICPC:</p>

<p>Because there is only a maximum of 12 months in a total, and only 31 days in a month, as long as the conversion relationship is listed, we can use HashMap to achieve O(1) time complexity.</p>

<p><img src="/images/playtable.PNG" alt="playtable.PNG" /></p>

<p>The increase in efficiency is obvious, and the time has dropped to 4000ms. From 80000 to 4000, the program has increased incredibly 20 times!</p>

<hr />

<p>Last but not the least, there is still one way to solve it .If you search in Google: <strong>java format date string to another format</strong>, the number one link gives us the light:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>SimpleDateFormat format1 = new SimpleDateFormat("yyyy-MM-dd");
SimpleDateFormat format2 = new SimpleDateFormat("dd-MM-yyyy");
Date date = format1.parse("2013-02-21");
System.out.println(format2.format(date));
</code></pre>
</div>

<p>But the essence of this requirement is to complete the conversion of string-&gt;string. The circle of the method above is string-&gt;date-&gt;date-&gt;string. too tedious, isn’t it ?, so this is only a theoretical possibility, I have not adopted it.</p>

        </div>
        
          <p class="post-continue">
            <a href="/2019/01/27/Improve-Java-Performace-20-times-discussing-from-assignment/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/01/19/high-performance-mysql/">High Performance Mysql</a>
          </h1>

          <p class="post-meta">Jan 19, 2019</p>
        </header>

        <div class="post-content">
          

        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/01/14/High-Performance-MySQL-Part-I/">High Performance Mysql Part I</a>
          </h1>

          <p class="post-meta">Jan 14, 2019</p>
        </header>

        <div class="post-content">
          

        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2019/01/08/Find-A-Bug-In-Spring-Boot-Documentation/">Find A Bug In Spring Boot Documentation</a>
          </h1>

          <p class="post-meta">Jan 8, 2019</p>
        </header>

        <div class="post-content">
          

        </div>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2018/12/17/JWT-Principle-Authorization/">JWT Authorization Principle and Usage Example</a>
          </h1>

          <p class="post-meta">Dec 17, 2018 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>JWT,Session and Cookie.</p>

<!-- more -->

<p><a href="/../translation/">这篇文章对应的中文版</a></p>

<p>JWT 是一种很重要的认证机制。具体可以在官方文档里看到 https://jwt.io/introduction/。
这篇不会太多讲述理论细节，而是通过实践来说明怎样具体使用。</p>


        </div>
        
          <p class="post-continue">
            <a href="/2018/12/17/JWT-Principle-Authorization/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2018/11/11/Talking-About-Microservice/">Talking About Microservice</a>
          </h1>

          <p class="post-meta">Nov 11, 2018 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>Talking about the concept of Microservice and actual implementation</p>

<!-- more -->

<p>Always we have two choices about microservice: <a href="http://spring.io/projects/spring-cloud">spring-cloud</a> opensourced by spring community and <a href="https://dubbo.incubator.apache.org/en-us/">dubbo</a> which is developed by alibaba and has been donated to Apache Foundation.Because of wide usage of SSM Framework(Spring Boot + Spring MVC(Rest) + Mybatis),I will mainly choose spring <strong>cloud</strong> as main research object.</p>

<p>During the progress of learning MapReduce,it is beneficial to find an article talking about the usage of MapReduce in practical. So I decided to translate it into Chinese and share it with others.</p>

<p>You can find the original novel in <a href="http://stevekrenzel.com/finding-friends-with-mapreduce">finding-friends-with-mapreduce</a>.</p>

<p><a href="/../translation/2016-02-22-Hadoop-Mapreduce-Tutorial.html">点击查看对应译文</a></p>


        </div>
        
          <p class="post-continue">
            <a href="/2018/11/11/Talking-About-Microservice/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2017/05/22/Python-Import-Mechanism/">The Import Mechanism Of Python And Two Related Problems</a>
          </h1>

          <p class="post-meta">May 22, 2017 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>How to solve <code class="highlighter-rouge">No module named</code> and <code class="highlighter-rouge">Attempted relative import</code> ?</p>

<!-- more -->

<p><a href="/../translation/2017-05-22-Python-Import-Mechanism.html">这篇文章对应的中文版</a></p>

<h3 id="no-module-named">No module named</h3>

<p>This problem ever happened when executed with the command line, but the application can be executed smoothly with the Pycharm run button. The error is also very simple to debug, just check the <strong>show command line afterwards</strong> in the edit configuration item of Pycharm, and then execute the <code class="highlighter-rouge">import sys; sys.path</code> command. Compare the options in the command line,you will find the former has Added a module for <code class="highlighter-rouge">/home/hzcortex/projects...</code>. In other words, Python does not add the directory where the script executes the command to sys.path.</p>

<hr />

<p>The solution is to add the following code in the directory where error happened:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))))</span></code></pre></figure>

<h3 id="attempted-relative-import-in-non--package">Attempted relative import in non  package</h3>

<p>There are two types of issues to discuss:</p>

<p>1 A circular reference does occur. A wants to reference B, B wants to reference C, and C also refers to a function in B. The normal solution at this point is to modify the reference order of the C files and put the <code class="highlighter-rouge">import</code> statement before the statement that needs to use the reference object (see 《Fluent Python》). I recently encountered this problem when developing [FBRank] (https://github.com/Allianzcortex/FBRank). The project structure is like :</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="err">└──</span> <span class="n">utils</span>
    <span class="err">├──</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">py</span>
    <span class="err">├──</span> <span class="n">__init__</span><span class="o">.</span><span class="n">py</span>

<span class="c"># utils.py
</span>
 <span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">NotSupprotedYetException</span>

<span class="k">def</span> <span class="nf">check_before</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s">'name'</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">raise</span> <span class="n">NotSupprotedYetException</span>
    <span class="o">...</span>

<span class="c"># exceptions.py
</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">github_url</span><span class="p">,</span> <span class="n">connect_url</span>

<span class="k">class</span> <span class="nc">NotSupprotedYetException</span><span class="p">(</span><span class="n">FBRankException</span><span class="p">):</span>
    <span class="s">"""still not supprt
    """</span></code></pre></figure>

<p>Then there was such an error when executing the program:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>File "/home/hzcortex/FBRank/FBRank/parse/League.py", line 13, in &lt;module&gt;
    from FBRank.utils.exceptions import IllegalArgumentException, NotSupprotedYetException
  File "/home/hzcortex/FBRank/FBRank/utils/exceptions.py", line 2, in &lt;module&gt;
    from .utils import github_url, connect_url
  File "/home/hzcortex/FBRank/FBRank/utils/utils.py", line 5, in &lt;module&gt;
    from .exceptions import NotSupprotedYetException
ImportError: cannot import name 'NotSupprotedYetException'

</code></pre>
</div>

<p>Looking at the order of the calls from top to bottom, the <code class="highlighter-rouge">github_url, connect_url</code> variables are called from .utils.py in /exceptions.py, and <strong>NotSupprotedYetException</strong> is called from /exceptions.py when calling .utils.py. This will cycle through each other and will never solve the <strong>import issue</strong>. The solution is to load it only when you need to use the function:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># utils.py
</span>

<span class="k">def</span> <span class="nf">check_before</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s">'name'</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">NotSupprotedYetException</span>
    <span class="c"># ......</span></code></pre></figure>

<p>Because Python’s reference mechanism does not reimport previously imported packages (use <code class="highlighter-rouge">imp.reaload()</code> if needed), so don’t worry about performance problem.</p>

<ol>
  <li>If there is really no circular reference, problem maybe is mainly because:</li>
</ol>

<p>Take an example of a program push data from Kafka to ES that was previously written. The structure of the whole program is as follows</p>

<p><img src="/images/RLTES-2.png" alt="RLTES-Project" /></p>

<p>In the main program <code class="highlighter-rouge">RealtimeLogToES.py</code> there are the following references:</p>

<p><img src="/images/RLTES-1.png" alt="RLTES-import" /></p>

<p>Go to the RLTES directory and execute <code class="highlighter-rouge">python RealtimeLogToES.py</code> directly in this case, then the above circular reference error will be reported.</p>

<p>There are two solutions:</p>

<p>1 Change <code class="highlighter-rouge">from .config import</code> to the same absolute reference as below, <code class="highlighter-rouge">from RLTES.config import</code></p>

<p>2 Do not modify the code, return to the previous directory, <code class="highlighter-rouge">cd ..</code>, and then execute <code class="highlighter-rouge">python -m RLTES.RealtimeLogToES</code></p>

<p>When Python is relatively introduced, the basis for the judgment is the <code class="highlighter-rouge">__name__</code> attribute of the current file. When you execute a file, the original <code class="highlighter-rouge">__name__</code> attribute of the file is replaced by the fixed <code class="highlighter-rouge">'__main__'</code>, so the relative introduction does not work, while the absolute introduction is fine. After adding -m to the command line, tell the Python interpreter to run this file as a script.</p>

<h3 id="why-the-problem-happened">Why the problem happened</h3>

<p>If there is sufficient time,I will try to explain it. Now you can read <a href="https://www.python.org/dev/peps/pep-0302/">PEP302</a> to hava a straightforward impression.</p>

<h3 id="how-we-do-properly">How We Do Properly</h3>

<p>The recommendation in PEP8 is to always use absolute references, but just like the <code class="highlighter-rouge">annoying double underscore</code>, there are a lot of people who prefer to use relative import.</p>

<p>The key is to Keep the team consistent. As for personal development, I prefer to use <code class="highlighter-rouge">.import</code> for single layer and absolute reference for others.</p>

<p>In the book “Two Scopes Of Django” <strong>, it is stipulated that the use of the **implicit import</strong> statement such as <code class="highlighter-rouge">from A import a</code> is forbidden, but considering that many times the script will not be specific to a large project but to create a directory on the server to complete a specific function or solve a temporary problem(don’t need to maintain), if this is convenient for debugging and deployment,it can also be a good choice,done is better than perfect after all.</p>

<h3 id="the-role-of-__init__py">The role of <code class="highlighter-rouge">__init__.py</code></h3>

<p>The most important role of <code class="highlighter-rouge">__init__.py</code> is to mark the folder containing the <code class="highlighter-rouge">__init__.py</code> directory as a package to complete the corresponding import.</p>

<p>In most cases, there is no need to write anything in <code class="highlighter-rouge">__init__.py</code>. If you must write it, it basically has the following three functions:</p>

<ul>
  <li>
    <p>Write <code class="highlighter-rouge">__author__</code> and other related information</p>
  </li>
  <li>
    <p>Write a <code class="highlighter-rouge">__all__</code> configuration that exactly defines what will be introduced when <code class="highlighter-rouge">from x import *</code></p>
  </li>
  <li>
    <p>If the first two are irrelevant, then the last one is much more important, and the importing method can be simplified to control the stability of the API.</p>
  </li>
</ul>

<p>Let me still take the example of [FBRank] (github.com/Allianzcortex/FBRank). Although you see that the command line tool is only supported in the README, it also provides the ability to import it in the code. for example:</p>

<p>If you need to assign the corresponding file if you need to  import an exception</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"> <span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">FBRank.utils.exceptions</span> <span class="kn">import</span> <span class="n">IllegalArgumentException</span></code></pre></figure>

<p>But if you want to import a class, you only need to identify the corresponding package, which is very convenient for subsequent development.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">FBRank.object</span> <span class="kn">import</span> <span class="n">Club</span></code></pre></figure>

<p>The key it  the following code in <code class="highlighter-rouge">__init__.py</code> of FBRank/object folder.Import something from package is equal to import something from file under this package.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">  <span class="kn">from</span> <span class="nn">.League</span> <span class="kn">import</span> <span class="n">League</span>
  <span class="kn">from</span> <span class="nn">.Club</span> <span class="kn">import</span> <span class="n">Club</span>
  <span class="kn">from</span> <span class="nn">.Player</span> <span class="kn">import</span> <span class="n">Player</span></code></pre></figure>


        </div>
        
          <p class="post-continue">
            <a href="/2017/05/22/Python-Import-Mechanism/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2017/05/21/Scala-Test-Junit-Sbt-Problem/">Run ScalaTest And JUnit On TravisCI And Some Scala99 Solutions</a>
          </h1>

          <p class="post-meta">May 21, 2017 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>After integrating <code class="highlighter-rouge">ScalaTest</code> with <code class="highlighter-rouge">JUnit</code>, execute <code class="highlighter-rouge">sbt test</code> prompt <code class="highlighter-rouge">no tests are executed</code>.How to solve it ?</p>

<!-- more -->
<p><a href="/../translation/2017-05-21-Scala-Test-Junit-Sbt-Problem.html">这篇文章对应的中文版</a></p>

<h3 id="background">BackGround</h3>

<p>I’ve recently tried to write a                            <a href="https://github.com/Allianzcortex/Scala-LeetCode">collection</a> that solves LeetCode with Scala. ScalaTest is generally recommended for unit testing in Scala, and most Scala users have a Java background , so ScalaTest can also be integrated with JUnit, see 
<a href="http://www.scalatest.org/getting_started_with_junit_4_in_scala">link</a> for a further understanding</p>

<h3 id="what-is-the-problem">What Is The Problem?</h3>

<p>At first writing test code like this ：</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.scalatest.</span><span class="o">{</span><span class="nc">BeforeAndAfterEach</span><span class="o">,</span> <span class="nc">FunSpec</span><span class="o">,</span> <span class="nc">FunSuite</span><span class="o">}</span>

<span class="k">class</span> <span class="nc">FileUtilTest</span> <span class="k">extends</span> <span class="nc">FunSpec</span> <span class="k">with</span> <span class="nc">BeforeAndAfterEach</span> <span class="o">{</span>
    <span class="n">it</span><span class="o">(</span><span class="s">"should be equal"</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">assert</span><span class="o">(</span><span class="n">xx</span><span class="o">.</span><span class="n">max</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p><strong>build.sbt</strong> is as follows：</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"org.scalatest"</span> <span class="o">%</span> <span class="s">"scalatest_2.12"</span> <span class="o">%</span> <span class="s">"3.0.1"</span> <span class="o">%</span> <span class="s">"test"</span>
<span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"junit"</span> <span class="o">%</span> <span class="s">"junit"</span> <span class="o">%</span> <span class="s">"4.8.1"</span> <span class="o">%</span> <span class="s">"test"</span></code></pre></figure>

<p>Above is the most standard code for <code class="highlighter-rouge">Scala-Test</code></p>

<p>There is no problem in running test cases with <a href="https://www.jetbrains.com/idea/">Intellij IDEA</a> and <code class="highlighter-rouge">sbt test</code> at the same time.</p>

<p>If you want to import Junit,then it will be：</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.junit.Assert._</span>
<span class="k">import</span> <span class="nn">org.scalatest.junit.</span><span class="o">{</span><span class="nc">AssertionsForJUnit</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">com.leetcode.util.</span><span class="o">{</span><span class="nc">FileUtil</span> <span class="k">=&gt;</span> <span class="n">xx</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.junit.Test</span>

<span class="k">class</span> <span class="nc">FileUtilTest</span> <span class="k">extends</span>  <span class="nc">AssertionsForJUnit</span> <span class="o">{</span>
    <span class="nd">@Test</span> <span class="k">def</span> <span class="n">test_max</span><span class="o">()={</span>
     <span class="n">assertTrue</span><span class="o">(</span><span class="n">xx</span><span class="o">.</span><span class="n">max</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">)==</span><span class="mi">2</span><span class="o">)</span>
   <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>Currently we can use Intellij IDEA to run unit tests, but if you use <code class="highlighter-rouge">sbt test</code> to run it in console, it will hint <code class="highlighter-rouge">no tests are executed</code>. If you want to have a continuous development,then manybe you know some famous tools such as <a href="https://travis-ci.org/">TravisCI</a> which cooperates well with github.I write a <code class="highlighter-rouge">.travis.yml</code> <a href="https://github.com/Infra-Intern/Scala-LeetCode/blob/master/.travis.yml">file</a>.Now ScalaTest and JUnit can’t work on Linux Platform.</p>

<h3 id="solutions">Solutions</h3>

<p>Based on this question <a href="http://stackoverflow.com/questions/28174243/run-junit-tests-with-sbt">run-junit-tests-with-sbt</a> you need to add the following code on original <code class="highlighter-rouge">build.sbt</code>：</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">crossPaths</span> <span class="o">:=</span> <span class="kc">false</span>
<span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"com.novocode"</span> <span class="o">%</span> <span class="s">"junit-interface"</span> <span class="o">%</span> <span class="s">"0.11"</span> <span class="o">%</span> <span class="nc">Test</span>
<span class="n">testOptions</span> <span class="o">+=</span> <span class="nc">Tests</span><span class="o">.</span><span class="nc">Argument</span><span class="o">(</span><span class="nc">TestFrameworks</span><span class="o">.</span><span class="nc">JUnit</span><span class="o">,</span> <span class="s">"-q"</span><span class="o">,</span> <span class="s">"-v"</span><span class="o">)</span></code></pre></figure>

<p>The reason for this problem is that Scala and Java finally compiled two different sets of bytecodes. Although in most cases it is compatible,but you also need to mind the corner case.</p>

<p>BTW,Looked at it, the test cases in Spark are all using the pure ScalaTest framework, without using JUnit.</p>

<hr />

<p>Exercises for 《Scala For Impatient》 and some notes for Scala 99</p>

<p>Scala’s syntax is as complex as C++…</p>

<p>The author of <a href="http://scalacookbook.com/">《Scala CookBook》</a> evaluates the nature of Java’s syntax as <code class="highlighter-rouge">Verbose yet obvious</code>. It is because of the obvious characteristics that it can lead in the industrial development,play a dominant role in <code class="highlighter-rouge">Web development/Android/big data field</code>. It is also because of the verbose characteristics and boilerplate code that people can feel really tired when writing in Java,especailly compared with Python.</p>

<p>Scala based on the JVM platform is a nice improvement of Java. Scala’s official website promotes <strong>OO meets FP</strong>, which combines the benefits of object-oriented and functional programming. As many people have said, there is no need to fully understand Scala’s grammar and use it later.</p>

<p>Scala is mainly divided into two aspects when learning:</p>

<ul>
  <li>
    <p>A series of Immutable and Mutable objects such as <strong>Array/List/Seq</strong> , corresponding to <strong>take/filter/map/flatMap/reduce/head/tail/init</strong> method, etc.</p>
  </li>
  <li>
    <p>new OO related content such as <strong>class/case</strong> <strong>class/object/trait</strong></p>
  </li>
</ul>

<p>Reaching <code class="highlighter-rouge">A3/L2</code> level will meet the daily needs.</p>

<p>Recently I have done some of the problems in <a href="http://aperiodic.net/phil/scala/s-99/">Scala99</a>, trying to do some excerpts, some of which have different methods from the original ones.</p>

<ul>
  <li>Question 17:</li>
</ul>

<p>** Requirements**: Divide a List into two parts</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">ls.splitAt(n)</code> and <code class="highlighter-rouge">directly return (ls.take(n), ls.drop(n))</code> methods are available on the website</p>
  </li>
  <li>
    <p>My own implementation:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">def</span> <span class="n">splitToTwoPart</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">ls</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">zipWithIndex</span><span class="o">.</span><span class="n">partition</span><span class="o">(</span><span class="n">elem</span> <span class="k">=&gt;</span> <span class="n">elem</span><span class="o">.</span><span class="n">_2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="o">)</span>
    <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">_1</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">_1</span><span class="o">),</span> <span class="n">s</span><span class="o">.</span><span class="n">_2</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">_1</span><span class="o">))</span>
<span class="o">}</span></code></pre></figure>

<p>And I implement a small demo about <strong>class</strong> and <strong>traits</strong>:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">collection.mutable.ArrayBuffer</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Record</span><span class="o">(</span><span class="k">var</span> <span class="n">event</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">var</span> <span class="n">money</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="k">this</span><span class="o">()</span> <span class="k">=</span> <span class="k">this</span><span class="o">(</span><span class="s">"sample"</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">}</span>


<span class="k">trait</span> <span class="nc">People</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span>
  <span class="k">var</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span>
  <span class="k">var</span> <span class="n">activity</span><span class="k">:</span> <span class="kt">ArrayBuffer</span><span class="o">[</span><span class="kt">Record</span><span class="o">]</span>

  <span class="k">def</span> <span class="n">addRecord</span><span class="o">(</span><span class="n">newEvent</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">newMoney</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">removeRecord</span><span class="o">(</span><span class="n">deleteName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">deleteMoney</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">getAllCost</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">User</span><span class="o">(</span><span class="n">userName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">userAge</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">People</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">name</span> <span class="k">=</span> <span class="n">userName</span>
  <span class="k">var</span> <span class="n">age</span> <span class="k">=</span> <span class="n">userAge</span>
  <span class="k">var</span> <span class="n">activity</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ArrayBuffer</span><span class="o">[</span><span class="kt">Record</span><span class="o">]</span>

  <span class="k">def</span> <span class="n">addRecord</span><span class="o">(</span><span class="n">newEvent</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">newMoney</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="n">activity</span> <span class="o">+=</span> <span class="nc">Record</span><span class="o">(</span><span class="n">newEvent</span><span class="o">,</span> <span class="n">newMoney</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">removeRecord</span><span class="o">(</span><span class="n">deleteName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">deleteMoney</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">targetRecord</span> <span class="k">=</span> <span class="nc">Record</span><span class="o">(</span><span class="n">deleteName</span><span class="o">,</span> <span class="n">deleteMoney</span><span class="o">)</span>
    <span class="cm">/*if this.activity.exists(_ == targetRecord) this.activity -= targetRecord*/</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">getAllCost</span><span class="o">()</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="n">activity</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">x</span><span class="k">=&gt;</span><span class="n">println</span><span class="o">(</span><span class="n">x</span><span class="o">.</span><span class="n">money</span><span class="o">))</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"money "</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="n">activity</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">money</span><span class="o">).</span><span class="n">reduceLeft</span><span class="o">(</span><span class="k">_</span><span class="o">+</span><span class="k">_</span><span class="o">))</span>
    <span class="k">this</span><span class="o">.</span><span class="n">activity</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">money</span><span class="o">).</span><span class="n">reduceLeft</span><span class="o">(</span><span class="k">_</span><span class="o">+</span><span class="k">_</span><span class="o">)</span>
    <span class="c1">// reduce((x,y)=&gt;x.money+y.money)) is wrong,there will be confilicts between Record and Int
</span>  <span class="o">}</span>

  <span class="k">def</span> <span class="n">getActivity</span><span class="o">()</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Record</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="n">activity</span><span class="o">.</span><span class="n">toList</span>
  <span class="o">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span> <span class="k">=</span> <span class="n">s</span><span class="s">"$name $age"</span>

<span class="o">}</span>

<span class="k">object</span> <span class="nc">testApplication</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">u</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="s">"Tom"</span><span class="o">,</span> <span class="mi">18</span><span class="o">)</span>
  <span class="n">u</span><span class="o">.</span><span class="n">addRecord</span><span class="o">(</span><span class="s">"Buy Clothes"</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
  <span class="n">println</span><span class="o">(</span><span class="n">u</span><span class="o">)</span>
  <span class="n">println</span><span class="o">(</span><span class="s">"User activity is  "</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">getActivity</span><span class="o">())</span>
  <span class="n">println</span><span class="o">(</span><span class="n">u</span><span class="o">.</span><span class="n">activity</span><span class="o">.</span><span class="n">toList</span><span class="o">)</span>
  <span class="n">println</span><span class="o">(</span><span class="n">u</span><span class="o">.</span><span class="n">getActivity</span><span class="o">())</span>
  <span class="n">println</span><span class="o">(</span><span class="n">u</span><span class="o">.</span><span class="n">getAllCost</span><span class="o">())</span>
<span class="o">}</span></code></pre></figure>


        </div>
        
          <p class="post-continue">
            <a href="/2017/05/21/Scala-Test-Junit-Sbt-Problem/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2017/04/08/Some-Interesting-Logical-Problem/">Some Interesting Logical Questions</a>
          </h1>

          <p class="post-meta">Apr 8, 2017 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>This novel talks about logical questions</p>

<!-- more -->
<p><a href="/../translation/2017-04-08-Some-Interesting-Logical-Problem.html">这篇文章对应的中文版</a></p>

<ol>
  <li></li>
</ol>

<p>The first problem is to generate a random number based on an existing random number, to ensure that the probability of generating 0 and 1 is equal.</p>

<p>The idea is also very straightforward.</p>

<p>writing a program to verify it:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span> <span class="c"># compatible with Py2
</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>


<span class="k">def</span> <span class="nf">rand</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mf">0.3</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="mi">10</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">new_rand</span><span class="p">():</span>
    <span class="n">_prev</span><span class="p">,</span> <span class="n">_next</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">_prev</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">_next</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">if</span><span class="p">(</span><span class="n">_prev</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">_next</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="n">_prev</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span>
        <span class="n">_next</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">check</span><span class="p">():</span>
    <span class="n">sum_zero</span><span class="p">,</span> <span class="n">sum_one</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">gen_num</span> <span class="o">=</span> <span class="n">new_rand</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span><span class="n">gen_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">sum_zero</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sum_one</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"rate is {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sum_one</span> <span class="o">/</span> <span class="n">sum_zero</span><span class="p">))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">check</span><span class="p">()</span>  <span class="c"># 3 sample results: 1.00320512821,1.01938610662,0.982160555005</span></code></pre></figure>

<p>Exactly!</p>

        </div>
        
          <p class="post-continue">
            <a href="/2017/04/08/Some-Interesting-Logical-Problem/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2016/12/15/urldecode-20-space/">A Problem about urlencode,space and 20%</a>
          </h1>

          <p class="post-meta">Dec 15, 2016 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>So when url is encoded/decoded, when to use + and when to use %20?
<!-- more --></p>

<p><a href="/../translation/2016-12-15-urldecode-20-space.html">这篇文章对应的中文版</a></p>

<hr />

<h4 id="background">Background</h4>

<p>In short, this is the case. The mobile application logs of company is collected by Nginx.
Encode with <code class="highlighter-rouge">urlencode</code>. tricky method is to us <code class="highlighter-rouge">tail -F | grep ***</code> to find the target line and then parse it with pratical tools, but recently we have to deal with the logs, so there must be one way to do it automatically. gland to find <a href="http://stackoverflow.com/questions/28431359/how-to-decode-a-url-encoded-string-in-python">method</a> on <strong>StackOverFlow</strong>, so directly import <code class="highlighter-rouge">urllib. Unquote</code> to the code .</p>

<h4 id="development">Development</h4>

<p>But soon something wrong happened, if the time format given is <code class="highlighter-rouge">2016-12-15 12:02:22</code>, the result after processing is formatted as
<code class="highlighter-rouge">2016-12-15+12:02:22</code>. It’s impossible to sort by the time of the recent occurrence, even the most basic search functions will be a big problem,let alone further processing.</p>

<h4 id="what-happened">What Happened</h4>

<p>There is still <a href="http://stackoverflow.com/questions/1634271/url-encoding-the-space-character-or-20">discussion</a> about this problem on SO，and quote the wikipedia：</p>

<blockquote>
  <p>When data that has been entered into HTML forms is submitted, the form field names and values are encoded and sent to the server in an HTTP request message using method GET or POST, or, historically, via email.[2] The encoding used by default is based on an early version of the general URI percent-encoding rules,[3] with a number of modifications such as newline normalization and replacing spaces with + instead of %20. The media type of data encoded this way is application/x-www-form-urlencoded, and it is currently defined (still in a very outdated manner) in the HTML and XForms specifications. In addition, the CGI specification contains rules for how web servers decode data of this type and make it available to applications.
When HTML form data is sent in an HTTP GET request, it is included in the query component of the request URI using the same syntax described above. When sent in an HTTP POST request or via email, the data is placed in the body of the message, and application/x-www-form-urlencoded is included in the message’s Content-Type header.</p>
</blockquote>

<p>The reason for this is that the URL encoding is divided into two parts: the old-fashioned <strong>application/x-www-form-url encoded spaces</strong> are represented as + and + is represented as <strong>%2B</strong>. For example, search for “Python urlencode+20” in Google, and the query url is <code class="highlighter-rouge">https://www.google.com/search?q=Python+urlencode%2B20</code></p>

<p>As for the HTTP URLs of modern urls, spaces are encoded as <strong>%20</strong> and + is not encoded.</p>

<p>In the given log, the space is still passed as “+”, and unquote() is decoded in a modern way, so the result is different. The solution is to use the <code class="highlighter-rouge">raw_data.replace('+', '%20')</code> to convert the space back before decoding (because the log contains no + in the content, so this will not affect the expressiveness of the log).</p>

<p>For various correspondences in urlencode encoding, you can refer to this <a href="http://www.degraeve.com/reference/urlencoding.php">Link</a>.</p>

        </div>
        
          <p class="post-continue">
            <a href="/2016/12/15/urldecode-20-space/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2016/09/08/Data-Visualize-With-Flask-And-Highcharts/">Data Visualizations With Flask and Highcharts</a>
          </h1>

          <p class="post-meta">Sep 8, 2016 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>A data visualization using the back-end Flask and front-end Highcharts</p>

<p><a href="/../translation/2016-09-08-Data-Visualize-With-Flask-And-Highcharts.html">这篇文章对应的中文版</a></p>

<!-- more -->

<h4 id="what-happened">What Happened</h4>

<p>Our company uses Alibaba’s open source <code class="highlighter-rouge">zeus</code> and combines scripts to build a schedule system. There was a phenomenon of sudden collapse of the job in the evening (the early warning SMS burst), and the data could only be rewashed during the day. After research, it is found that the task is way too intensive in a certain period of time and excessive parallel pressure is the cause. The time of the <code class="highlighter-rouge">ods/mds/ads</code> table needs to be reasonably distributed. However, the zeus system itself does not provide the function of the query scheduling task, so it is necessary to implement the visualization of a task distribution.</p>

<h4 id="flask-backend-framework">Flask Backend Framework</h4>

<p>Although usually I’m used to use <code class="highlighter-rouge">Django</code>, but it is too heavy as a <code class="highlighter-rouge">Full-Stack Framework</code>,the registration and login functions inside will not be used. So I switch to Flask:query from MySQL in real time, convert the result with the built-in <code class="highlighter-rouge">jsonify</code> and return it to the front-end page.</p>

<p>Zeus’s scheduling time format is similar to <code class="highlighter-rouge">crontab</code>, so in order to generate the required data directly on the backend, it should convert the time into an <code class="highlighter-rouge">int</code> value. such as:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>original time    show time
0 10 1（means 1:10） 110
0 16 0 （means 12:16）   16
0 30 23（means evening 11:30） 2330
</code></pre>
</div>
<p>If the time does not meet the four positions when you look at it, you need to complete the leading zero to see.</p>

<p>The core of time is as follows:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="s">'0'</span> <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">'0'</span><span class="p">:</span>
        <span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></code></pre></figure>

<p>configuring post data:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s">'/timeserialize'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_json</span><span class="p">():</span>
    <span class="c"># calculate some data
</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></code></pre></figure>

<h4 id="highcharts-frontend-framework">Highcharts FrontEnd Framework</h4>

<p>There are two famous visualization framework,one is <a href="https://ecomfe.github.io/echarts-doc/public/en/index.html">Echarts</a> opensourced by Baidu,and the other is <a href="https://www.highcharts.com/">Highcharts</a> opensourced by Google(D3.js is mainly for animation).I choose the latter one.</p>

<p>Adding the resource files firstly.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href=""&gt;
    &lt;!-- jquery.min.js must put before highcharts.js 之前 --&gt;
    &lt;script src=""&gt;&lt;/script&gt;
    &lt;script src=""&gt;&lt;/script&gt;

</code></pre>
</div>

<p>Then use <code class="highlighter-rouge">jquery</code> to configure JSON data in POST format.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;script&gt;
$(function () {
    $.getJSON('/timeserialize', function (data) {
    /*$.getJSON('/configure', function (data) {*/
        $('#container').highcharts({
            // legend,option...data
        });
    });
});
&lt;/script&gt;


</code></pre>
</div>

<h4 id="first-version">First Version</h4>

<p>The display after the first version is as follows：</p>

<p><img src="/images/figure-1.png" alt="figure-1" /></p>

<p><img src="/images/figure-2.png" alt="figure-2" /></p>

<p>The number of points refers to the number of jobs running at the current point in time. Drag and drop to see changes in a finer time dimension.</p>

<h4 id="second-version">Second Version</h4>

<p>After combining the obtained time format and the specific number of seconds,
You can get the specific execution time of the task, and transfer it to unixtime and pass it to the front end, then turn it to specific time, the visual effect will be better.</p>

<p>The key is to add a function to the JSON format in <code class="highlighter-rouge">$function()</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var jsonData = data;
var jsonDataSuccess = new Array();
var jsonDataFailed = new Array();
# ...
tempArray.push(parseInt(jsonData[i].startTime) + 28800000,parseInt(jsonData[i].spendTime));
# ...
</code></pre>
</div>

<p>In the <code class="highlighter-rouge">series</code>, use two types to mark:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    series:[{
            name:'success',
            color:'rgb(119,152,191)',
            data:jsonDataSuccess,
            },{
            name:'failed',
            color:'rgb(255,0,0)',
            data:jsonDataFailed
            }
                    ]
</code></pre>
</div>

<p>Using the formatter() option in <code class="highlighter-rouge">tooltip</code> to return a more friendly expression:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>tooltip:{
    formatter: function() {
        //...
        return 'jobid :' + jobId + '&lt;br&gt;' + "jobName:" + jobName + '&lt;br&gt;'  + 'starttime :' + startTime
    }
}
</code></pre>
</div>

<p>The resulting visualization results are as follows:</p>

<p><img src="/images/figure-3.png" alt="figure-3" /></p>


        </div>
        
          <p class="post-continue">
            <a href="/2016/09/08/Data-Visualize-With-Flask-And-Highcharts/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2016/05/23/Read-Python-Open-Source-Project/">Different Open Source Projects I Read</a>
          </h1>

          <p class="post-meta">May 23, 2016 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>To write <code class="highlighter-rouge">fluent/elegant/idiomatic</code> code
<!-- more --></p>

<p><a href="/../translation/2016-05-23-Read-Python-Open-Source-Project.html">这篇文章对应的中文版</a></p>

<h4 id="prologue">Prologue</h4>

<p>The benefits of reading open source projects have been demonstrated by many people. Whether it is to increase the understanding of tools used in daily development, or to learn to divide the project structure and improve the quality of the code better, reading open source projects is essential.</p>

<p>There are some interesting findings during the progress.Take the famous <a href="https://github.com/requests/requests">requests</a> which gained over 3.5K stars as an example. There is a file (core.py) in the first version v0.2.3 listed on github that used tab as a whitespace,it certainly doesn’t satisfy the requirements of PEP8 (:D</p>

<hr />

<h4 id="what-is-pythonic-code">What is Pythonic Code</h4>

<p>Pythonic code is to implement code in a pythonic way.Having a summary:</p>

<ol>
  <li>
    <p><code class="highlighter-rouge">OOP</code> considers code reuse and extension. Many can use a basic class / ABC to provide an interface, other sub-class inherit from it just needs to implement the necessary function.</p>
  </li>
  <li>
    <p>Customize BaseException, such as <code class="highlighter-rouge">class ProjectBasedException(Exception)</code>, and then use the code of the various inheritance exception classes to handle the specific exception, so that the prompt information can be reported more specifically.</p>
  </li>
  <li>
    <p>Define some small and common functions in utils, abstract the multiplexed code into @decorators; define the configuration files that will be used in settings, such as url, to avoid hard-coded.</p>
  </li>
  <li>
    <p>Defensive programming. Although _prefix can be used to define the private attribute to some extent, the parameters passed to the API must be type tested. Use a reasonable data structure or other tools (redis/celery) to limit the use of resources.</p>
  </li>
  <li>
    <p>meta-programming implements the <code class="highlighter-rouge">User-defined behaviour</code>.</p>
  </li>
  <li>
    <p>Standard comments for <code class="highlighter-rouge">docstring</code> and writing unit tests, logging important actions to files.</p>
  </li>
  <li>
    <p>On the basis of the above, some details, like replacing the string splicing with <code class="highlighter-rouge">''.join[]</code>, replacing the loop with <code class="highlighter-rouge">list-comprehension</code> also should be noticed.</p>
  </li>
</ol>

<hr />

<h3 id="projects-list">Projects List</h3>

<p>Not all high-star projects on Github are useful. For example, the code style of a <code class="highlighter-rouge">1000+ star</code> project is not good, and a lot of code does not meet the principle of <code class="highlighter-rouge">DRY(Don't Repeat Yourself)</code> . There are still many projects that directly hack Python itself(so many variables and functions begin with <code class="highlighter-rouge">__</code>, it’s hard to understand what the logic behind it is)</p>

<hr />

<h5 id="june"><a href="https://github.com/pythoncn/june">june</a></h5>

<p>Although the project has been deprecated in the description, it can still run smoothly. A forum project that includes the <code class="highlighter-rouge">Node/Topic/Reply</code>.</p>

<p>a. The implementation of OOP is very thorough, the following is an example:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Define saving method in Topic model
</span>
<span class="k">class</span> <span class="nc">Topic</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c">#...
</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">:</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span>

<span class="c"># Form uses save method of Topic Model
</span>
<span class="k">class</span> <span class="nc">TopicForm</span><span class="p">(</span><span class="n">BaseForm</span><span class="p">):</span>
    <span class="c">#...
</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">Topic</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Topic</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>

<span class="c"># Views uses method of Form
</span>
<span class="nd">@bp.route</span><span class="p">(</span><span class="s">'/create/&lt;int:id&gt;'</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span><span class="s">'POST'</span><span class="p">])</span>
<span class="nd">@require_user</span>
<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">url_name</span><span class="p">):</span>
    <span class="c">#...
</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">TopicForm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
        <span class="n">topic</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="p">,</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'.view'</span><span class="p">,</span><span class="n">uid</span><span class="o">=</span><span class="n">topic</span><span class="o">.</span><span class="nb">id</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'topic/create.html'</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>

<span class="c"># So avoiding the hassle of calling the model and db.session.add(topic) in views.</span></code></pre></figure>

<hr />

<p>b.  there is a decorator <code class="highlighter-rouge">@require_user</code>, which is the permission management for the user. A user may have multiple roles. If you define a decorator for each of these roles, there will be too many repetitions. In this case let’s see what the author did:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Define a base class
</span>

<span class="k">class</span> <span class="nc">require_role</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'spam'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">'new'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">'user'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">'staff'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s">'admin'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">role</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s">'account.signin'</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">'?'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
                    <span class="n">url</span> <span class="o">+=</span> <span class="s">'?next='</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">role</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="nb">id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c"># this is superuser, have no limitation
</span>
                <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s">'new'</span><span class="p">:</span>
                <span class="n">flash</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">'Please verify your email'</span><span class="p">),</span> <span class="s">'warn'</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'account.setting'</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s">'spam'</span><span class="p">:</span>
                <span class="n">flash</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">'You are a spammer'</span><span class="p">),</span> <span class="s">'error'</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">role</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wrapper</span>

<span class="c"># Then define different permission limits for different roles
</span>

<span class="n">require_login</span> <span class="o">=</span> <span class="n">require_role</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="n">require_user</span> <span class="o">=</span> <span class="n">require_role</span><span class="p">(</span><span class="s">'user'</span><span class="p">)</span>
<span class="n">require_staff</span> <span class="o">=</span> <span class="n">require_role</span><span class="p">(</span><span class="s">'staff'</span><span class="p">)</span>
<span class="n">require_admin</span> <span class="o">=</span> <span class="n">require_role</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span></code></pre></figure>

<hr />

<h5 id="zhihu-oauth-by-7sdream"><a href="https://github.com/7sDream/zhihu-oauth">zhihu-oauth</a> by @7sDream</h5>

<p>The second project is <a href="https://github.com/7sDream/zhihu-oauth">zhihu-oauth</a> written by @7sDream. The overall structure is very beautiful, and the meta-programming is also very good. Especially considering that the author and I are peers, it is especially amazing. BTW, I also provide two PRs: 
<a href="https://github.com/7sDream/zhihu-oauth/pull/27">pull-27</a> and 
<a href="https://github.com/7sDream/zhihu- Oauth/pull/28">pull-28</a></p>

<p>The author reversely parses the zhihu Android client and encapsulates the oauth interface. Unlike other libraries that use simulated login and Beautifuoup to parse web content, zhihu-oauth can provide a more stable API. And it is also less likely to be blocked by ip.</p>

<p>The whole project is divided into three parts: <code class="highlighter-rouge">oauth</code> for verification, <code class="highlighter-rouge">zhcls</code> for class description, and <code class="highlighter-rouge">client</code> for combining the two to provide a login API.</p>

<p>For <code class="highlighter-rouge">oauth</code>:</p>

<ul>
  <li>
    <p>The <code class="highlighter-rouge">imZhihuAndroidClient class</code> is defined in im_android.py, inheriting requests.authbase. The methods that are used in building parameters such as api_version/app_version/zpp_za/ua are defined in <code class="highlighter-rouge">__init__</code>. Also use the method self._api_version=api_version or API_VERSION (from setting.py) to allow the user to customize some parameters. The following <code class="highlighter-rouge">__call__(self,r)</code> is the mechanism of authbase and will be called automatically when posting a request.</p>
  </li>
  <li>
    <p>Before_login_auth.py defines the BeforeLoginAuth class, inherits the imZhihuAndroidClient class above, adds client_id to imZhihuAndroidClient, and uses self._client_id=client_id to execute validation before login. The implementation of <code class="highlighter-rouge">__call__</code> is as follows:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">BeforeLoginAuth</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__call__</span><span class="p">()</span>
    <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">'Authorization'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'oauth{0}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client_id</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">r</span></code></pre></figure>

<ul>
  <li>
    <p>In setting.py, some parameters are used, such as <code class="highlighter-rouge">ZHIHU_API_ROOT</code>, <code class="highlighter-rouge">LOGIN_URL=ZHIHU_API_ROOT+'/signin'</code>, all in uppercase.</p>
  </li>
  <li>
    <p>In token.py, the ZhihuToken class is defined, and the token is generated after the access is known. So obviously, according to OOP’s thoughts, the following job can be done:</p>
  </li>
</ul>

<p>The <code class="highlighter-rouge">self._cretate_at=time.time(), self._expires_in=expires_in</code> initialization tool is defined in <code class="highlighter-rouge">__init__</code> and these are also provided:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">ZhihuToken</span><span class="p">:</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="n">json_dict</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ZhihuToken</span><span class="p">(</span><span class="o">**</span><span class="n">json_dict</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'{} is not a valid zhihu token json'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json_dict</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">json_str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ZhihuToken</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">))</span>
        <span class="k">except</span> <span class="nb">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="s">'{} is not a valid zhihu token str'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json_str</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="c"># pickle ,long-time storage
</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="s">"""
        saving token to file
        """</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">user_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_id</span></code></pre></figure>

<p>Look again at the implementation of <code class="highlighter-rouge">exception.py</code>. As mentioned earlier,base exception should be provided for the entire project.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># deal python2 and python3 respectively.
</span>
<span class="c"># Also you can use `if py2:import ..;else import ..`,but it's against the   
</span>
<span class="c"># principle of `easier to ask for forgiveness than permission`
</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">MyJSONDecodeError</span>
<span class="k">except</span> <span class="nb">ImportError</span><span class="p">:</span>
    <span class="n">MyJSONDecodeError</span> <span class="o">=</span> <span class="nb">Exception</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">UnexpectedResponseException</span><span class="p">(</span><span class="nb">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">url</span><span class="p">,</span><span class="n">res</span><span class="p">):</span>
        <span class="s">"""
        For all situations that json cannot be decoded,this exception will be used.
        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"when visit {self.url},get an unexpected response {self.res.text}"</span><span class="o">.</span>
            <span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="n">__str__</span> <span class="o">=</span> <span class="n">__repr__</span></code></pre></figure>

<hr />

<p>Java 代码</p>

<p>Based on requirements,I ever investigaed the use of <code class="highlighter-rouge">jedis</code> to see how it handlers multi-thread situation.</p>

<p>It inherits <code class="highlighter-rouge">Apache.commons.pool</code> and it is called
The <code class="highlighter-rouge">super.getResource()</code> method, which in turn calls the <code class="highlighter-rouge">borrowObject</code> method in the pool.In the <code class="highlighter-rouge">borrowObject</code> method, it has implemented the consideration of multithreading:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">long</span> <span class="n">starttime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
<span class="n">Latch</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">latch</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Latch</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;();</span>
<span class="kt">byte</span> <span class="n">whenExhaustedAction</span><span class="o">;</span>
<span class="kt">long</span> <span class="n">maxWait</span><span class="o">;</span>
<span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
<span class="cm">/* 
Get local copy of current config. Can't sync when used 
later as it can result in a deadlock. Has the added 
advantage that config is consistent for entire execution

*/</span>
<span class="n">whenExhaustedAction</span> <span class="o">=</span> <span class="n">_whenExhaustedAction</span><span class="o">;</span>
<span class="n">maxWait</span> <span class="o">=</span> <span class="n">_maxWait</span><span class="o">;</span>

<span class="c1">// activate &amp; validate the object
</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">_factory</span><span class="o">.</span><span class="na">activateObject</span><span class="o">(</span><span class="n">latch</span><span class="o">.</span><span class="na">getPair</span><span class="o">().</span><span class="na">value</span><span class="o">);</span>
    <span class="k">if</span><span class="o">(</span><span class="n">_testOnBorrow</span> <span class="o">&amp;&amp;</span>
            <span class="o">!</span><span class="n">_factory</span><span class="o">.</span><span class="na">validateObject</span><span class="o">(</span><span class="n">latch</span><span class="o">.</span><span class="na">getPair</span><span class="o">().</span><span class="na">value</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="o">(</span><span class="s">"ValidateObject failed"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">synchronized</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// only one thread can execute at the moment
</span>
        <span class="n">_numInternalProcessing</span><span class="o">--;</span>
        <span class="n">_numActive</span><span class="o">++;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">latch</span><span class="o">.</span><span class="na">getPair</span><span class="o">().</span><span class="na">value</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="o">}</span></code></pre></figure>

        </div>
        
          <p class="post-continue">
            <a href="/2016/05/23/Read-Python-Open-Source-Project/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2016/02/22/Hadoop-Mapreduce-Tutorial/">Translation - Use MapReduce to explore friendships</a>
          </h1>

          <p class="post-meta">Feb 22, 2016 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>A translation of MapReduce in practice</p>

<!-- more -->

<hr />

<p>During the progress of learning MapReduce,it is beneficial to find an article talking about the usage of MapReduce in practical. So I decided to translate it into Chinese and share it with others.</p>

<p>You can find the original novel in <a href="http://stevekrenzel.com/finding-friends-with-mapreduce">finding-friends-with-mapreduce</a>.</p>

<p><a href="/../translation/2016-02-22-Hadoop-Mapreduce-Tutorial.html">点击查看对应译文</a></p>


        </div>
        
          <p class="post-continue">
            <a href="/2016/02/22/Hadoop-Mapreduce-Tutorial/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2015/10/21/Django-And-CortexForum/">Learning Django And cortexForum</a>
          </h1>

          <p class="post-meta">Oct 21, 2015 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>Studying Django resources and <code class="highlighter-rouge">cortexForum</code>
<!-- more --></p>

<p><a href="/../translation/2015-10-21-Django-And-CortexForum.html">这篇文章对应的中文版</a></p>

<h5 id="studying-resources">Studying Resources</h5>

<p>At first you can review <a href="https://docs.djangoproject.com/en/2.1/intro/tutorial01/">official tutorial</a> and <a href="http://www.tangowithdjango.com/book17/">tango with Django</a></p>

<p>Advanced books include ：</p>

<ul>
  <li>
    <p><a href="https://www.twoscoopspress.com/products/two-scoops-of-django-1-11">《Two Scopes of Django》</a> : author is the community developer，there are many industrial best practices.</p>
  </li>
  <li>
    <p><a href="https://www.amazon.ca/Test-Driven-Development-Python-Selenium-JavaScript/dp/1491958707">《Test Driven Web Development》</a>: Development Django based on <strong>TDD(Test-Driven Development)</strong> ，I’m impressed by the use of selenium to detect the 404 page.</p>
  </li>
</ul>

<hr />

<h3 id="cortexforum">cortexForum</h3>

<blockquote>
  <p>Tell me and I forget, teach me and I may remember, involve me and I learn.</p>
</blockquote>

<p>I try to write a forum program <a href="https://github.com/Allianzcortex/cortexForum">cortexForum</a> to deepen my understanding,and during the progress,I try to do those aspects:</p>

<ul>
  <li>
    <p>In the code, the document module used and the corresponding specific usage are marked for easy searching.</p>
  </li>
  <li>
    <p>The section with SO in the annotation indicates that it is very common, and there are related issues on stackoverflow (such as the lookup field in query_set()).</p>
  </li>
  <li>
    <p>Parts that have multiple workarounds are written in comments (such as <code class="highlighter-rouge">objects.filer().update and instance.save()</code>)</p>
  </li>
  <li>
    <p>Use gitbook format as a wiki for a general overview of forum design</p>
  </li>
</ul>

<hr />

<p>Django’s models model has a Manager object, which is very convenient to implement OOP (implementing highlevel and not just the behavior of specific instances). Take the unit of Topic as an example, define the <code class="highlighter-rouge">title</code> and <code class="highlighter-rouge">content</code> of the post, and then define <code class="highlighter-rouge">two foreign keys</code>. One is node, which defines the node where the post is published; the other is author, which defines the author of the post. For a post, I want to be able to get information on all topics by the name of a node (which can be understood as <code class="highlighter-rouge">slug</code> here) or an author’s name (username), so you need to define:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_all_topic_by_node_slug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_slug</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">node__slug</span><span class="o">=</span><span class="n">node_slug</span><span class="p">)</span><span class="o">.</span> \
            <span class="n">select_related</span><span class="p">(</span><span class="s">'node'</span><span class="p">,</span> <span class="s">'author'</span><span class="p">,</span> <span class="s">'last_replied_by'</span><span class="p">)</span><span class="o">.</span> \
            <span class="n">order_by</span><span class="p">(</span><span class="s">'-last_replied_time'</span><span class="p">,</span> <span class="s">'-reply_count'</span><span class="p">,</span> <span class="s">'-created_at'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">query</span></code></pre></figure>

<p>With the redefinition of queryset() , you can get the subject information with <code class="highlighter-rouge">Node.objects.get_all_topic_by_node_slug('slug-example')</code>. And if you don’t do this, you need to redefine it multiple times in each view’s function, and once the model changes, it’s hard to fix it.</p>

<p>The form does not define a higher level of abstraction for us, but does not prevent us from doing OOP. Take authen’s registrationForm as an example. We made <code class="highlighter-rouge">clean_username</code>, <code class="highlighter-rouge">clean_mail</code> in the forms, and overridden the default clean method. When the <code class="highlighter-rouge">is_valid()</code> verification is performed, an error message is directly raised.</p>

<hr />

<p>As for the <strong>Front End</strong>, I fully adopt the architecture of bootstrap.</p>

<p>Regarding <strong>handwritten HTML</strong> or <code class="highlighter-rouge">Crispyforms/Django-bootstrap3 </code>, this kind of thing is a matter of opinion. I think it is better to use pure handwritten HTML, because this solution is separated from the front and back, and can be used the next time you learn other frameworks. By the way, you only need to pass the API to the front end.take an example:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"id_"</span> <span class="na">class=</span><span class="s">"col-md-3 control-label"</span><span class="nt">&gt;&lt;/label&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-9"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"id_"</span> <span class="na">required</span> <span class="na">name=</span><span class="s">""</span> <span class="na">autofocus</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"help-block"</span><span class="nt">&gt;</span>Please input your username<span class="nt">&lt;/p&gt;</span></code></pre></figure>

<p>It is more customizable than <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">form.as_p</span><span class="w"> </span><span class="p">}</span></code> or <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">crispy</span><span class="w"> </span><span class="err">form</span><span class="w"> </span><span class="p">}</span><span class="w"> </span></code>. The idea of crispy-forms is to set the layout and the corresponding label in the forms. To update the front-end display, you need to modify the code in the backend rather than CSS files,it is against the trendency.</p>

<hr />

<p>The MySQL problem is still quite a lot. In the beginning, English posting is normal. Then following <a href="hthttps://blog.ionelmc.ro/2014/12/28/terrible-choices-mysql/tps://blog.ionelmc.ro/2014/12/28/terrible- The choices-mysql/">mysql-utf-8</a> method to uses <code class="highlighter-rouge">utf-8</code> encoding, only the administrator can post normally, while other users will remind the second column not exists when posting.  Finally analyzes that it is possibly because the id corresponding to user and forumUser is not even, so manually add a <code class="highlighter-rouge">request.User </code> and all will be fine.</p>

<p>Next time I will prefer to use <code class="highlighter-rouge">PostgreSql</code> and <code class="highlighter-rouge">nosql</code> to solve the problem ,and using abstractUser to expand User model.</p>

<hr />

        </div>
        
          <p class="post-continue">
            <a href="/2015/10/21/Django-And-CortexForum/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2015/09/14/Use-PyQt-Develop-Desktop-Web-GUI/">Develop a desktop client with PyQT</a>
          </h1>

          <p class="post-meta">Sep 14, 2015 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>In this novel,I’ll demonstrate how to read the database and display it , with Python’s dynamic mechanism and Qt’s signal slot.</p>

<!-- more -->

<p><a href="/../translation/2015-09-14-Use-PyQt-Develop-Desktop-Web-GUI.html">这篇文章对应的中文版</a></p>

<hr />

<p>This is a program that can detect network connections. The screenshot of the interface is as follows</p>

<p><img src="/images/pyqt-example.png" alt="PyQt" /></p>

<p>There will be very few opportunities to write the client in the future(I mean many professional clients are mainly developed by C#/.net,although actually dropbox developed its’ client with PyQT)… So I won’t pursue the best practices. I just need to make a <strong>poke-marked GUI</strong> .⊙﹏⊙b</p>

<h4 id="ui-and-interface-corresponding">UI and interface corresponding</h4>

<p>PyQt itself is similar to Qt’s signal slot mechanism. When a button is clicked, a signal is sent and the processing mechanism of the signal needs to be defined.</p>

<p>The design interface is designed directly with the <strong>designer</strong>. Drag <code class="highlighter-rouge">button/listview/model</code> and customize the name.</p>

<p>After generating the .ui file, use <code class="highlighter-rouge">pyuic4 –x ping_ui.ui –o ping_ui.py</code> to see that the ping_ui.py file contains <code class="highlighter-rouge">class Ui_Form(object)</code>, which has various lengths/locations defined. It’s More convenient than handwriting</p>

<p>Then define a <code class="highlighter-rouge">pyqt_example2.py</code> which contains the following files:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">CalculateForm</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CalculateForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_Form</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code></pre></figure>

<p>then define the execution function：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">calculator</span> <span class="o">=</span> <span class="n">CalculateForm</span><span class="p">()</span>
    <span class="n">calculator</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span></code></pre></figure>

<p>After execution, you can see that the interface has been successfully displayed.</p>

<p>The next step is to establish a signal slot mechanism. For example, when the button of the ui was originally defined, there is a button named <code class="highlighter-rouge">add_url</code> . We want to associate it with the function of <code class="highlighter-rouge">add_url</code> , just define it as follows (preferably in <strong>init</strong> ):</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">add_url</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_url_func</span><span class="p">)</span> <span class="c"># click function</span></code></pre></figure>

<h4 id="crud-and-display">CRUD and Display</h4>

<p>The model defined in PyQt is <code class="highlighter-rouge">QSqlTableModel</code>, and the definition of table is <code class="highlighter-rouge">listview</code>.
For example, define the method of initialize_model() :</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">db</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlDatabase</span><span class="o">.</span><span class="n">addDatabase</span><span class="p">(</span><span class="s">'QSQLITE'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">setDatabaseName</span><span class="p">(</span><span class="s">'test_ping.db'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">initialize_model</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setTable</span><span class="p">(</span><span class="s">'url_ping'</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setEditStrategy</span><span class="p">(</span><span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlTableModel</span><span class="o">.</span><span class="n">OnManualSubmit</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setHeaderData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">,</span> <span class="s">u"url"</span><span class="p">)</span> <span class="c"># url link</span></code></pre></figure>

<p>To display, just connect the listview with the corresponding model:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">show_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">QSqlTableModel</span><span class="p">()</span>
    <span class="n">initialize_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">url_list</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="c"># self.ui.url_list is  listview
</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">url_list</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>

<p>You can see the latest database, equivalent to refreshing, by calling the self.show_view() method after each addition, deletion, and change.</p>

<h5 id="how-to-execute-a-query">How to execute a query</h5>

<p>For example, to find the content containing ‘test’, the code is as follows:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
<span class="n">query</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="s">"select * from test where value like '</span><span class="si">%</span><span class="s">test</span><span class="si">%</span><span class="s">'"</span><span class="p">)</span></code></pre></figure>

<p>And if you want to show with a better way,then redefine QSqlQueryModel</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sqlQueryModel</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="s">"select * from test where value like '</span><span class="si">%</span><span class="s">test</span><span class="si">%</span><span class="s">' "</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">url_list</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">sqlQueryModel</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">url_list</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>

<p>Define the popup: Use the simplest of the following functions:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">show_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">u'detect successfully'</span><span class="p">)</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></code></pre></figure>

<h4 id="ui-and-execution-thread-separation">Ui and execution thread separation</h4>

<p>How to set the ui and execute task thread separation so that the application won’t be non-reactive:</p>

<p>There are many ways to do this. I chose the following method:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">QThread</span>

<span class="k">class</span> <span class="nc">PingThread</span><span class="p">(</span><span class="n">QThread</span><span class="p">):</span>
    <span class="s">""" define PingThread """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="n">QThread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ping_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">'ping url'</span><span class="p">))</span>
        <span class="k">return</span>

<span class="s">""" Then call it in the main thread. """</span>

<span class="bp">self</span><span class="o">.</span><span class="n">pingThread</span> <span class="o">=</span> <span class="n">PingThread</span><span class="p">(</span><span class="n">target_url</span><span class="p">)</span>
<span class="c"># self.connect(self.pingThread, SIGNAL('ping url'), self.show_messagebox) 可选
</span>
<span class="bp">self</span><span class="o">.</span><span class="n">pingThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></code></pre></figure>

<h4 id="progressbar">ProgressBar</h4>

<p>The progress bar in PyQt is displayed using QProgressBar. When set in ui, there will be a minimum value (default is 0) and a maximum value (default is 100).</p>

<p>Just set it when updating</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">click_progrress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="c">#  progresses to 30%
</span>
<span class="c"># click_progress 是 ui 里对应的 ProgressBar</span></code></pre></figure>

<h4 id="other-stuffs">Other Stuffs</h4>

<p>The ping calls the ping API that comes with the system.</p>

<p>Tracert calls the tracert API in windows (the corresponding Linux command is traceroute)</p>

<p>Telnet is to detect if the port is open. Directly calling the system command has two drawbacks:</p>

<p>1 Windows requires the user to manually open the configuration</p>

<p>2 telnet uses the cursor to flash to determine the port status with no return value, it is not convenient for program processing.</p>

<p>So final decision is to use socket to connect:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">url_name</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
<span class="n">port_open</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">False</span></code></pre></figure>

<p>PyQt comes with a lot of demos in site-packages, and it’s faster to see the code directly than the documentation.
At the time of the study, I wrote a calculator demo that adds genuine. When the input number or the selected calculation symbol changes, the calculation result is automatically changed (well, eval()~ and the Python decorator is used. characteristic.</p>

        </div>
        
          <p class="post-continue">
            <a href="/2015/09/14/Use-PyQt-Develop-Desktop-Web-GUI/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2015/03/11/Why-I-Love-Golang-So-Much/">Why I Love Golang So Much</a>
          </h1>

          <p class="post-meta">Mar 11, 2015 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>Golang is the combination of Python and Java.
<!-- more --></p>

<p><a href="/../translation/2015-03-11-Dynamic-Programming-Explanation.html">这篇文章对应的中文版</a></p>

<h4 id="about-dp">About DP</h4>

<ul>
  <li>
    <p>Dynamic programming is a very important algorithm, and mastery of it should be the basic skills for computer science students.</p>
  </li>
  <li>
    <p>Let’s explain as much as possible about the understanding of this type of algorithm.</p>
  </li>
  <li>
    <p>The key is <code class="highlighter-rouge">state definition</code> and <code class="highlighter-rouge">state transition equation</code></p>
  </li>
</ul>

<hr />

<h4 id="longest-increasing-subsequence">Longest Increasing Subsequence</h4>

<blockquote>
  <p>Given a sequence of K integers { N1, N2, …, NK }, any contiguous subsequence can be expressed as { Ni, Ni+1, …, Nj }, where 1 &lt;= i &lt;= j &lt; = K. The largest contiguous subsequence is the element and the largest one of all consecutive subsequences, such as the given sequence { -2, 11, -4, 13, -5, -2 }, whose largest contiguous subsequence is { 11, -4, 13 } and the maximum sum is 20.</p>
</blockquote>

<ul>
  <li>
    <p>Define <code class="highlighter-rouge">sum[i]</code> as the <code class="highlighter-rouge">maximum value of contiguous subsequence with A[i] as the last end</code></p>
  </li>
  <li>The state transition equation is: <code class="highlighter-rouge">sum[i]=max(sum[i-1]+a[i], a[i])</code></li>
  <li>T he actual solution is, as long as sum&gt;0, then adding a[i] is still possible to increase max; but if sum&lt;0, it should be discarded immediately, starting from 0 to calculate the next</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">}</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">max</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">sum</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="nb">sum</span>
    <span class="k">if</span> <span class="nb">sum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="k">return</span> <span class="nb">sum</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">LIS</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">arr</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">];</span> <span class="c1">// length
</span>
        <span class="n">Arrays</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">index</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">];</span> <span class="c1">// distance
</span>
        <span class="n">Arrays</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">index</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>


        <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">arr</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="n">list</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&lt;</span> <span class="n">list</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">list</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
                    <span class="n">index</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">j</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>

        <span class="c1">// choose the max
</span>
        <span class="kt">int</span> <span class="n">max_index</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">list</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">max</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">max</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="n">max_index</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
            <span class="o">}</span>


        <span class="n">StringBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="n">builder</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">arr</span><span class="o">[</span><span class="n">max_index</span><span class="o">]);</span>
        <span class="kt">int</span> <span class="n">next_index</span> <span class="o">=</span> <span class="n">index</span><span class="o">[</span><span class="n">max_index</span><span class="o">];</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">next_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">builder</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">arr</span><span class="o">[</span><span class="n">next_index</span><span class="o">]</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
            <span class="n">next_index</span> <span class="o">=</span> <span class="n">index</span><span class="o">[</span><span class="n">next_index</span><span class="o">];</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span> <span class="c1">// print the result
</span>
        <span class="k">return</span> <span class="n">max</span><span class="o">;</span></code></pre></figure>

<hr />

<h4 id="number-tower-problem">Number tower problem</h4>
<p><img src="/images/hdu-2084.jpg" alt="img" /></p>

<blockquote>
  <p>From the top layer to the bottom layer, each layer can only go to the adjacent node, and calculate the sum of the numbers</p>
</blockquote>

<ul>
  <li>
    <p>Define the state equation: <code class="highlighter-rouge">max[i,j]</code> represents the sum of the largest numbers passed by [i,j] as the starting point. Then <code class="highlighter-rouge">max[1,1]</code> is our target</p>
  </li>
  <li>
    <p>Define the state transition equation: <code class="highlighter-rouge">max[i,j]=num[i,j]+max(max(i+1,j),max(i+1,j+1))</code></p>
  </li>
  <li>
    <p>Then you can choose to solve it from top to bottom or from bottom to top</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include&lt;iostream&gt;  
#include&lt;cstring&gt;  
</span><span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span>  
<span class="cp">#define maxnum 1000  
</span><span class="kt">int</span> <span class="n">num</span><span class="p">[</span><span class="n">maxnum</span><span class="p">][</span><span class="n">maxnum</span><span class="p">];</span>  
<span class="kt">int</span> <span class="n">d</span><span class="p">[</span><span class="n">maxnum</span><span class="p">][</span><span class="n">maxnum</span><span class="p">];</span>  
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>  
<span class="p">{</span>  
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">;</span>  
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">;</span>  
    <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="p">;</span>  
    <span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="o">--</span><span class="p">){</span>  
        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">m</span><span class="p">;</span>  
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>  
            <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">i</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>  
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>  
        <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="n">d</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">num</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>  
  
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>  
            <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">i</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>  
            <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>  
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>  
        <span class="n">memset</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">d</span><span class="p">));</span>  
    <span class="p">}</span>  
<span class="p">}</span>  </code></pre></figure>

<hr />

<h4 id="backpack-problem">Backpack Problem</h4>

<ul>
  <li>There are different versions of backpack problem.Let me illustrate the basic one.</li>
</ul>

<blockquote>
  <p>There are N items and a backpack with a capacity of V. The cost of the i-th item is c[i] and the value is w[i]. Decide which items are loaded into the backpack so the sum of the values can be max.</p>
</blockquote>

<ul>
  <li>Solve it with Java.There are two types of answer,see the comment.</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">Knapsack1</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">weight</span><span class="o">,</span> <span class="kt">int</span> <span class="n">capacity</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">capacity</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">weight</span><span class="o">[</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">capacity</span><span class="o">)</span>
            <span class="k">return</span> <span class="nf">Knapsack1</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="nf">max</span><span class="o">(</span><span class="n">value</span><span class="o">[</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span> <span class="o">+</span> <span class="n">Knapsack1</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span> <span class="o">-</span> <span class="n">weight</span><span class="o">[</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">],</span> <span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">),</span>
                    <span class="n">Knapsack1</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">));</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">Knapsack2</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">weight</span><span class="o">,</span> <span class="kt">int</span> <span class="n">capacity</span><span class="o">,</span> <span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">capacity</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">weight</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">capacity</span><span class="o">)</span>
            <span class="k">return</span> <span class="nf">Knapsack2</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="nf">max</span><span class="o">(</span><span class="n">value</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">+</span> <span class="n">Knapsack2</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span> <span class="o">-</span> <span class="n">weight</span><span class="o">[</span><span class="n">index</span><span class="o">],</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="o">),</span>
                    <span class="n">Knapsack2</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="o">));</span>
    <span class="o">}</span>

        <span class="c1">// two ways to solve it
</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">value</span> <span class="o">=</span> <span class="o">{</span><span class="mi">60</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">120</span><span class="o">};</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">weight</span> <span class="o">=</span> <span class="o">{</span><span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="o">};</span>
        <span class="kt">int</span> <span class="n">capacity</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dp</span><span class="o">.</span><span class="na">Knapsack1</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">number</span><span class="o">));</span> <span class="c1">// final result is 220
</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dp</span><span class="o">.</span><span class="na">Knapsack2</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">index</span><span class="o">));</span>  <span class="c1">// final result is also 220</span></code></pre></figure>

<hr />

<h3 id="303-range-sum-quwey---immutable">303 Range Sum Quwey - Immutable</h3>

<ul>
  <li>
    <p><a href="https://leetcode.com/problems/range-sum-query-immutable/">Link</a></p>
  </li>
  <li>
    <p>About the meaning：Give an array that returns the value of any two range of ranges</p>
  </li>
  <li>
    <p>Idea: The rpblem content says <code class="highlighter-rouge">many calls to function</code>, so the traversal solution will definitely be <strong>TLE</strong>（Time Limit Exceeded); and <code class="highlighter-rouge">sum[i,j]=sum[j]-sum[i-1]</code> is obvious, so all the sums are found in one pass. After the value is done, subtraction is fine. Note you may need to use global variables</p>
  </li>
  <li>
    <p>code:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">// written in c++
// Using vector&lt;int&gt; to add status will be better
</span><span class="n">class</span> <span class="n">NumArray</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">dp</span><span class="p">[</span><span class="mi">100000</span><span class="p">];</span>
<span class="n">public</span><span class="o">:</span>
    <span class="n">NumArray</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">nums</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nums</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
            <span class="k">return</span> <span class="p">;</span>
        <span class="kt">int</span> <span class="n">length</span><span class="o">=</span><span class="n">nums</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">dp</span><span class="p">));</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">length</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">sumRange</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>    
    <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

<p>Writen in Python：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">NumArray</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nums</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">=</span> <span class="n">nums</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">nums</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">sumRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span></code></pre></figure>

<hr />

<h5 id="70-climbstatirs">70 climbStatirs</h5>

<ul>
  <li>
    <p><a href="https://leetcode.com/problems/climbing-stairs/">link</a></p>
  </li>
  <li>
    <p>About the meaning：Ascend a staircase, you can take 1 step or  take two steps.if you go to n steps, how many solutions will you have?</p>
  </li>
  <li>
    <p>Idea: Use dp[n] to indicate the number of methods to go to n steps. For dp[n-1], you can only choose to take 1 step; for dp[n-2],
If you choose 1+1, it will overlap with dp[n-1], you can only choose 2 steps.</p>
  </li>
  <li>
    <p>Code：</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">Written</span> <span class="n">in</span> <span class="n">C</span><span class="o">++</span>
<span class="n">class</span> <span class="n">Solution</span> <span class="p">{</span>
<span class="n">public</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">climbStairs</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">]);</span>
        <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># written in Python
</span>
<span class="k">class</span> <span class="nc">Solution</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="o">=</span><span class="p">{}</span>
        
    <span class="k">def</span> <span class="nf">climbStairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>  </code></pre></figure>

<hr />

<h5 id="64-minimum-path-sum">64 Minimum Path Sum</h5>

<ul>
  <li>
    <p><a href="https://leetcode.com/problems/minimum-path-sum/">link</a></p>
  </li>
  <li>
    <p>About the meaning: <code class="highlighter-rouge">m*n</code> is a matrix of all positive numbers, which can be moved downwards to the right,find the sum of the distances from the upper left to the lower right.</p>
  </li>
  <li>
    <p>Idea: Dynamic programming.using dp[i][j] to represent the shortest number of steps taken with i, j as the last square.
Then <code class="highlighter-rouge">dp[i][j]=max(dp[i-1][j]+grid[i][j],dp[i][j-1]+gird[i][j]</code>,we just need to implement the equation.</p>
  </li>
  <li>
    <p>Code:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">// written in C++
</span><span class="n">class</span> <span class="n">Solution</span> <span class="p">{</span>
<span class="n">public</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">minPathSum</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&amp;</span> <span class="n">grid</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">grid</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">m</span><span class="o">=</span><span class="n">grid</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">dp</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">;</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
        <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre></figure>


        </div>
        
          <p class="post-continue">
            <a href="/2015/03/11/Why-I-Love-Golang-So-Much/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2015/03/11/Dynamic-Programming-Explanation/">Thoughts Of Solving Dynamic Programming Problems</a>
          </h1>

          <p class="post-meta">Mar 11, 2015 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>Solving the dynamic programming problems
<!-- more --></p>

<p><a href="/../translation/2015-03-11-Dynamic-Programming-Explanation.html">这篇文章对应的中文版</a></p>

<h4 id="about-dp">About DP</h4>

<ul>
  <li>
    <p>Dynamic programming is a very important algorithm, and mastery of it should be the basic skills for computer science students.</p>
  </li>
  <li>
    <p>Let’s explain as much as possible about the understanding of this type of algorithm.</p>
  </li>
  <li>
    <p>The key is <code class="highlighter-rouge">state definition</code> and <code class="highlighter-rouge">state transition equation</code></p>
  </li>
</ul>

<hr />

<h4 id="longest-increasing-subsequence">Longest Increasing Subsequence</h4>

<blockquote>
  <p>Given a sequence of K integers { N1, N2, …, NK }, any contiguous subsequence can be expressed as { Ni, Ni+1, …, Nj }, where 1 &lt;= i &lt;= j &lt; = K. The largest contiguous subsequence is the element and the largest one of all consecutive subsequences, such as the given sequence { -2, 11, -4, 13, -5, -2 }, whose largest contiguous subsequence is { 11, -4, 13 } and the maximum sum is 20.</p>
</blockquote>

<ul>
  <li>
    <p>Define <code class="highlighter-rouge">sum[i]</code> as the <code class="highlighter-rouge">maximum value of contiguous subsequence with A[i] as the last end</code></p>
  </li>
  <li>The state transition equation is: <code class="highlighter-rouge">sum[i]=max(sum[i-1]+a[i], a[i])</code></li>
  <li>T he actual solution is, as long as sum&gt;0, then adding a[i] is still possible to increase max; but if sum&lt;0, it should be discarded immediately, starting from 0 to calculate the next</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">}</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">max</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">+=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">sum</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="nb">sum</span>
    <span class="k">if</span> <span class="nb">sum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="k">return</span> <span class="nb">sum</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">LIS</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">arr</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">];</span> <span class="c1">// length
</span>
        <span class="n">Arrays</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">index</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">];</span> <span class="c1">// distance
</span>
        <span class="n">Arrays</span><span class="o">.</span><span class="na">fill</span><span class="o">(</span><span class="n">index</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>


        <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">arr</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">arr</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="n">list</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&lt;</span> <span class="n">list</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">list</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="n">j</span><span class="o">]</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
                    <span class="n">index</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">j</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>

        <span class="c1">// choose the max
</span>
        <span class="kt">int</span> <span class="n">max_index</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">list</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">max</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">max</span> <span class="o">=</span> <span class="n">list</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="n">max_index</span> <span class="o">=</span> <span class="n">i</span><span class="o">;</span>
            <span class="o">}</span>


        <span class="n">StringBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="n">builder</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">arr</span><span class="o">[</span><span class="n">max_index</span><span class="o">]);</span>
        <span class="kt">int</span> <span class="n">next_index</span> <span class="o">=</span> <span class="n">index</span><span class="o">[</span><span class="n">max_index</span><span class="o">];</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">next_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">builder</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">arr</span><span class="o">[</span><span class="n">next_index</span><span class="o">]</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
            <span class="n">next_index</span> <span class="o">=</span> <span class="n">index</span><span class="o">[</span><span class="n">next_index</span><span class="o">];</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span> <span class="c1">// print the result
</span>
        <span class="k">return</span> <span class="n">max</span><span class="o">;</span></code></pre></figure>

<hr />

<h4 id="number-tower-problem">Number tower problem</h4>
<p><img src="/images/hdu-2084.jpg" alt="img" /></p>

<blockquote>
  <p>From the top layer to the bottom layer, each layer can only go to the adjacent node, and calculate the sum of the numbers</p>
</blockquote>

<ul>
  <li>
    <p>Define the state equation: <code class="highlighter-rouge">max[i,j]</code> represents the sum of the largest numbers passed by [i,j] as the starting point. Then <code class="highlighter-rouge">max[1,1]</code> is our target</p>
  </li>
  <li>
    <p>Define the state transition equation: <code class="highlighter-rouge">max[i,j]=num[i,j]+max(max(i+1,j),max(i+1,j+1))</code></p>
  </li>
  <li>
    <p>Then you can choose to solve it from top to bottom or from bottom to top</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include&lt;iostream&gt;  
#include&lt;cstring&gt;  
</span><span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span>  
<span class="cp">#define maxnum 1000  
</span><span class="kt">int</span> <span class="n">num</span><span class="p">[</span><span class="n">maxnum</span><span class="p">][</span><span class="n">maxnum</span><span class="p">];</span>  
<span class="kt">int</span> <span class="n">d</span><span class="p">[</span><span class="n">maxnum</span><span class="p">][</span><span class="n">maxnum</span><span class="p">];</span>  
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>  
<span class="p">{</span>  
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">;</span>  
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">;</span>  
    <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="p">;</span>  
    <span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="o">--</span><span class="p">){</span>  
        <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">m</span><span class="p">;</span>  
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>  
            <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">i</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>  
            <span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>  
        <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="n">d</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">num</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>  
  
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>  
            <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">i</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>  
            <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>  
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>  
        <span class="n">memset</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">d</span><span class="p">));</span>  
    <span class="p">}</span>  
<span class="p">}</span>  </code></pre></figure>

<hr />

<h4 id="backpack-problem">Backpack Problem</h4>

<ul>
  <li>There are different versions of backpack problem.Let me illustrate the basic one.</li>
</ul>

<blockquote>
  <p>There are N items and a backpack with a capacity of V. The cost of the i-th item is c[i] and the value is w[i]. Decide which items are loaded into the backpack so the sum of the values can be max.</p>
</blockquote>

<ul>
  <li>Solve it with Java.There are two types of answer,see the comment.</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">Knapsack1</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">weight</span><span class="o">,</span> <span class="kt">int</span> <span class="n">capacity</span><span class="o">,</span> <span class="kt">int</span> <span class="n">number</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">capacity</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">weight</span><span class="o">[</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">capacity</span><span class="o">)</span>
            <span class="k">return</span> <span class="nf">Knapsack1</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="nf">max</span><span class="o">(</span><span class="n">value</span><span class="o">[</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span> <span class="o">+</span> <span class="n">Knapsack1</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span> <span class="o">-</span> <span class="n">weight</span><span class="o">[</span><span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">],</span> <span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">),</span>
                    <span class="n">Knapsack1</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">number</span> <span class="o">-</span> <span class="mi">1</span><span class="o">));</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">Knapsack2</span><span class="o">(</span><span class="kt">int</span><span class="o">[]</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span><span class="o">[]</span> <span class="n">weight</span><span class="o">,</span> <span class="kt">int</span> <span class="n">capacity</span><span class="o">,</span> <span class="kt">int</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">capacity</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="o">.</span><span class="na">length</span><span class="o">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">weight</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">&gt;</span> <span class="n">capacity</span><span class="o">)</span>
            <span class="k">return</span> <span class="nf">Knapsack2</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="nf">max</span><span class="o">(</span><span class="n">value</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">+</span> <span class="n">Knapsack2</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span> <span class="o">-</span> <span class="n">weight</span><span class="o">[</span><span class="n">index</span><span class="o">],</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="o">),</span>
                    <span class="n">Knapsack2</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="o">));</span>
    <span class="o">}</span>

        <span class="c1">// two ways to solve it
</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">value</span> <span class="o">=</span> <span class="o">{</span><span class="mi">60</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">120</span><span class="o">};</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">weight</span> <span class="o">=</span> <span class="o">{</span><span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="o">};</span>
        <span class="kt">int</span> <span class="n">capacity</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dp</span><span class="o">.</span><span class="na">Knapsack1</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">number</span><span class="o">));</span> <span class="c1">// final result is 220
</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dp</span><span class="o">.</span><span class="na">Knapsack2</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">weight</span><span class="o">,</span> <span class="n">capacity</span><span class="o">,</span> <span class="n">index</span><span class="o">));</span>  <span class="c1">// final result is also 220</span></code></pre></figure>

<hr />

<h3 id="303-range-sum-quwey---immutable">303 Range Sum Quwey - Immutable</h3>

<ul>
  <li>
    <p><a href="https://leetcode.com/problems/range-sum-query-immutable/">Link</a></p>
  </li>
  <li>
    <p>About the meaning：Give an array that returns the value of any two range of ranges</p>
  </li>
  <li>
    <p>Idea: The rpblem content says <code class="highlighter-rouge">many calls to function</code>, so the traversal solution will definitely be <strong>TLE</strong>（Time Limit Exceeded); and <code class="highlighter-rouge">sum[i,j]=sum[j]-sum[i-1]</code> is obvious, so all the sums are found in one pass. After the value is done, subtraction is fine. Note you may need to use global variables</p>
  </li>
  <li>
    <p>code:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">// written in c++
// Using vector&lt;int&gt; to add status will be better
</span><span class="n">class</span> <span class="n">NumArray</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">dp</span><span class="p">[</span><span class="mi">100000</span><span class="p">];</span>
<span class="n">public</span><span class="o">:</span>
    <span class="n">NumArray</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">nums</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nums</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
            <span class="k">return</span> <span class="p">;</span>
        <span class="kt">int</span> <span class="n">length</span><span class="o">=</span><span class="n">nums</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">dp</span><span class="p">));</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">length</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">sumRange</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>    
    <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

<p>Writen in Python：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">NumArray</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nums</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dp</span> <span class="o">=</span> <span class="n">nums</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">nums</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">sumRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span></code></pre></figure>

<hr />

<h5 id="70-climbstatirs">70 climbStatirs</h5>

<ul>
  <li>
    <p><a href="https://leetcode.com/problems/climbing-stairs/">link</a></p>
  </li>
  <li>
    <p>About the meaning：Ascend a staircase, you can take 1 step or  take two steps.if you go to n steps, how many solutions will you have?</p>
  </li>
  <li>
    <p>Idea: Use dp[n] to indicate the number of methods to go to n steps. For dp[n-1], you can only choose to take 1 step; for dp[n-2],
If you choose 1+1, it will overlap with dp[n-1], you can only choose 2 steps.</p>
  </li>
  <li>
    <p>Code：</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">Written</span> <span class="n">in</span> <span class="n">C</span><span class="o">++</span>
<span class="n">class</span> <span class="n">Solution</span> <span class="p">{</span>
<span class="n">public</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">climbStairs</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">]);</span>
        <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># written in Python
</span>
<span class="k">class</span> <span class="nc">Solution</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="o">=</span><span class="p">{}</span>
        
    <span class="k">def</span> <span class="nf">climbStairs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>  </code></pre></figure>

<hr />

<h5 id="64-minimum-path-sum">64 Minimum Path Sum</h5>

<ul>
  <li>
    <p><a href="https://leetcode.com/problems/minimum-path-sum/">link</a></p>
  </li>
  <li>
    <p>About the meaning: <code class="highlighter-rouge">m*n</code> is a matrix of all positive numbers, which can be moved downwards to the right,find the sum of the distances from the upper left to the lower right.</p>
  </li>
  <li>
    <p>Idea: Dynamic programming.using dp[i][j] to represent the shortest number of steps taken with i, j as the last square.
Then <code class="highlighter-rouge">dp[i][j]=max(dp[i-1][j]+grid[i][j],dp[i][j-1]+gird[i][j]</code>,we just need to implement the equation.</p>
  </li>
  <li>
    <p>Code:</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">// written in C++
</span><span class="n">class</span> <span class="n">Solution</span> <span class="p">{</span>
<span class="n">public</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">minPathSum</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;&amp;</span> <span class="n">grid</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">grid</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">m</span><span class="o">=</span><span class="n">grid</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">dp</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">;</span>
        <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
        <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
                <span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span><span class="n">dp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
        <span class="k">return</span> <span class="n">dp</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">};</span></code></pre></figure>


        </div>
        
          <p class="post-continue">
            <a href="/2015/03/11/Dynamic-Programming-Explanation/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2014/11/21/some-techniques/">Mumbler About Techonology(Continually updated)</a>
          </h1>

          <p class="post-meta">Nov 21, 2014 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>Mumblers about technology…too short to write a novel</p>

<!-- more -->

<p><a href="/../translation/2014-11-21-some-techniques.html">这篇文章对应的中文版</a></p>

<p>About crypto,mainly I want to discuss the <code class="highlighter-rouge">Bitcoin arbitrage</code>,<code class="highlighter-rouge">Bitcoin storage, instability of external exchanges(such as binance)</code>,<code class="highlighter-rouge">relationship between concept、code and white paper</code></p>

<p>My bitcoin address is :<strong>1KAYM9K6M6Cp7RJwwr4K1m59ETPxB6o8n4</strong></p>

<p>Below is tredency of <code class="highlighter-rouge">EOS</code>:</p>

<p><img src="/images/EOS.jpg" alt="EOS.png" /></p>

<hr />

<p>I reviewed <code class="highlighter-rouge">Angular</code> yesterday and found a fantastic project which clearly states the logic of the FE framework.But</p>

<hr />

<p>Recently I’m writing java dedipher code,the initial part is written in Java：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"> <span class="kd">private</span> <span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">decrypt</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">key</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">SecureRandom</span> <span class="n">sr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecureRandom</span><span class="o">();</span>
        <span class="n">DESKeySpec</span> <span class="n">dks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DESKeySpec</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
        <span class="n">SecretKeyFactory</span> <span class="n">keyFactory</span> <span class="o">=</span> <span class="n">SecretKeyFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"DES"</span><span class="o">);</span>
        <span class="n">SecretKey</span> <span class="n">securekey</span> <span class="o">=</span> <span class="n">keyFactory</span><span class="o">.</span><span class="na">generateSecret</span><span class="o">(</span><span class="n">dks</span><span class="o">);</span>
        <span class="n">Cipher</span> <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"DES"</span><span class="o">);</span>
        <span class="n">cipher</span><span class="o">.</span><span class="na">init</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">securekey</span><span class="o">,</span> <span class="n">sr</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">cipher</span><span class="o">.</span><span class="na">doFinal</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="o">}</span></code></pre></figure>

<p>I need to translate it into Python.Thanks for <a href="https://www.tools4noobs.com/online_tools/decrypt/">decrypt</a> ，It can be implemented in 2 lines:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">decrypt_des</span><span class="p">(</span><span class="n">input_</span><span class="p">):</span>
    <span class="s">"""
    :param input_: ciphered text
    :return: DES deciphered text
    """</span>
    <span class="n">des</span> <span class="o">=</span> <span class="n">DES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">"naidnefi"</span><span class="p">,</span> <span class="n">DES</span><span class="o">.</span><span class="n">MODE_ECB</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">des</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">b64decode</span><span class="p">(</span><span class="n">input_</span><span class="p">))</span> <span class="k">if</span> <span class="mi">31</span> <span class="o">&lt;</span> <span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">127</span><span class="p">)</span></code></pre></figure>

<p>But the result contains much ‘\x5’，you can review <a href="http://donsnotes.com/tech/charsets/ascii.html">ascii</a> to get the exact meaning,solution is based on this link <a href="https://stackoverflow.com/questions/14256593/remove-special-characters-from-the-string">remove-special-characters-from-the-string</a></p>

<hr />

<p>Today I helped the algorithm team debug…weired… It was very troublesome to deal with Chinese with Python2, especially when using regular rules to adjust. After debugging a lot of unicode characters, It can finally run… The phenomenon is it can run in the test server , but cannot run in  the online server. Finally, I found this                                                <a href="https://stackoverflow.com/questions/1446347/how-to-find-out-if-python-is-compiled-with-ucs-2-or-ucs-4">ucs-2-or-ucs-4</a>. So the reason is that test server is compiled with ucs4, while online server is compiled with ucs2.</p>

<hr />

<p>subscribe the blog via <strong>IFTTT</strong> successfully,it can send the new blog into your email 
<img src="/images/rss.png" alt="rss.png" /></p>

<hr />

<p>Helping others to search for a foursquare data set. The starting link address is at <a href="http://www.public.asu.edu/~hgao16/dataset.html">dateset</a>, but the link is invalid. If you search with Google, you can find a reddit post in the corner of the page <a href="https://www.reddit .com/r/datasets/comments/1nywu2/foursquare_data_set/">foursquare_data_set</a>, which provides downloadable zip file,about 150M+.</p>

<hr />

<p>The most common function in StringUtils of Java is to make the first letter lowercase, which is usually implemented as this:.</p>

<p>There is an elegant answer in SO:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">char</span> <span class="n">c</span><span class="o">[]</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>
<span class="n">c</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">Character</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="n">string</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">c</span><span class="o">);</span></code></pre></figure>

<p>A tradeoff between performance and readability.</p>

<hr />

<p>Curator is a open source tool by Linkedin for zookeeper encapsulation that provides a variety of handy features, including updating configuration files and selecting leader nodes. There is an implementation on Spark.Corresponding code link is : <code class="highlighter-rouge">spark/core/src/main/scala/org/apache/spark/deploy/master/ZooKeeperPersistenceEngine.scala</code></p>

<hr />

<p>Some records.</p>

<p><strong>ETL</strong> means <strong>Extract-&gt;Transform-&gt;Load</strong></p>

<p>HDFS Data always comes from：</p>

<ul>
  <li>
    <p>Import from existing RDBMS database for business analysis.An example of the first tool is <a href="">Sqoop</a> from Apache.</p>
  </li>
  <li>
    <p>Connect and sample from existing HDFS data to generate new composite data</p>
  </li>
  <li>
    <p>Some other ways, including writing from HDF Sink in Flume, or using <code class="highlighter-rouge">hadoop fs -put</code> to import local files into HDFS</p>
  </li>
</ul>

<p>The second tool in most cases uses Hive to meet the requirements. Hive is a tool from FaceBook that converts HQL (SQL-like syntax) into MapReduce implementations for data analysts to manipulate. It actually is the symbol of the distributed SQL.There are many projetcts that are trying to do the distributed SQL query,such as <a href="https://spark.apache.org/">Spark</a> with scala and <a href="https://www.pingcap.com/en/">TiDB</a> with golang.But the basic steps are same,converting the AST(Abstarct Syntax Tree) into LogicalPlanner and execute it in multiple nodes.</p>

<p>Tthe scheduling system is also attractive. In principle, you just neet to write the execution script, set up the timing task directly with crontab. But on the one hand, we have to manage multiple scripts as the volume of business increases. On the other hand, we want to add progress reminders, logs view, failure retry, email alerts, and manage multiple interdependent tasks. In this case, <strong>Ozzie/Azkaban/Airflow</strong> and other projects are always best choices.</p>

<hr />

<p>How to implement the <code class="highlighter-rouge">join/left join/right join</code> in MapReduce ? you can review this question <a href="https://www.quora.com/How-does-Hive-implement-joins-in-Map-Reduce">How-does-Hive-implement-joins-in-Map-Reduce</a>.There are two cases:<code class="highlighter-rouge">Map-side</code> and <code class="highlighter-rouge">Reduce-side</code>.Usually you can use ArrayList to store MultiInput,but the obvious flaw is that the system will crash or hang when data are intensive.</p>

<hr />

<p>Trying to use GitLab CI today.It is not much different from Github’s travis-CI(distinguished by stages:build/deploy) in terms of personal experience. But the  problem happens below:</p>

<p><img src="/images/build-failure.png" alt="build-failure.png" />
Based on <a href="https://docs.gitlab.com/runner/install/linux-repository.html">link</a>,you need to install <strong>runner</strong> and <strong>Gitlab</strong> at the same server.</p>

<p>Record my <code class="highlighter-rouge">.gitlab-ci.yml</code> script:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>before_script:
    - sudo yum install maven2

stages:
    - build

build_job:
    stage: build
    script:
      - mvn install
      - mvn '-Dtest=com.xxx.example.*Test' test
</code></pre>
</div>

<p><code class="highlighter-rouge">mvn '-Dtest=com.xxx.example.*Test' test</code> is used to run all unit test in one package.</p>

<hr />

<p>Discovering that after IDEA is configured, you can’t use Socks5 to download SBT dependencies…After a few hours of trial,I give up to find the reason but to add <code class="highlighter-rouge">-Dhttps.proxyHost=127.0.0.1 -Dhttps.proxyPort=8080</code> in the SBT.Anyway it works……</p>

<hr />

<p>When debugging the Spark Streaming program in the Spark source code on your laptop, you need to change the corresponding <strong>VM Options</strong> to <code class="highlighter-rouge">-Dspark.master=local[2]</code>, otherwise
there will be an error like  <strong>netword connection refused</strong></p>

<hr />

<p>One of the most important features of a distributed system is that <strong>CAP</strong> cannot be met at the same time. The first link Google found was [Quora’s answer] (https://www.quora.com/Can-someone-provide-an-intuitive-proof-explanation-of-CAP-theorem), which mentioned a Very good [InfoQ article] (https://www.infoq.com/articles/cap-twelve-years-later-how-the-rules-have-changed), let me try to re-explain it. <strong>C</strong> refers to <strong>Consistency</strong>, <strong>A</strong> refers to <strong>Availability</strong>, and <strong>P</strong> refers to <strong>Partition Tolerance</strong>. Always we have to ensure that multiple nodes are running(preventing <a href="https://en.wikipedia.org/wiki/Single_point_of_failure">SPOF</a>, so <strong>P</strong> is definitely to be satisfied. For <strong>C</strong> and <strong>A</strong>, you can only choose one, for example:</p>

<blockquote>
  <p>A cluster has two machines, A and B (here simplified for the sake of example, in production environments it is usually required to be odd bigger than 1).
Whenever A/B has data written, it will be synchronized on B/A at the same time.
But suddenly the network connection has failed and communication between A and B is not possible. At this time, for A, there are two options:</p>
</blockquote>

<ol>
  <li>
    <p>In order to maintain consistency, external requests should not be accepted to ensure that data does not change, and availability cannot be met.</p>
  </li>
  <li>
    <p>In order to maintain availability and continue to accept requests, the data on the two machines will be inconsistent, and consistency will not be met.</p>
  </li>
</ol>

<p>At this time, most of the choices are to maintain external availability. The two machines continue to provide services to the outside world. When the communication can continue, the data is synchronized(you need a replication tool to achieve it,such as binlog of MySQL) .Thereby maintaining the eventual consistency.</p>

<p><img src="/images/CAP.jpg" alt="CAP.jpg" /></p>

<hr />

<p>There are several concepts when measuring the availability of a system, one is <strong>X 9</strong>. described as follows:</p>

<blockquote>
  <p>3 9: (1-99.9%) * 365 * 24 = 8.76 hours:
Indicates that the most likely business interruption time of the software system during continuous operation for one year is 8.76 hours.
4 9:(1-99.99%)<em>365</em>24=0.876 hours=52.6 minutes:
Indicates that the most likely business interruption time of the software system during continuous operation for 1 year is 52.6 minutes.
5 9: (1-99.999%) * 365 * 24 * 60 = 5.26 minutes:
Indicates that the most likely business interruption time of the software system during continuous operation for one year is 5.26 minutes.</p>
</blockquote>

<hr />

<p>I recently wrote a MapReduce program that parses out a bunch of variables to produce a string. Although I know there is a <code class="highlighter-rouge">join</code> method in the <code class="highlighter-rouge">Guava</code> library, and <code class="highlighter-rouge">hasNext()</code> is used to avoid the implementation of the delimiter at the end , but it is not proper to import a jar package for such a small function.I try to implement one:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">join</span><span class="o">(</span><span class="n">Character</span> <span class="n">separator</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">input</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">input</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"the input is illegal,check wheteris it's null or empty"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">_separator</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">separator</span><span class="o">);</span>
        <span class="n">StringBuilder</span> <span class="n">res</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">elem</span> <span class="o">:</span> <span class="n">input</span><span class="o">)</span>
            <span class="n">res</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">elem</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">_separator</span><span class="o">);</span>
        <span class="n">res</span><span class="o">.</span><span class="na">deleteCharAt</span><span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span></code></pre></figure>

<hr />

<p>If the log file is too large, it should be processed. If it is me, I would write a Python/Golang script.But today I was taught a new skill.You can just edit <strong>/etc/logrotate.conf</strong> file under Linux. compressing,Removing,time settings, various features…</p>

<hr />

<p>I’ve been reading <a href="http://120.25.204.125/">JStorm</a> source code recently, and there’s a block of code like this…kill the process 5 times…make sure the process be killed definitely(???</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">ensure_process_killed</span><span class="o">(</span><span class="n">Integer</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// in this function, just kill the process 5 times
</span>
        <span class="c1">// make sure the process be killed definitely
</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">exec_command</span><span class="o">(</span><span class="s">"kill -9 "</span> <span class="o">+</span> <span class="n">pid</span><span class="o">);</span>
                <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"kill -9 process "</span> <span class="o">+</span> <span class="n">pid</span><span class="o">);</span>
                <span class="n">sleepMs</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecuteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Error when trying to kill "</span> <span class="o">+</span> <span class="n">pid</span> <span class="o">+</span> <span class="s">". Process has been killed"</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Error when trying to kill "</span> <span class="o">+</span> <span class="n">pid</span> <span class="o">+</span> <span class="s">".Exception "</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span></code></pre></figure>

<hr />

<p>The two concepts of <code class="highlighter-rouge">concurrency</code> and <code class="highlighter-rouge">parallelism</code> are often confused.Having a summary about it: concurrency is for the design of the program. (<strong>concurrency as a property of a program or system</strong>), a well-designed concurrent program allows the program to perform different tasks in overlapping time periods. Parallelism refers to the parallelism as the <strong>run-time behaviour of the multiple tasks at the same time</strong>. So if a concurrent program runs on a single cpu machine, it is still concurrent, but not parallel.</p>

<p>This Chinese article that explains the best is in [here] (https://laike9m.com/blog/huan-zai-yi-huo-bing-fa-he-bing-xing), English novel is a talk about Go language <a href="https://talks.golang.org/2012/concurrency.slide">slide</a></p>

<hr />

<p>There is a 600M+ CSV file, because I need to experiment with conversion reads, so just splitting it by size. But after that, the file is garbled and can’t be presented in a proper way.  <code class="highlighter-rouge">head -10</code> read out is fine. I also suspect that I didn’t add a suffix, but the text file is not binary file…finally I realized that I shouldn’t divide it by size… I should use <code class="highlighter-rouge">split -l</code> to divide by line so it is conveniet for subquent merge.</p>

<p><img src="/images/青蛙.jpg" alt="无话可说" /></p>

<hr />

<p>Using <code class="highlighter-rouge">numpy.asarray() and numpy.fromarray()</code> to convert between the image and the matrix. Adding random number interference in the middle will make the font distorted, but this is more suitable for the recognition of handwriting. If it is a print for the photo, the appropriate method is to rotate a certain angle with rotate(). But there will be some black space, so just use crop() to intercept it.</p>

<hr />

<p>Although <a href="http://docs.python-requests.org/en/master/">requests</a> have been used all the time, I realize it today: <a href="http://sh3ll.me/2014/06/18/python-requests-encoding/">requests-code-read-content-auto-encode</a>. The principle of <code class="highlighter-rouge">chardet</code> recognition encoding was also mentioned in the 《Fluent Python》 before, based on the frequency of occurrence of the character prefix.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">chardet</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="s">'No longer plagued by coding problems 2333ShakaLaka!!!'</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'GBK'</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">{</span><span class="s">'confidence'</span><span class="p">:</span> <span class="mf">0.99</span><span class="p">,</span> <span class="s">'encoding'</span><span class="p">:</span> <span class="s">'GB2312'</span><span class="p">}</span></code></pre></figure>

<hr />

<p>There is a <code class="highlighter-rouge">user option</code> under the supervisor project configuration to choose which user to start the command with. But you must use the root account to start the supervisor.</p>

<hr />

<p>Previously, this file was created with a Windows text editor instead of notepad++,newline is represented with ‘\r\n’;and newLine in Linux is represented with ‘\n’. In other words, <code class="highlighter-rouge">Unix uses 0xA for a newline character. Windows uses a combination of two characters: 0xD 0xA. 0xD is the carriage return character. ^M happens to be the way vim displays 0xD.</code> (Refer to [this] (http://stackoverflow.com/questions/5843495/what-does-m-character-mean-in-vim)). The solution in the context of Py2 is to read it and then use<code class="highlighter-rouge"> strip()</code> to process it once.</p>

<hr />

<p>Kafka’s UI is installed, and the final selection is Yahoo’s <a href="https://github.com/yahoo/kafka-manager">Kafka Manager</a>. But it uses JDK8 … detecting the amount of message per unit time. The final interface is okay, that is, the strong Bootstrap style:</p>

<p><img src="/images/KafkaUI.png" alt="KafkaUI" /></p>

<hr />

<ul>
  <li>If you want to delete log files,<code class="highlighter-rouge">rm -rf  &amp;&amp; touch</code> is not a good choise.Using  <code class="highlighter-rouge">&gt; ToDelete.log</code> instead</li>
</ul>

<hr />

<ul>
  <li>Recently we use a plugin [elasticsearch-sql] (https://github.com/NLPchina/elasticsearch-sql) so querying the ES in the same way as sql is possible. But if you do not specify the number of limit when using <code class="highlighter-rouge">select</code> query, the default is always 200</li>
</ul>

<hr />

<ul>
  <li>There was a <a href="https://www.zhihu.com/question/38331955">question</a>.Recently I’m just learning Scala,So I tried to solve it:</li>
</ul>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">var</span> <span class="n">boyfriendList</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="mi">12</span><span class="o">)(</span><span class="mi">0</span><span class="o">)</span>

<span class="k">def</span> <span class="n">calculate</span><span class="o">(</span><span class="n">total</span><span class="k">:</span><span class="kt">Int</span><span class="o">=</span><span class="mi">0</span><span class="o">,</span><span class="n">freq</span><span class="k">:</span><span class="kt">Int</span><span class="o">=</span><span class="mi">0</span><span class="o">)</span><span class="k">:</span><span class="kt">Int</span> <span class="o">=</span> <span class="n">total</span> <span class="k">match</span> <span class="o">{</span>
    <span class="c1">// Using Pattern Matching
</span>    <span class="k">case</span> <span class="mi">12</span> <span class="k">=&gt;</span> <span class="o">{</span>
        <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Total number is $freq "</span><span class="o">)</span>
        <span class="n">freq</span>
    <span class="o">}</span>
    <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">{</span>
        <span class="n">boyfriendList</span><span class="o">(</span><span class="n">nextInt</span><span class="o">(</span><span class="mi">12</span><span class="o">))</span> <span class="k">=</span> <span class="mi">1</span>
        <span class="n">calculate</span><span class="o">(</span><span class="n">boyfriendList</span><span class="o">.</span><span class="n">sum</span><span class="o">,</span><span class="n">freq</span><span class="o">+</span><span class="mi">1</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Application</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>

    <span class="k">var</span> <span class="n">boyfriendList</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="mi">12</span><span class="o">)(</span><span class="mi">0</span><span class="o">)</span>
    <span class="k">var</span> <span class="n">index</span> <span class="k">=</span> <span class="mi">1</span>
    <span class="k">var</span> <span class="n">count</span> <span class="k">=</span> <span class="mi">0</span>
    <span class="k">while</span><span class="o">(</span><span class="n">index</span><span class="o">&lt;=</span><span class="mi">50</span><span class="o">){</span>
        <span class="n">boyfriendList</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="mi">12</span><span class="o">)(</span><span class="mi">0</span><span class="o">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="n">calculate</span><span class="o">()</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="o">}</span>
    <span class="n">println</span><span class="o">(</span><span class="n">sum</span><span class="o">.</span><span class="n">toFloat</span><span class="o">/</span><span class="mi">50</span><span class="o">)</span>  <span class="o">//</span> <span class="mf">34.64</span></code></pre></figure>

<hr />

<p>The group is discussing a problem about catching crawlers. Some people mentioned that they can simulate a search engine and searched for it…it is really reasonable, see this article [Google Crawler] (https://support.google.com/ Webmasters/answer/1061943?hl=en) , configure <code class="highlighter-rouge">UA</code> to <code class="highlighter-rouge">Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)</code></p>

<hr />

<p>In Python 2.6, an output statement <code class="highlighter-rouge">print '{}'.format(1)</code> will report an error, indicating <code class="highlighter-rouge">ValueError: zero length field name in format</code>.You must indicate the order, <code class="highlighter-rouge">print '{0}'.format(1)</code> . Ah… even 2.7 and 2.6 can’t be fully compatible</p>

<hr />

<p>There is  a very interesting question today. The logging is in the form of <strong>pageName&amp;{key1:value1,key2:value2}</strong>. Usually, spliting(“&amp;”)[1] is used to get the JSON string and then using <code class="highlighter-rouge">get_json_object</code> to check it. However, if there is more than one “&amp;” in the value provided (such as the url containing the parameter), then the separator will produce a string with only <code class="highlighter-rouge">""</code>.So I wrote a <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF">UDF:User Defined Function</a> to make the program robust.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/**
 * 
 * input:String
 * output:JSON-like Object
 */</span>

<span class="kn">import</span> <span class="nn">org.apache.hadoop.hive.ql.exec.UDF</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">dealJSONWithUrl</span> <span class="kd">extends</span> <span class="n">UDF</span> <span class="o">{</span>
    <span class="c1">// handling cases where url contains &amp; can't be split with split("&amp;")
</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">evaluate</span><span class="o">(</span><span class="n">String</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">input</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"&amp;"</span><span class="o">))</span>
            <span class="k">return</span> <span class="n">input</span><span class="o">;</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"&amp;"</span><span class="o">);</span>
        <span class="n">StringBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">temp</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">temp</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
                <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">temp</span><span class="o">[</span><span class="n">i</span><span class="o">]).</span><span class="na">append</span><span class="o">(</span><span class="s">"&amp;"</span><span class="o">);</span>
            <span class="k">else</span>
                <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">temp</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<hr />

<p>There are always some very tricky issues with crontab… Today my case is to use <code class="highlighter-rouge">redis-cli</code> to operate some instructions . When using the data, you can’t use <code class="highlighter-rouge">redis-cli</code> directly in the shell script, but you must use the Absolute path. there was also  a Python program which always didn’t work properly. The final reason is because <code class="highlighter-rouge">os.chdir('..')</code> is used in script file. You need to use  <code class="highlighter-rouge">cd</code> to enter into the target directory at first. There are  a lot of people who have stepped on this pit…such as <a href="https://www.digitalocean.com/community/questions/unable-to-execute-a-python-script-via-crontab-but-can -execute-it-manually-what-gives">unable-to-execute-a-python-script-via-crontab-but-can-execute-it-manually-what-gives</a>…The ability to specify <code class="highlighter-rouge">Directory</code> in supervisor is so wonderful by contrast</p>

<hr />

<p>For a while, the Sogou input method will inexplicably collapse, and suddenly it is impossible to input Chinese. I am uncapable of analyzing the source code,so just write a script like<code class="highlighter-rouge">alias sogou='pkill sogou-qimpanel &amp;&amp; fcitx &amp;&amp; sogou-qimpanel&amp;'</code> restart when there is a crash</p>

<hr />

<p>Using <code class="highlighter-rouge">row_number() over</code> to query group，and identifying it by row_id</p>

<hr />

<p>In the past I always  use <code class="highlighter-rouge">ssh-copy-id</code> to configure password-free login, generally set an alias in bash, such as <code class="highlighter-rouge">ssh-75='ssh root@10.10.8.75'</code>.today I learned a new skill today,you can directly match a config file in <code class="highlighter-rouge">~/.ssh.</code>. Take a look at <a href="https://www.cyberciti.biz/faq/create-ssh-config-file-on-linux-unix/">create-ssh-config-file-on-linux-unit</a></p>

<hr />

<p>The favorite command line tool on ubuntu is <code class="highlighter-rouge">guake</code>, using <code class="highlighter-rouge">F12</code> to call it with a single click, and using <code class="highlighter-rouge">tmux</code> to split screen.They are perfect couples. sometimes guake will suddenly become blank It’s fine to kill the process at this time, and some of the programs that were run before will still run. Of course, Programs like <code class="highlighter-rouge">shadowsocks</code> will remind you that the port is occupied, but <code class="highlighter-rouge">openvpn</code> will not tell you there is already an instance running.Reopening one will make you be kicked on the server…</p>

<hr />

<p>using a function of pip today.Downloading all the dependencies of the project and did not install it: <code class="highlighter-rouge">pip install --download /path module_name</code>,after uploading the file into a non-network-connect server, execute <code class="highlighter-rouge">pip insall --no-index -f /path module_name</code> to install</p>

<hr />

<p>It is also a problem with Hive time….. When the unix_timestamp is converted, if the time format is like <code class="highlighter-rouge">2016-06-27 11:00</code>, because there is no second, it is actually impossible to convert. But it  will not report an error when it is queried, so it will never have a satisfactory result. one solution is to query after using concat() to connect to <code class="highlighter-rouge">':', '00'</code> which will not affect the time.</p>

<hr />

<p>Java’s <a href="https://github.com/xetorthio/jedis">jedis</a> can only use <code class="highlighter-rouge">select</code> to select the library after getResource() gets the instance, but Python’s <a href="https://redislabs.com/lp/python-redis/">redis client</a> can be specified in the constructor.</p>

<hr />

<p>For Hive,if there are different time formats on different tables,you should convert like this:<code class="highlighter-rouge">from_unixtime(unix_timestamp('20160521','yyyyMMdd'),'yyyy-MM-dd')</code></p>

<hr />

<p>Writing a script that simulates logging into the Academic Affairs Office. After downloading the verification code and entering it into the command line… There is no flag that clearly shows the login result. Finally, I found that I can use the <code class="highlighter-rouge">Content-Type</code> of the return header to judge. if suffix is <code class="highlighter-rouge">gb2312</code> , logging is successful;if suffix is <code class="highlighter-rouge">GBK</code>,if failed. I wanted to analyze the class list again, but found that the result of the post request is a js function…so difficult to be parsed.And its login logic is not complete. After filling in a verification code, you can try to log in multiple times. According to initial rules, if you still have a six-digit password, you can definitely break the password after running up to 1000000 times,
<img src="/images/lesson-course-list.jpg" alt="lesson-course-list" />
<img src="/images/brute-force.jpg" alt="brute-force" /></p>

<hr />

<p>Installing Ubuntu image on VMWare encountered the problem that the desktop could not display the sidebar and top bar. Finally, it was solved by ccsm (<code class="highlighter-rouge">sudo apt-get install ccsm</code>, execute the software, and select Unity, execute, shutdown and restart)</p>

<hr />

<!-- 数万人的流离失所比不上一张孩童溺水的照片所引起的影响力大。心理学的理论再一次得到了令人心悸的验证。 -->

<!-- @tombkeeper 曾经在微博上发过这样一条状态： 很多人都想师从名家，但优秀的老师往往也很难容忍甘于平庸和疏于自律的学生。如果你没做好努力上几年的准备，也许一开始就不该选这样的老师  时时转发自省 -->

<!--
说好的出国已经成为泡影，整个的职业生涯规划都要因此改变。

《The House Of Cards》第一季第一季里Frank说"Never again will I allow me to be put into such a position"；

《TGW》里Alicia在独立办律所后向Cary大吼“You know what? go to hell"；

好多事情，只有亲身经历才能知道。高中时所犯的错误，以后绝不会再犯。

无限的沉迷于手机信息流的feed,no struggle for what you want，too care about others,and gain nearly nothing now,the body engineering.

The Promised Land.
-->

<!--Thanks for your advice  
All options are open to me
I will decide during the next 48 hours
-->

<!-- 本来在原著中是非常小的一段描写”石墩出动“，在电影中是非常壮观的一个场景。”Hogwarts is threatened.man the boundary,do the duty to our school"-->

<!--
每个人心里都有一个方向，由DNA所引发，一直到20岁都会持续变化，就是你所经历的事、遇到的人、走路的路，就是摩西所说的“promised land"。它的翻译“必见辽阔之地”一直被我认为是最好的翻译之一。在你经历过一天之后，你会清醒的知道它是否有助于你实现你的目标，即便你的潜意识里在否认。
-->

<!--
    * 2015.07.04 星期六

很少想到有一天压力竟然能这么大……

跑了5圈就已经受不了了。
-->

<p>Previously, when using Intellij IDEA and Pycharm, the theme from <a href="http://www.ideacolorthemes.org/home/">Intellij theme</a> has been used. Although the color matching is very good, it still has a gap with Sublime Text. I modified the color of the Line Comment, changing it to RGB (138, 130, 107).The color of the comment is light gray, and it is easier to distinguish it from the text. Sending an email to the original author,the email is sent back in seconds.</p>

<p><img src="/images/contact.JPG" alt="Email And Send" /></p>

<hr />

<p>Jkeyll even does not support the categories/tags collection under Pagination</p>

<blockquote>
  <p>Pagination does not support tags or categories.Pagination pages through every post in the posts variable regardless of variables defined in the YAML Front Matter of each. It does not currently allow paging over groups of posts linked by a common tag or category. It cannot include any collection of documents because it is restricted to posts.</p>
</blockquote>


        </div>
        
          <p class="post-continue">
            <a href="/2014/11/21/some-techniques/">Read on &rarr;</a>
          </p>
        
      </li>
    
      
      

      <li>
        <header class="post-header">
          <h1 class="post-title">
            <a class="post-link" href="/2014/06/22/Python-Multiprocessing-Multithreading/">One Line To Achieve MultiProcess and MultiThreads In Python</a>
          </h1>

          <p class="post-meta">Jun 22, 2014 • 
  
  

</p>
        </header>

        <div class="post-content">
          <p>Using <code class="highlighter-rouge">multiprocessing</code> and <code class="highlighter-rouge">multiprocessing.dummy</code> to implement multi-process and multi-threading, adding ThreadPoolExecutor and other content.</p>

<!-- more -->

<p><a href="/../translation/2014-06-22-Python-Multiprocessing-Multithreading.html">这篇文章对应的中文版</a></p>

<h4 id="just-add-one-line">Just Add One-line</h4>

<p>There is not much description about pros and cons between multiprocessing and Thread, because the key is that we want our code to be parallel:-D</p>

<p>Read this article [parallelism-in-one-line] (http://chriskiehl.com/article/parallelism-in-one-line/) to get a rough impression.</p>

<p>Providing an example written:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># -*- coding:utf-8 -*-
</span>

<span class="s">"""
calculate the md5 value for files under one directory
"""</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span> <span class="k">as</span> <span class="n">ProcessPool</span>
<span class="kn">from</span> <span class="nn">multiprocessing.dummy</span> <span class="kn">import</span> <span class="n">Pool</span> <span class="k">as</span> <span class="n">ThreadPool</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>


<span class="k">def</span> <span class="nf">traverse_dir</span><span class="p">(</span><span class="n">dir_</span><span class="o">=</span><span class="s">'/home/'</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">origin_dir</span><span class="p">,</span> <span class="n">current_dir</span><span class="p">,</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">dir_</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">origin_dir</span> <span class="o">+</span> <span class="n">file_</span>


<span class="k">def</span> <span class="nf">create_hash</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">file_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">traverse_dir</span><span class="p">())</span>
    <span class="c"># import random
</span>
    <span class="c"># random.shuffle(file_list)
</span>
    <span class="k">print</span> <span class="s">'There are {} files'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">))</span>
    <span class="n">time1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
        <span class="n">create_hash</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">'normal case: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">time1</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">ProcessPool</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">time2</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">pool</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">create_hash</span><span class="p">,</span> <span class="n">file_list</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">'multi-process case: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">time2</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">ThreadPool</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">time3</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">pool</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">create_hash</span><span class="p">,</span> <span class="n">file_list</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">'multi-thread: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">time3</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span></code></pre></figure>

<p>There are something to mention：</p>

<ul>
  <li>If the <code class="highlighter-rouge">shuflle</code> operation is performed on the generated file list to make the file unordered,then all the time will be longer. Explain that the thread is <code class="highlighter-rouge">I/O Bound</code> when it manipulates the file.</li>
</ul>

<p>Line 22 calculates the factorial from 1-300, which is very typical of CPU consumption. In this case the time health is:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>There are 403345 files
normal case: 16.230872
multi-process: 4.874608
multi-thread: 21.812273
</code></pre>
</div>
<p>There are obvious multi-process advantages on multi=progress. <code class="highlighter-rouge">4&lt;16&lt;21</code> it is not difficult to choose.</p>

<p>If we comment the line 22,then situation will be:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>There are 403365 files
normal case: 0.182251
multi-process: 0.39652
multi-thread: 0.234787
</code></pre>
</div>

<ul>
  <li>For security, you can add <code class="highlighter-rouge">pool.close() pool.join()</code> after map() . The role of <code class="highlighter-rouge">close()</code> is <code class="highlighter-rouge">Prevents any more tasks from being submitted to the pool. Once all the tasks have been completed , the worker processes will exit.</code>, <code class="highlighter-rouge">join</code> is <code class="highlighter-rouge">Wait for the worker processes to exit</code></li>
</ul>

<h5 id="lock">Lock</h5>

<p>The role of <code class="highlighter-rouge">Lock</code> is for some sensitive functions or variables, ensuring that only one process/thread is running. Also because Lock is not pickable, it cannot be passed as a parameter to map() . Use global variables directly to solve.</p>

<p>An example is as follows:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">multiprocessing.Lock</span>

<span class="n">l</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">func1</span><span class="p">():</span>
    <span class="c"># some key function
</span>
    <span class="n">l</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
    <span class="c"># do-something
</span>
    <span class="n">l</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">func2</span><span class="p">():</span>
    <span class="c"># or use next method
</span>
    <span class="k">with</span> <span class="n">l</span><span class="p">:</span>
        <span class="c"># do-something,it will release automatic</span></code></pre></figure>

<p><code class="highlighter-rouge">With lock</code> implements the context manager, which can be compared to Java’s <code class="highlighter-rouge">Synchronized</code> keyword. During the test, it was found that if all the functions to be executed were placed under lock, the execution time of multiple processes was even worse than the sequential execution.</p>

<h5 id="about-apply_async">About apply_async</h5>

<p>In the multiprocessing pool, <code class="highlighter-rouge">apply/apply_async</code> is provided in addition to map/map_async. The main differences include:</p>

<ul>
  <li>
    <p>map/map_async can accept a list containing a large number of arguments and send each element of the list to the function to be executed. Apply/apply_async only accepts one parameter like tuple, such as <code class="highlighter-rouge">(1,)</code></p>
  </li>
  <li>
    <p>map/apply is block-type, that is, the return time depends on the longest execution time and returns after all tasks have been executed. Map_async/apply_async returns an AsyncResult object when it starts executing the task, and then uses the <code class="highlighter-rouge">.get()</code> method to get the result.</p>
  </li>
  <li>
    <p>map_async/apply_async has one more parameter than map/apply: callback. Callback is a function that accepts only one parameter and is used to perform operations such as <code class="highlighter-rouge">write file/read into database</code> on the result of the execution.</p>
  </li>
  <li>
    <p>The two favorite ones are map and apply_async, where the output of map is the same as the order of the input, and the apply_async output is independent of the input order.</p>
  </li>
</ul>

<p>Make a simple comparison as follows:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="nb">reduce</span>

<span class="n">l</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">cal</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="c"># test lock 
</span>
    <span class="c"># with l:
</span>
    <span class="c">#     #print f
</span>
    <span class="c">#     for _ in range(f):
</span>
    <span class="c">#         temp = reduce(lambda x, y: x * y, range(1, 400))
</span>
    <span class="c">#     #temp = reduce(lambda x, y: x * y, range(1, f))
</span>
    <span class="c">#     return 2**f
</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">'{} occurs'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">40000</span><span class="p">))</span>
        <span class="c"># temp = reduce(lambda x, y: x * y, range(1, f))
</span>
    <span class="k">return</span> <span class="s">'calculate {} result is {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">2</span><span class="o">**</span><span class="n">f</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">'__main__'</span><span class="p">:</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">date3</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">cal</span><span class="p">,(</span><span class="n">x</span><span class="p">,))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)]:</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">'Total cost time is: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">date3</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="n">pool</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">date1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pool</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">cal</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)):</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">print</span> <span class="p">(</span><span class="s">'Total cost time is: {}'</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">date1</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span></code></pre></figure>

<p>Result of <code class="highlighter-rouge">pool.apply_async</code>. Each task returns result the moment it is finished.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1 occurs
2 occurs
3 occurs
4 occurs
calculate 1 result is 2
5 occurs
calculate 2 result is 4
6 occurs
calculate 3 result is 8
7 occurs
calculate 4 result is 16
8 occurs
calculate 5 result is 32
9 occurs
calculate 6 result is 64
calculate 7 result is 128
calculate 8 result is 256
calculate 9 result is 512
Total cost time is：5.700147

</code></pre>
</div>
<p>Result of <code class="highlighter-rouge">pool.map</code>. It is waiting for all results to be finished.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>1 occurs
2 occurs
3 occurs
4 occurs
5 occurs
6 occurs
7 occurs
8 occurs
9 occurs
// it will pause for a few seconds
calculate 1 result is 2
calculate 2 result is 4
calculate 3 result is 8
calculate 4 result is 16
calculate 5 result is 32
calculate 6 result is 64
calculate 7 result is 128
calculate 8 result is 256
calculate 9 result is 512
Total cost time is: 5.706731

</code></pre>
</div>

<p>Regarding performance, the time spent remain contant while doing a lot of testing So performance should not be a bottleneck. <code class="highlighter-rouge">Apply_async</code> is more suitable for occasions where you want immediate results.</p>

<h4 id="a-complicated-example">A Complicated Example</h4>

<p>The above method is sufficient for development in most cases. But if we want to have better control over multi-process/thread operations such as sharing state among different threads. we need to understand more.</p>

<p>I used to write an example of running with <code class="highlighter-rouge">mp.Process</code> and using <code class="highlighter-rouge">mp.Queue</code> as a queue, as shown below.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#!/usr/bin/env python
</span>
<span class="c"># -*- coding:utf-8 -*-
</span>

<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="kn">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">Queue</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">requests</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">task_queue</span><span class="p">,</span> <span class="n">result_queue</span><span class="p">,</span> <span class="n">visited_set</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">current_process</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># return an item if one is immediately available
</span>
            <span class="n">new_task</span> <span class="o">=</span> <span class="n">task_queue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">url</span><span class="o">=</span><span class="n">new_task</span>
            <span class="s">'''
            if not next_task:
                print '{} exiting'.format(next_task)
                task_queue.task_done()
                break
            '''</span>
        <span class="k">except</span> <span class="n">Queue</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>
            <span class="c"># task_queue.task_done()
</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="n">visited_set</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">'{}has been added'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">task_queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
            <span class="k">continue</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">crawl</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">'{}:{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">title</span><span class="p">)</span>
        <span class="n">visited_set</span><span class="p">[</span><span class="n">url</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">task_queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
        <span class="n">result_queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="k">return</span>


<span class="k">def</span> <span class="nf">crawl</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="c">#time.sleep(5.0/1000)
</span>
    <span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">title</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r'&lt;title&gt;(.*?).&lt;/title&gt;'</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">title</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">t1</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">tasks</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">JoinableQueue</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span>
    <span class="c"># completeFlag 
</span>
    <span class="n">vset</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="nb">dict</span><span class="p">()</span>

    <span class="n">num_consumers</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">print</span> <span class="s">'Creating {} consumers'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_consumers</span><span class="p">)</span>
    <span class="n">num_jobs</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="n">url_list</span><span class="o">=</span><span class="p">[</span><span class="s">'http://www.qunar.com'</span><span class="p">,</span><span class="s">'http://www.douban.com'</span><span class="p">,</span>
    <span class="s">'http://www.github.com'</span><span class="p">,</span><span class="s">'http://www.ctrip.com'</span><span class="p">,</span><span class="s">'http://www.v2ex.com'</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">url_list</span><span class="p">:</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url_list</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url_list</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="bp">False</span><span class="p">)</span>
    <span class="n">processes</span> <span class="o">=</span> <span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">vset</span><span class="p">))</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">num_consumers</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c"># wait until all the items in taskqueue are processed
</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">processes</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>


    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">False</span><span class="p">),</span>
        <span class="k">except</span> <span class="n">Queue</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">'stop'</span>
            <span class="k">break</span>

    <span class="k">print</span> <span class="s">'cost {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t1</span><span class="p">)</span></code></pre></figure>

<h4 id="threadprocess-and-poolexecutor-in-python3">Thread/Process And PoolExecutor In Python3</h4>

<p>Python3 provides a high-level abstraction。There are two ways to use:</p>

<h3 id="using-map">Using Map</h3>

<p>A standard example is：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">executor</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="n">create_hash</span><span class="p">,</span> <span class="n">file_list</span><span class="p">)</span></code></pre></figure>

<p>put it in the above example.The result is:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>normal case: 12.71012
multi-process case: 5.799454
multi-thread: 18.085609
ThreadPoolExecutor case: 18.403806
ProcessPoolExecutor case: 5.764657
</code></pre>
</div>

<p>In most cases,<code class="highlighter-rouge">ThreadPoolExecutor</code> and <code class="highlighter-rouge">ProcessPoolExecutor</code>, are less effective than <code class="highlighter-rouge">multiprocessing</code>. The reason can be referred to <a href="http://stackoverflow.com/questions/18671528/processpoolexecutor-from-concurrent-futures-way-slower-than-multiprocessing -pool">processpoolexecutor-from-concurrent-futures-way-slower-than-multiprocessing-pool</a> That is to say, the best application in PoolExecutor is to use submit() to monitor the results of instant updates instead of applying mp.</p>

<h5 id="using-submit">Using submit</h5>

<p>As mentioned above, the use of map for PoolExecutor is of little significance. The main discussion of submit is as follows.</p>

<p>It is obvious that you can see the shadow of Java. The best feature of the future feature is to return once it’s done, without having to wait for all blocking to return. It is more abstract than apply_async.</p>

<p>The example of the official website is slightly improved. It can be used as follows:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span><span class="n">as_completed</span>

<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">URLS</span> <span class="o">=</span> <span class="p">[</span><span class="s">'http://www.foxnews.com/'</span><span class="p">,</span>
        <span class="s">'http://www.cnn.com/'</span><span class="p">,</span>
        <span class="s">'http://europe.wsj.com/'</span><span class="p">,</span>
        <span class="s">'http://www.bbc.co.uk/'</span><span class="p">,</span>
        <span class="s">'http://some-made-up-domain.com/'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">load_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">future_to_url</span> <span class="o">=</span> <span class="p">{</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">load_url</span><span class="p">,</span><span class="n">url</span><span class="p">):</span><span class="n">url</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">URLS</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">future_to_url</span><span class="p">):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">future_to_url</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="k">print</span> <span class="p">(</span><span class="s">'raise exception'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="p">(</span><span class="s">'{url} content is {content}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">content</span><span class="o">=</span><span class="n">data</span><span class="p">))</span></code></pre></figure>

        </div>
        
          <p class="post-continue">
            <a href="/2014/06/22/Python-Multiprocessing-Multithreading/">Read on &rarr;</a>
          </p>
        
      </li>
    
  </ul>

  


</div>

        


    </main>
    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

Pro Land
    </p>

  </div>

</footer>


  </body>

</html>
