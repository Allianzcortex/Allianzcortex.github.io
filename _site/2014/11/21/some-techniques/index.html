<!DOCTYPE html>

<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>碎碎念...</title>
  <meta name="description" content="一些碎碎念…">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2014/11/21/some-techniques/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Allianzcortex-Blog" href="http://localhost:4000/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="hzcortex">
  <meta name="twitter:title" content="碎碎念...">
  <meta name="twitter:description" content="一些碎碎念…">
  
    <meta name="twitter:creator" content="hzcortex">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Allianzcortex-Blog</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="/projects/">Projects</a>
      
        
        <a class="page-link" href="/about/">About</a>
      
        
        <a class="page-link" href="/board/">board</a>
      
        
        <a class="page-link" href="/feed.xml">RSS</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">碎碎念...</h1>
    
    <p class="post-meta"><time datetime="2014-11-22T03:40:01+08:00" itemprop="datePublished">Nov 21, 2014</time> • 
  
  

</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>一些碎碎念…</p>

<!-- more -->

<ul>
  <li>
    <p>今天帮我司算法团队调一个 Bug，调的心好累……本来用 Python2 处理中文就很闹心，还要用正则来调。调试了一大堆 unicode 字符以后终于能跑了……结果在测试服务器能跑，在对方的线上服务器就不能跑，擦……最后搜到了这个 ！<a href="https://stackoverflow.com/questions/1446347/how-to-find-out-if-python-is-compiled-with-ucs-2-or-ucs-4">链接</a>，一试，果然……测试的是用 ucs4 编译的，而线上的是用 ucs2 编译的。两个有什么区别……我不知道啊……现在到家都已经 12 点了，我要睡觉……明天再说</p>
  </li>
  <li>
    <p>自从 Google Reader 解散之后就没有怎么再用过 RSS 了，但最近发现还是很有用啊，类似 Push 和 Pull。这个 <a href="http://wokuang-blog.logdown.com/posts/208334-use-gmail-to-read-rss-data">链接</a> 里说直接用 IFTTT 连接 Feedly 和 Gmail 就可以，但连接时候发现 IFTTT 必须要付费升级到 Pro 版才行。所以参考 <a href="http://www.jianshu.com/p/26b5c66e8546">简书的这篇文章</a>，连接 RSS 和 Gmail。不过 IFTTT 改版后界面需要在右上角的个人主页那里点击 <code class="highlighter-rouge">New Applet</code>。有些 rss 的地址不一定好找，那就用 feedly 订阅后再导出 opml 文件，找到里面的 xmlUrl 属性对应内容。最后的截图如下：</p>
  </li>
</ul>

<p><img src="/images/rss.png" alt="rss.png" /></p>

<ul>
  <li>
    <p>帮搜了一个 foursquare 的数据集。开始的链接地址是在 http://www.public.asu.edu/~hgao16/dataset.html，但链接失效了，用 Google 搜的话在犄角旮旯里找到个 reddit 的帖子 https://www.reddit.com/r/datasets/comments/1nywu2/foursquare_data_set/，里面到在 https://archive.org/download/201309_foursquare_dataset_umn 提供了下载zip 格式的文件，150M+。</p>
  </li>
  <li>
    <p>Java 上 StringUtils 里最常见的一个就是把首字母变成小写，一般来实现的话就是</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">firstCharToLower</span><span class="o">(</span><span class="n">String</span> <span class="n">input</span><span class="o">){</span>
    <span class="k">if</span><span class="o">(</span><span class="n">input</span> <span class="o">==</span> <span class="n">nulll</span><span class="o">)</span>
    
<span class="o">}</span></code></pre></figure>

<p>但 SO 上还有这么一个回答，提供了另一种思路：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">char</span> <span class="n">c</span><span class="o">[]</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>
<span class="n">c</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">Character</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">(</span><span class="n">c</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
<span class="n">string</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">c</span><span class="o">);</span></code></pre></figure>

<p>其实是以牺牲可读性来换取了性能的增加</p>

<ul>
  <li>
    <p>Curator 是 Linkedin 开源的一款对 zookeeper 封装的工具，里面提供了各种方便实现的功能，包括更新配置文件，选取 leader 节点等。今天在 Spark 上看见了这个实现，具体对应代码在：<code class="highlighter-rouge">spark/core/src/main/scala/org/apache/spark/deploy/master/ZooKeeperPersistenceEngine.scala</code></p>
  </li>
  <li>
    <p>最近又有需求，在 Ubuntu 环境下用 VirtualBox 重新安装了 Win8.1。具体</p>
  </li>
  <li>
    <p>今天试着用了一下 GitLab CI，从个人体验来说和 Github 的 travis-CI 没有什么太大区别啦，按照 stages 和 build/deploy 来区分，但最后问题发生在下面：
<img src="/images/build-failure.png" alt="build-failure.png" /></p>
  </li>
</ul>

<p>根据它的说法，你需要在安装 GitLab 的服务器上安装 Runner,参见 <a href="https://docs.gitlab.com/runner/install/linux-repository.html">这个</a>。但之前安装 GitLab 的人都不在了，既没有运维的权限，同时也没有像创业公司那样必须用 CI 的迫切性(不存在一天上线七八次这种情况啊……)。所以真的是……</p>

<p>最后把写的 .gitlab-ci.yml 脚本立此存照一下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>before_script:
    - sudo yum install maven2

stages:
    - build

build_job:
    stage: build
    script:
      - mvn install
      - mvn '-Dtest=com.xxx.example.*Test' test
</code></pre>
</div>

<p>其中 <code class="highlighter-rouge">mvn '-Dtest=com.xxx.example.*Test' test</code> 用来运行所有匹配的测试用例</p>

<ul>
  <li>
    <p>今天在讨论的时候知道阿里和百度都开始用 DL 来做 CRT 预估了，记得一段时间以前都在说深度学习都还是黑匣子，可解释性遭到 challenge 的话是不能在生产环境上用的，但转眼间都开始用了</p>
  </li>
  <li>
    <p>大部分讨论操作系统的问题最后都变成了要不要用 SSD 的问题……哇咔咔</p>
  </li>
  <li>
    <p>因为最近要从事的是现场办公，某司要访问开发环境的话，不能用 openvpn 或类似的工具，而是用启明星辰所提供的<a href="http://www.venustech.com.cn/SafeProductInfo/11/25.Html">天玥安全审计</a>。哼哧哼哧配好了 ip 和 dns 后(其中还踩了 Ubuntu Desktop 版不能直接用编辑配置文件方式修改 ip 的坑)，登陆到 Web 端来访问。但发现登陆工具怎么都选择不了，看了 css 以后发现选择器没问题啊……花了一天的时间各种配，最后申了一份当时发给运维的文档看，FAQ 里第一个就是：</p>
  </li>
</ul>

<blockquote>
  <p>问题1：如果我的操作系统是Linux或者是Mac的怎么办？
Linux和Mac系统的用户可以使用web界面操作，web地址为 ××××××，操作方法和windows客户端版是一样的，web存在兼容性问题，建议使用客户端版。</p>
</blockquote>

<p>我……</p>

<ul>
  <li>
    <p>发现 IDEA 配置好以后不能用设 Socks5 的方式来翻墙下载 SBT 的依赖，但 manual configuration 应该是没问题的啊。最后在 SBT 的参数里加上 ` -Dhttps.proxyHost=127.0.0.1  -Dhttps.proxyPort=8080`，:-(，但为什么不能用 IDEA 自带的配置呢？…….</p>
  </li>
  <li>
    <p>在调试 Spark 源码里面的 Spark Streaming 程序的时候，需要把对应的 <strong>VM Options</strong> 改为 <code class="highlighter-rouge">-Dspark.master=local[2]</code>，否则
就一直报 <strong>netword connection refused</strong> 的错误……</p>
  </li>
  <li>
    <p>分布式系统里一个最重要的特性就是 <strong>CAP</strong> 不能同时满足。Google 搜出来的第一个链接就是 <a href="https://www.quora.com/Can-someone-provide-an-intuitive-proof-explanation-of-CAP-theorem">Quora 的回答</a>，里面提到了一篇非常好的 <a href="https://www.infoq.com/articles/cap-twelve-years-later-how-the-rules-have-changed">InfoQ 文章</a>，我来试着理解一下。<strong>C</strong> 指的是 Consistency(一致性)，<strong>A</strong> 指的是 Availability(可用性)，<strong>P</strong> 指的是 Partition Tolerance(分区容忍性)。通常情况下我们必须要保证多节点运行，所以 <strong>P</strong> 是肯定要满足的。而对 <strong>C</strong> 和 <strong>A</strong>，就只能取舍一个，举例：</p>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>一个集群有两台机器，A 和 B(这里为了举例进行了简化，在生产环境中要求通常为大于 1 的奇数)。
每当 A/B 有数据写入，都会同时在 B/A 上同步过去。
但突然网络连接出现了故障，A 和 B 之间无法进行通信。这时候对 A 而言，有两种选择：

1. 为了保持一致性，就不应当再接受对外的请求来确保数据不发生变化，这时候可用性就无法得到满足。

2. 为了保持可用性，继续接受请求，那么两台机器上的数据就会不一致，这时候一致性就无法得到满足。

这时候大多数的选择都是保持对外的可用性，两台机器继续对外提供服务，当可以继续进行通信时再同步数据，
从而保持最终一致性(eventual consistency)。

</code></pre>
</div>

<p><img src="/images/CAP.jpg" alt="CAP.jpg" /></p>

<p>在衡量系统的 Availability 的时候有几个概念，一个就是 <strong>X 个9</strong>。说明如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>3个9：(1-99.9%)*365*24=8.76小时：
表示该软件系统在连续运行1年时间里最多可能的业务中断时间是8.76小时。
4个9：(1-99.99%)*365*24=0.876小时=52.6分钟：
表示该软件系统在连续运行1年时间里最多可能的业务中断时间是52.6分钟。
5个9：(1-99.999%)*365*24*60=5.26分钟：
表示该软件系统在连续运行1年时间里最多可能的业务中断时间是5.26分钟。

</code></pre>
</div>

<ul>
  <li>最近在写一个 MR 的程序，解析出一堆变量要产生一个字符串。虽然知道 <code class="highlighter-rouge">Guava</code> 库里有 <code class="highlighter-rouge">join</code> 方法，并且用 <code class="highlighter-rouge">hasNext()</code> 来避免结尾加上分隔符的实现高到不知道哪里去了，但就为了这么一个函数引入一个 jar 包是不是不太好啊⊙﹏⊙b。试着自己写一个，实现的稍微 tricky：</li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">join</span><span class="o">(</span><span class="n">Character</span> <span class="n">separator</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">input</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">input</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"the input is illegal,check wheteris it's null or empty"</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">_separator</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">separator</span><span class="o">);</span>
        <span class="n">StringBuilder</span> <span class="n">res</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">elem</span> <span class="o">:</span> <span class="n">input</span><span class="o">)</span>
            <span class="n">res</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">elem</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">_separator</span><span class="o">);</span>
        <span class="n">res</span><span class="o">.</span><span class="na">deleteCharAt</span><span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span></code></pre></figure>

<ul>
  <li>
    <p>日常日常超量的话要进行处理，如果是我的话估计就写个脚本了，但今天才被教做人…Linux 下的 <strong>/etc/logrotate.conf</strong> 直接进行编辑就好了，压缩，移除，时间设置，各种功能都有……</p>
  </li>
  <li>
    <p>最近在看 JStorm 的源码,其中有一段代码是这样的……kill the process 5 times……make sure the process be killed definitely……作者是个有故事的人……</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">ensure_process_killed</span><span class="o">(</span><span class="n">Integer</span> <span class="n">pid</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// in this function, just kill the process 5 times</span>
        <span class="c1">// make sure the process be killed definitely</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">exec_command</span><span class="o">(</span><span class="s">"kill -9 "</span> <span class="o">+</span> <span class="n">pid</span><span class="o">);</span>
                <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"kill -9 process "</span> <span class="o">+</span> <span class="n">pid</span><span class="o">);</span>
                <span class="n">sleepMs</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ExecuteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Error when trying to kill "</span> <span class="o">+</span> <span class="n">pid</span> <span class="o">+</span> <span class="s">". Process has been killed"</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">LOG</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Error when trying to kill "</span> <span class="o">+</span> <span class="n">pid</span> <span class="o">+</span> <span class="s">".Exception "</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span></code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">concurrency(并发)</code> 和 <code class="highlighter-rouge">parallelism(并行)</code> 两个概念常常混淆。今天又遇到了这个问题，结果发现为知里 2014 年就有这个记录了……好尴……那么用一句话来总结，就是说并发是针对程序的设计来讲的(concurrency as a property of a program or system)，一个设计良好的并发程序使得程序可以做到在重叠的时间段内执行不同任务。而并行指的是在实际运行中在物理上有多个任务在运行(parallelism as the run-time behaviour of executing multiple tasks at the same time)。所以如果一个并发的程序在一个单 cpu 的机器上运行，那么它仍然是并发的，但却不是并行。</li>
</ul>

<p>这个问题解释最好的中文文章在 <a href="https://laike9m.com/blog/huan-zai-yi-huo-bing-fa-he-bing-xing,61/">这里</a>，英文资料就是 Go 语言的那篇 <a href="https://talks.golang.org/2012/concurrency.slide">slide</a> 了</p>

<ul>
  <li>
    <p>除了 MongoDB 外 ES 也有被人黑啊……为了开发方便就不取消 <code class="highlighter-rouge">curl delete</code> 了，但必须只有内网能访问……到底是怎么做到每笔交易都是可回溯验证但无法关联到具体账户的……根据这个 <a href="https://blockchain.info/address/13zaxGVjj9MNc2jyvDRhLyYpkCh323MsMq">blockchain 地址</a> 看一下，收了 32 笔 0.2 BTC，总共 6.4 BTC，根据 2017.01.18-11:36 上午的汇率，等价 5696.64 $，也等价 39202.73 ¥……</p>
  </li>
  <li>
    <p>有一个 600M+ 的 CSV 文件，因为要实验转化读取，所以就用 split 来按大小分割一下。但之后怎么处理都是乱码，以为是源文件的问题，但 <code class="highlighter-rouge">head -10</code> 读出来也没问题啊。也怀疑是自己没有加后缀，但文本文件又不是二进制啊……最后才意识到不应该按大小来分割的……按大小来分割是为了方便后续合并啊……要用 <code class="highlighter-rouge">split -l</code> 按行来分……</p>
  </li>
</ul>

<p><img src="/images/青蛙.jpg" alt="无话可说" /></p>

<ul>
  <li>
    <p>所以到底发生了什么……为什么要用图片处理……今天遇到不少事情……比如说要用 <code class="highlighter-rouge">pillow</code> 来把一个字体显示到图像上。需要用到 ImageFont 的 TrueType ，下载 <code class="highlighter-rouge">simsun.ttc</code>，包含宋体和新宋体，但使用的时候会报 <code class="highlighter-rouge">OSError</code>的错误，无法识别 fileformat ，需要换成 Linux 下对应的字体。但如果用 <code class="highlighter-rouge">/usr/share/fonts/</code> 目录下的随便一个，又不会正常显示，只会出现 “?”。需要选择一个对中文支持友好的字体，可以在命令行里用 <code class="highlighter-rouge">fc-list :lang=zh-cn</code> 来找。用 <code class="highlighter-rouge">numpy.asarray() 和 numpy.fromarray()</code> 来做到在图像和矩阵之间相互转化，中间添加随机数干扰会让字体扭曲变形，但这个更适配于对手写体的识别。如果是对拍照的印刷体，合适的场景是用 rotate() 来旋转一定角度。但这样会出现一些黑色空间，用 crop()再截取一下就好了：-D</p>
  </li>
  <li>
    <p>虽然一直在用 requests，但今天才意识到可以这样: <a href="http://sh3ll.me/2014/06/18/python-requests-encoding/">requests-code-read-content-auto-encode</a>。关于 <code class="highlighter-rouge">chardet</code> 识别编码的原理之前在看《Fluent Python》的时候也提到过，根据字符前缀出现的频率来判定。</p>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>In [7]: chardet.detect('再也不被编码问题困扰了2333ShakaLaka!!!'.encode('GBK'))
Out[7]: {'confidence': 0.99, 'encoding': 'GB2312'}
</code></pre>
</div>
<ul>
  <li>
    <p>supervisor 项目配置下有一个 user 选项，可以选择以什么用户来启动命令。但是必须用 root 账号来启动 supervisor</p>
  </li>
  <li>
    <p>今天遇到了一个挺崩溃的问题。简单来说就是这样：数据校验的脚本有这样一句sql 查询:<code class="highlighter-rouge">count_sql = "select count(*) from...</code> 但 <code class="highlighter-rouge">print count_sql</code> 的时候总是会把第一个 ‘s’ 字符和最后的一个单引号 <code class="highlighter-rouge">'</code> 丢掉。查来查去最后甚至怀疑到了 <code class="highlighter-rouge">XShell</code> 的显示问题，但在我电脑上显示也不对，那就还是代码的问题。最后不用 print 来 debug 了，决定把 count_sql 写入到文件里来看(一直在用 Linux，读写模式里没有加 ‘b’…)，然后发现显示的语句后面多了一个 <code class="highlighter-rouge">^M</code>。问题就出在这里，以前创建这个文件的时候用的是 txt 文本编辑器而不是 notepad++，换行符用的是 ‘\r\n’，而 Linux 下用的是 ‘\n’。换句话来说就是 <code class="highlighter-rouge">Unix uses 0xA for a newline character. Windows uses a combination of two characters: 0xD 0xA. 0xD is the carriage return character. ^M happens to be the way vim displays 0xD.</code>(参考 <a href="http://stackoverflow.com/questions/5843495/what-does-m-character-mean-in-vim">这个</a>)。在 Py2 的范畴内解决办法就是读取后再用 strip() 处理一次。当然换到 Py3 就没有这个问题了(虽然离 2020 还有 3 年，但还是赶紧换啊啊啊)。这种问题还是第一次遇见，记录一下：-D</p>
  </li>
  <li>
    <p>装 Kafka 的 UI，最后选型用的是 Yahoo 的 Kafka Manager。但它要用的是 JDK8 …能检测单位时间内的信息量。最后界面还好啦，就是浓厚的 Bootstrap 风格让人不忍直视：</p>
  </li>
</ul>

<p><img src="/images/KafkaUI.png" alt="KafkaUI" /></p>

<p>同时补充一下 Centos 下安装 JDK8 的使用方法:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>① 在现有的环境下 java -version 显示 1.7.0,目录在 /usr/lib 下。参考 Ubuntu 上的安装经验，我们不希望它发生冲突，所以在 /opt 目录下安装。
② cd /opt,之后使用 
wget --no-cookies --no-check-certificate --header "Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie" "http://download.oracle.com/otn-pub/java/jdk/8u101-b13/jdk-8u101-linux-x64.tar.gz"
来安装,之后使用 tar -xzf jdk-8u101-linux-i586.tar.gz 来解压。
③ cd /opt/jdk1.8.0_101/ 来进入安装环境。java 提供了 alternatives 选项来允许在同一系统内存在多个 java 版本。执行 
alternatives --install /usr/bin/java java /opt/jdk1.8.0_101/bin/java 2 
来安装。执行 
alternatives --config java
来选择，只需要输入对应的编号即可（在 158 环境需要输入的是 3，对应的正是 /opt 对应的 JDK8）。执行 java -version 可以看到已经变为 1.8。
④ 接下来需要设置环境变量，直接执行下面三个命令：
export JAVA_HOME=/opt/jdk1.8.0_101
export JRE_HOME=/opt/jdk1.8.0_101/jre
export PATH=$PATH:/opt/jdk1.8.0_101/bin:/opt/jdk1.8.0_101/jre/bin

</code></pre>
</div>

<ul>
  <li>
    <p>准备去看 <code class="highlighter-rouge">《Web Analytics 2.0》 </code>了，虽然与技术关联不大，但没事的时候翻一番～～</p>
  </li>
  <li>
    <p>对于定时清空的日志文件，用命令 <code class="highlighter-rouge">&gt; ToDelete.log</code>…</p>
  </li>
  <li>
    <p>NLPchina 提供了一个 <a href="https://github.com/NLPchina/elasticsearch-sql">elasticsearch-sql</a> 的插件，能用类 sql 的方式来对 ES 进行查询。但用 <code class="highlighter-rouge">select</code> 查询的时候如果不指定 limit 的数量，默认始终是 200</p>
  </li>
  <li>
    <p>想起以前看过的一个挺有意思的 <a href="https://www.zhihu.com/question/38331955">问题</a>，刚好最近在学 Scala，试着写一个</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">var</span> <span class="n">boyfriendList</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="mi">12</span><span class="o">)(</span><span class="mi">0</span><span class="o">)</span>

<span class="k">def</span> <span class="n">calculate</span><span class="o">(</span><span class="n">total</span><span class="k">:</span><span class="kt">Int</span><span class="o">=</span><span class="mi">0</span><span class="o">,</span><span class="n">freq</span><span class="k">:</span><span class="kt">Int</span><span class="o">=</span><span class="mi">0</span><span class="o">)</span><span class="k">:</span><span class="kt">Int</span> <span class="o">=</span> <span class="n">total</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="mi">12</span> <span class="k">=&gt;</span> <span class="o">{</span>
        <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"总次数为 $freq "</span><span class="o">)</span>
        <span class="n">freq</span>
    <span class="o">}</span>
    <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">{</span>
        <span class="n">boyfriendList</span><span class="o">(</span><span class="n">nextInt</span><span class="o">(</span><span class="mi">12</span><span class="o">))</span> <span class="k">=</span> <span class="mi">1</span>
        <span class="n">calculate</span><span class="o">(</span><span class="n">boyfriendList</span><span class="o">.</span><span class="n">sum</span><span class="o">,</span><span class="n">freq</span><span class="o">+</span><span class="mi">1</span><span class="o">)</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Application</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>

    <span class="k">var</span> <span class="n">boyfriendList</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="mi">12</span><span class="o">)(</span><span class="mi">0</span><span class="o">)</span>
    <span class="k">var</span> <span class="n">index</span> <span class="k">=</span> <span class="mi">1</span>
    <span class="k">var</span> <span class="n">count</span> <span class="k">=</span> <span class="mi">0</span>
    <span class="k">while</span><span class="o">(</span><span class="n">index</span><span class="o">&lt;=</span><span class="mi">50</span><span class="o">){</span>
        <span class="n">boyfriendList</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="mi">12</span><span class="o">)(</span><span class="mi">0</span><span class="o">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="n">calculate</span><span class="o">()</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="o">}</span>
    <span class="n">println</span><span class="o">(</span><span class="n">sum</span><span class="o">.</span><span class="n">toFloat</span><span class="o">/</span><span class="mi">50</span><span class="o">)</span>  <span class="o">//</span> <span class="mf">34.64</span></code></pre></figure>

<p>啊，Pattern Matching 这里还比较好，但 var 和 val 变量这里自己做的太 tricky 了 ……</p>

<ul>
  <li>
    <p>今天群里在讨论爬虫被抓的一个问题，有人提到可以模拟搜索引擎，就搜了一下…还真有这种数据，看这个 <a href="https://support.google.com/webmasters/answer/1061943?hl=en">Google Crawler</a> ，把 <code class="highlighter-rouge">UA</code> 配置成 <code class="highlighter-rouge">Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)</code></p>
  </li>
  <li>
    <p>Python 2.6 里一个输出语句 <code class="highlighter-rouge">print '{}'.format(1)</code> 会报错，提示 <code class="highlighter-rouge">ValueError: zero length field name in format</code>，必须指明顺序，<code class="highlighter-rouge">print '{0}'.format(1)</code>。啊…连 2.7 和 2.6 都不能做到完全兼容，有毒…</p>
  </li>
  <li>
    <p>今天遇到一个挺有意思的问题。日志打码用的是 pageName&amp;{key1:value1,key2:value2} 的形式，通常情况下用 split(“&amp;”)[1] 得到 JSON 字符串后用 get_json_object 来查就可以了。但如果所提供的 value 里面有多个 “&amp;”(如含参的 url)，那么分隔开后就会产生只有一个 <code class="highlighter-rouge">"</code> 的字符串，读不出 JSON 格式。所以就写了一个 UDF 来解决(额，貌似 Hadoop.io.Text 效率比 Java 的 String 高……)</p>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="cm">/**
 * 主要处理 url 中包含 &amp; 从而不能用 split("&amp;") 来分割的情形
 * input:String
 * output:JSON-like Object
 */</span>

<span class="kn">import</span> <span class="nn">org.apache.hadoop.hive.ql.exec.UDF</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">dealJSONWithUrl</span> <span class="kd">extends</span> <span class="n">UDF</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">evaluate</span><span class="o">(</span><span class="n">String</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">input</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"&amp;"</span><span class="o">))</span>
            <span class="k">return</span> <span class="n">input</span><span class="o">;</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"&amp;"</span><span class="o">);</span>
        <span class="n">StringBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">temp</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">temp</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span>
                <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">temp</span><span class="o">[</span><span class="n">i</span><span class="o">]).</span><span class="na">append</span><span class="o">(</span><span class="s">"&amp;"</span><span class="o">);</span>
            <span class="k">else</span>
                <span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">temp</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<ul>
  <li>
    <p>crontab 总会有一些非常 tricky 的问题…今天遇到的是运维老师写的一个<code class="highlighter-rouge">redis-cli</code> 清数据的时候在 shell 脚本里不能直接用 <code class="highlighter-rouge">redis-cli</code>，而是一定要用绝对路径（线上服务器的绝对路径是在 <code class="highlighter-rouge">/usr/local/lib</code>，测试服务器上是 <code class="highlighter-rouge">/usr/bin</code>，后者可以在 shell 里直接删…所以是这个原因吗？）。还想起之前一个 Python 程序总是不能正常运行，最后发现是因为自己用了 <code class="highlighter-rouge">os.chdir('..')</code>，要先 <code class="highlighter-rouge">cd</code> 到目录再跑。这个坑踩过的人还不少啊…<a href="https://www.digitalocean.com/community/questions/unable-to-execute-a-python-script-via-crontab-but-can-execute-it-manually-what-gives">这个</a>…supervisor 里能指定 <code class="highlighter-rouge">Directory</code> 实在太幸福了…</p>
  </li>
  <li>
    <p>有一段时间搜狗输入法会莫名其妙崩溃，突然就无法输入中文了。没有办法，写了个 <code class="highlighter-rouge">alias sogou='pkill sogou-qimpanel &amp;&amp; fcitx &amp;&amp; sogou-qimpanel&amp;'</code> 的命令，一有崩溃就重启。</p>
  </li>
  <li>
    <p>上面说的这个故障应该是搜狗输入法云端输入后台的故障，因为大概在某一个时间段内同时在 PC 和自己的笔记本上遇到这个 Bug，在此之前和在此之后都没有能复现这个问题…</p>
  </li>
  <li>
    <p>row_number() over 查询分组，用 row_id 来选择指定</p>
  </li>
  <li>
    <p>之前用 <code class="highlighter-rouge">ssh-copy-id</code> 配置免密码登陆后一般都是在 bash 里面设置一个 alias，比如 <code class="highlighter-rouge">ssh-75='ssh root@10.10.8.75'</code> 这种，今天又学习了一点新的人生经验，可以在 ~/.ssh 里直接配一个 config 文件。看看 <a href="https://www.cyberciti.biz/faq/create-ssh-config-file-on-linux-unix/">create-ssh-config-file-on-linux-unit</a></p>
  </li>
  <li>
    <p>ubuntu 上最喜欢的命令行工具是 <code class="highlighter-rouge">guake</code>，<code class="highlighter-rouge">F12</code> 一键呼出，再配合上 <code class="highlighter-rouge">tmux</code> 分屏…可惜的是我不是纯 vim 党啊…有时候 guake 会突然变空白，这个时候杀掉进程就好了，但之前运行的一些程序会还运行。当然像 <code class="highlighter-rouge">shadowsocks</code> 这些程序会提醒你端口被占用，但 <code class="highlighter-rouge">openvpn</code> 是不会告诉你已经有一个实例运行了啊…再开一个就会造成你在服务器上动不动就被踢下去…</p>
  </li>
  <li>
    <p>今天用到了 pip 的一个功能… 把所有项目的依赖下下来并且不安装: <code class="highlighter-rouge">pip install --download /path module_name</code>，scp 上传后用
<code class="highlighter-rouge">pip insall --no-index -f /path module_name</code> 来安装</p>
  </li>
  <li>
    <p>又是 Hive 时间的问题…..在 unix_timestamp 转化时，如果时间格式如 <code class="highlighter-rouge">2016-06-27 11:00</code> 因为没有秒数，所以实际上是无法进行转化的。它查询时也不会报错，但也永远不会有合乎要求的结果。最后用 concat() 连接上不会影响时间的 <code class="highlighter-rouge">':','00'</code>再查。</p>
  </li>
  <li>
    <p>需要用 JStorm 调用一个运维接口来发短信。但只有 Nimbus 服务器可以发短信，Supervisor 服务器没有对应的权限（host 地址设置问题）。这种分布式的问题总是由奇奇怪怪的原因产生…</p>
  </li>
  <li>
    <p>Java 的 jedis 只能在 getResource() 取得实例后再用 select 来选择分库，但 Python 的 redis client 是可以在构造函数里就指定的。</p>
  </li>
  <li>
    <p>有时间要学学 docker 啊，真的要能统一开发环境和生产环境，那就很厉害了…</p>
  </li>
  <li>
    <p>踩了 Hive SQL 的一个坑，不同表的时间格式不一样，转的时候要这么用：from_unixtime(unix_timestamp(‘20160521’,’yyyyMMdd’),’yyyy-MM-dd’)</p>
  </li>
  <li>
    <p>Gunicorn 部署。一个空格引发的惨案，噗</p>
  </li>
  <li>
    <p>Anaconda 突然发现 .condarc 好像不起作用了，不从清华的源安装。看了看 <code class="highlighter-rouge">conda install -h</code>，用 <code class="highlighter-rouge">--channel https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</code> 来指定以后就可以了。还有问题是提示没有权限，，，看了一下，文件上显示锁，chown + chmod ~~</p>
  </li>
  <li>
    <p>几百行的 SQL 到底是怎么维护</p>
  </li>
</ul>

<hr />

<ul>
  <li>
    <p>等待毕设结果，有些焦虑……写了个模拟登陆教务处的脚本，下载完验证码后输入到命令行中……没有能明确显示登陆结果的标志，最后发现可以用返回 header 的 Content-Type 来判断，如果后缀是 <code class="highlighter-rouge">gb2312</code> 就登陆成功，而后缀是 <code class="highlighter-rouge">GBK</code> 就登录失败(好奇葩是不是……当时是谁写的这个网站⊙﹏⊙b)。本来想再分析一下课表的，但发现 post 请求的结果是一个 js 函数……竟然有这种 Web 开发方式……虽然也能解析但……还是算了……并且它的登陆逻辑是有问题的啊，填完一次验证码后就能多次尝试登陆，按照大多数人的习惯，如果还是六位数密码，那么最多跑 10**6 次就肯定能破出密码来~~~
<img src="/images/lesson-course-list.jpg" alt="lesson-course-list" />
<img src="/images/brute-force.jpg" alt="brute-force" /></p>
  </li>
  <li>
    <p>花在写论文上的时间比在代码上的时间还多：-D</p>
  </li>
  <li>
    <p>中期答辩前终于把简化版的结果做出来了…但中文字符前都会有一个 u’’ Unicode 标识符，影响美观</p>
  </li>
  <li>
    <p>为何要作死…用 <code class="highlighter-rouge">sudo shutdown now</code> 来关机,然后黑屏状态-&gt;强制关机-&gt;重启后发现怎么输入密码都不对.重装系统…</p>
  </li>
  <li>
    <p>用 ubuntu 用多了会在某些时候觉得真的不方便啊,大概是 auto-remove 和 purge 之间的混乱关系,或者是自己编译 OpenSSL 和安装后的 OpenSSL 产生冲突…<code class="highlighter-rouge">Arch wiki</code>能和 <code class="highlighter-rouge">ask ubuntu</code> 提供一样的帮助,随时升级内核比不敢 <code class="highlighter-rouge">upgrade</code> 高到不知道哪里去了…但路径依赖…再在这上面折腾就太耗时间了…</p>
  </li>
  <li>
    <p>被 STL 的 Vector 坑大了==&gt;!!!!</p>
  </li>
  <li>
    <p>Sublime 的列操作，<code class="highlighter-rouge">ctrl + shift + L</code></p>
  </li>
  <li>
    <p>Windows 下的命令行终端还是推荐 cmder，能使用 <code class="highlighter-rouge">cd/ls</code> 等常用命令，切换磁盘(以D盘为例)请直接用 <code class="highlighter-rouge">D:</code>，要使中文字符不产生缩进可以选择右侧的设置(ctrl+alt+p),勾选 monospace 为不使用状态，并且自带对 git 的支持。再也不用 <code class="highlighter-rouge">git bash</code> 了…</p>
  </li>
  <li>
    <p>在 VMWare 上安装 Ubuntu 镜像遇到了桌面无法显示边栏和顶栏问题，最后用的是 ccsm 来解决(<code class="highlighter-rouge">sudo apt-get install ccsm</code>，执行软件，并选中 Unity，执行，关机重启)</p>
  </li>
</ul>

<!-- 数万人的流离失所比不上一张孩童溺水的照片所引起的影响力大。心理学的理论再一次得到了令人心悸的验证。 -->

<!-- @tombkeeper 曾经在微博上发过这样一条状态： 很多人都想师从名家，但优秀的老师往往也很难容忍甘于平庸和疏于自律的学生。如果你没做好努力上几年的准备，也许一开始就不该选这样的老师  时时转发自省 -->

<!--
说好的出国已经成为泡影，整个的职业生涯规划都要因此改变。

《The House Of Cards》第一季第一季里Frank说"Never again will I allow me to be put into such a position"；

《TGW》里Alicia在独立办律所后向Cary大吼“You know what? go to hell"；

好多事情，只有亲身经历才能知道。高中时所犯的错误，以后绝不会再犯。

无限的沉迷于手机信息流的feed,no struggle for what you want，too care about others,and gain nearly nothing now,the body engineering.

The Promised Land.
-->

<!--Thanks for your advice  
All options are open to me
I will decide during the next 48 hours
-->

<!-- 本来在原著中是非常小的一段描写”石墩出动“，在电影中是非常壮观的一个场景。”Hogwarts is threatened.man the boundary,do the duty to our school"-->

<!--
每个人心里都有一个方向，由DNA所引发，一直到20岁都会持续变化，就是你所经历的事、遇到的人、走路的路，就是摩西所说的“promised land"。它的翻译“必见辽阔之地”一直被我认为是最好的翻译之一。在你经历过一天之后，你会清醒的知道它是否有助于你实现你的目标，即便你的潜意识里在否认。
-->

<!--
    * 2015.07.04 星期六

很少想到有一天压力竟然能这么大……

跑了5圈就已经受不了了。
-->

<ul>
  <li>之前在用 Intellij IDEA 和 Pycharm 时候一直用的是 Sublime Text2 的配色，来自<a href="http://www.ideacolorthemes.org/home/">Intellij theme</a>虽然配色很好，但还是和 ST 有差距。今天修改了一下 Line Comment 的颜色，改成 RGB(138,130,107)，评论颜色为淡灰色，更容易和正文区分开，给原作者发了封邮件，邮件秒回，发邮件这个真的是美帝人民的天赋技能…自己当时是怎么写出 is not very good 这种小学英语的…我的天…</li>
</ul>

<p><img src="/images/contact.JPG" alt="Email And Send" /></p>

<ul>
  <li>jkeyll竟然不支持Pagination下的categories/tags 集合，试了半天啊…</li>
</ul>

<blockquote>
  <p>Pagination does not support tags or categories.Pagination pages through every post in the posts variable regardless of variables defined in the YAML Front Matter of each. It does not currently allow paging over groups of posts linked by a common tag or category. It cannot include any collection of documents because it is restricted to posts.</p>
</blockquote>

<ul>
  <li>
    <p>计算机系统结构试验要求是用WInDLX平台来模拟，现在才知道不同平台汇编语言标准不统一…其他语言都是标准一样实现不一样的</p>
  </li>
  <li>
    <p>计算机网络实验，用微软的 network monitor 来监控，用 display fliter 来过滤，但是为什么不用 fiddler 呀</p>
  </li>
  <li>
    <p>手写 Parser 和 Token …</p>
  </li>
  <li>
    <p>写《通信原理》的结课论文，发现一本扫描版的书也给搜出来了，Google…OCR…ORZ…</p>
  </li>
</ul>

<hr />


  </div>

</article>

        
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'allianzcortex-me'; // required: replace example with your forum shortname
        // var disqus_developer = 1; // Comment out when the site is live
        var disqus_identifier = "/2014/11/21/some-techniques/";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



    </main>
    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

Pro Land
    </p>

  </div>

</footer>


  </body>

</html>
