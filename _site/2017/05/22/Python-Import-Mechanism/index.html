<!DOCTYPE html>

<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>The Import Mechanism Of Python And Two Related Problems</title>
  <meta name="description" content="How to solve No module named and Attempted relative import ? 这篇文章对应的中文版 No module named This problem ever happened when executed with the command line, but the application can be executed smoothly with the Pycharm run button. The error is also very simple to debug, just check the show command line afterwards in the edit configuration item of Pycharm, and then execute the import sys; sys.path command. Compare the options in the command line,you will find the former has Added a module for /home/hzcortex/projects.... In other words, Python does not add the directory where the script executes the command to sys.path. The solution is to add the following code in the directory where error happened: import sys from os import path sys.path.append(path.dirname(path.dirname(path.abspath(__file__)))) Attempted relative import in non package There are two types of issues to discuss: 1 A circular reference does occur. A wants to reference B, B wants to reference C, and C also refers to a function in B. The normal solution at this point is to modify the reference order of the C files and put the import statement before the statement that needs to use the reference object (see 《Fluent Python》). I recently encountered this problem when developing [FBRank] (https://github.com/Allianzcortex/FBRank). The project structure is like : └── utils ├── exceptions.py ├── __init__.py # utils.py from .exceptions import NotSupprotedYetException def check_before(attr=&#39;name&#39;): ... raise NotSupprotedYetException ... # exceptions.py from .utils import github_url, connect_url class NotSupprotedYetException(FBRankException): &quot;&quot;&quot;still not supprt &quot;&quot;&quot; Then there was such an error when executing the program: File &quot;/home/hzcortex/FBRank/FBRank/parse/League.py&quot;, line 13, in &amp;lt;module&amp;gt; from FBRank.utils.exceptions import IllegalArgumentException, NotSupprotedYetException File &quot;/home/hzcortex/FBRank/FBRank/utils/exceptions.py&quot;, line 2, in &amp;lt;module&amp;gt; from .utils import github_url, connect_url File &quot;/home/hzcortex/FBRank/FBRank/utils/utils.py&quot;, line 5, in &amp;lt;module&amp;gt; from .exceptions import NotSupprotedYetException ImportError: cannot import name &#39;NotSupprotedYetException&#39; Looking at the order of the calls from top to bottom, the github_url, connect_url variables are called from .utils.py in /exceptions.py, and NotSupprotedYetException is called from /exceptions.py when calling .utils.py. This will cycle through each other and will never solve the import issue. The solution is to load it only when you need to use the function: # utils.py def check_before(attr=&#39;name&#39;): from .exceptions import NotSupprotedYetException # ...... Because Python’s reference mechanism does not reimport previously imported packages (use imp.reaload() if needed), so don’t worry about performance problem. If there is really no circular reference, problem maybe is mainly because: Take an example of a program push data from Kafka to ES that was previously written. The structure of the whole program is as follows In the main program RealtimeLogToES.py there are the following references: Go to the RLTES directory and execute python RealtimeLogToES.py directly in this case, then the above circular reference error will be reported. There are two solutions: 1 Change from .config import to the same absolute reference as below, from RLTES.config import 2 Do not modify the code, return to the previous directory, cd .., and then execute python -m RLTES.RealtimeLogToES When Python is relatively introduced, the basis for the judgment is the __name__ attribute of the current file. When you execute a file, the original __name__ attribute of the file is replaced by the fixed &#39;__main__&#39;, so the relative introduction does not work, while the absolute introduction is fine. After adding -m to the command line, tell the Python interpreter to run this file as a script. Why the problem happened If there is sufficient time,I will try to explain it. Now you can read PEP302 to hava a straightforward impression. How We Do Properly The recommendation in PEP8 is to always use absolute references, but just like the annoying double underscore, there are a lot of people who prefer to use relative import. The key is to Keep the team consistent. As for personal development, I prefer to use .import for single layer and absolute reference for others. In the book “Two Scopes Of Django” , it is stipulated that the use of the **implicit import statement such as from A import a is forbidden, but considering that many times the script will not be specific to a large project but to create a directory on the server to complete a specific function or solve a temporary problem(don’t need to maintain), if this is convenient for debugging and deployment,it can also be a good choice,done is better than perfect after all. The role of __init__.py The most important role of __init__.py is to mark the folder containing the __init__.py directory as a package to complete the corresponding import. In most cases, there is no need to write anything in __init__.py. If you must write it, it basically has the following three functions: Write __author__ and other related information Write a __all__ configuration that exactly defines what will be introduced when from x import * If the first two are irrelevant, then the last one is much more important, and the importing method can be simplified to control the stability of the API. Let me still take the example of [FBRank] (github.com/Allianzcortex/FBRank). Although you see that the command line tool is only supported in the README, it also provides the ability to import it in the code. for example: If you need to assign the corresponding file if you need to import an exception In [1]: from FBRank.utils.exceptions import IllegalArgumentException But if you want to import a class, you only need to identify the corresponding package, which is very convenient for subsequent development. In [2]: from FBRank.object import Club The key it the following code in __init__.py of FBRank/object folder.Import something from package is equal to import something from file under this package. from .League import League from .Club import Club from .Player import Player">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2017/05/22/Python-Import-Mechanism/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Allianzcortex-Blog" href="http://localhost:4000/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="hzcortex">
  <meta name="twitter:title" content="The Import Mechanism Of Python And Two Related Problems">
  <meta name="twitter:description" content="How to solve No module named and Attempted relative import ? 这篇文章对应的中文版 No module named This problem ever happened when executed with the command line, but the application can be executed smoothly ...">
  
    <meta name="twitter:creator" content="hzcortex">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Allianzcortex-Blog</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="/projects/">Projects</a>
      
        
        <a class="page-link" href="/about/">About</a>
      
        
        <a class="page-link" href="/board/">board</a>
      
        
        <a class="page-link" href="/feed.xml">RSS</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">The Import Mechanism Of Python And Two Related Problems</h1>
    
    <p class="post-meta"><time datetime="2017-05-22T10:29:10-03:00" itemprop="datePublished">May 22, 2017</time> • 
  
  

</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>How to solve <code class="highlighter-rouge">No module named</code> and <code class="highlighter-rouge">Attempted relative import</code> ?</p>

<!-- more -->

<p><a href="/../translation/2017-05-22-Python-Import-Mechanism.html">这篇文章对应的中文版</a></p>

<h3 id="no-module-named">No module named</h3>

<p>This problem ever happened when executed with the command line, but the application can be executed smoothly with the Pycharm run button. The error is also very simple to debug, just check the <strong>show command line afterwards</strong> in the edit configuration item of Pycharm, and then execute the <code class="highlighter-rouge">import sys; sys.path</code> command. Compare the options in the command line,you will find the former has Added a module for <code class="highlighter-rouge">/home/hzcortex/projects...</code>. In other words, Python does not add the directory where the script executes the command to sys.path.</p>

<hr />

<p>The solution is to add the following code in the directory where error happened:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))))</span></code></pre></figure>

<h3 id="attempted-relative-import-in-non--package">Attempted relative import in non  package</h3>

<p>There are two types of issues to discuss:</p>

<p>1 A circular reference does occur. A wants to reference B, B wants to reference C, and C also refers to a function in B. The normal solution at this point is to modify the reference order of the C files and put the <code class="highlighter-rouge">import</code> statement before the statement that needs to use the reference object (see 《Fluent Python》). I recently encountered this problem when developing [FBRank] (https://github.com/Allianzcortex/FBRank). The project structure is like :</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="err">└──</span> <span class="n">utils</span>
    <span class="err">├──</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">py</span>
    <span class="err">├──</span> <span class="n">__init__</span><span class="o">.</span><span class="n">py</span>

<span class="c"># utils.py
</span>
 <span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">NotSupprotedYetException</span>

<span class="k">def</span> <span class="nf">check_before</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s">'name'</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">raise</span> <span class="n">NotSupprotedYetException</span>
    <span class="o">...</span>

<span class="c"># exceptions.py
</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">github_url</span><span class="p">,</span> <span class="n">connect_url</span>

<span class="k">class</span> <span class="nc">NotSupprotedYetException</span><span class="p">(</span><span class="n">FBRankException</span><span class="p">):</span>
    <span class="s">"""still not supprt
    """</span></code></pre></figure>

<p>Then there was such an error when executing the program:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>File "/home/hzcortex/FBRank/FBRank/parse/League.py", line 13, in &lt;module&gt;
    from FBRank.utils.exceptions import IllegalArgumentException, NotSupprotedYetException
  File "/home/hzcortex/FBRank/FBRank/utils/exceptions.py", line 2, in &lt;module&gt;
    from .utils import github_url, connect_url
  File "/home/hzcortex/FBRank/FBRank/utils/utils.py", line 5, in &lt;module&gt;
    from .exceptions import NotSupprotedYetException
ImportError: cannot import name 'NotSupprotedYetException'

</code></pre>
</div>

<p>Looking at the order of the calls from top to bottom, the <code class="highlighter-rouge">github_url, connect_url</code> variables are called from .utils.py in /exceptions.py, and <strong>NotSupprotedYetException</strong> is called from /exceptions.py when calling .utils.py. This will cycle through each other and will never solve the <strong>import issue</strong>. The solution is to load it only when you need to use the function:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># utils.py
</span>

<span class="k">def</span> <span class="nf">check_before</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s">'name'</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">NotSupprotedYetException</span>
    <span class="c"># ......</span></code></pre></figure>

<p>Because Python’s reference mechanism does not reimport previously imported packages (use <code class="highlighter-rouge">imp.reaload()</code> if needed), so don’t worry about performance problem.</p>

<ol>
  <li>If there is really no circular reference, problem maybe is mainly because:</li>
</ol>

<p>Take an example of a program push data from Kafka to ES that was previously written. The structure of the whole program is as follows</p>

<p><img src="/images/RLTES-2.png" alt="RLTES-Project" /></p>

<p>In the main program <code class="highlighter-rouge">RealtimeLogToES.py</code> there are the following references:</p>

<p><img src="/images/RLTES-1.png" alt="RLTES-import" /></p>

<p>Go to the RLTES directory and execute <code class="highlighter-rouge">python RealtimeLogToES.py</code> directly in this case, then the above circular reference error will be reported.</p>

<p>There are two solutions:</p>

<p>1 Change <code class="highlighter-rouge">from .config import</code> to the same absolute reference as below, <code class="highlighter-rouge">from RLTES.config import</code></p>

<p>2 Do not modify the code, return to the previous directory, <code class="highlighter-rouge">cd ..</code>, and then execute <code class="highlighter-rouge">python -m RLTES.RealtimeLogToES</code></p>

<p>When Python is relatively introduced, the basis for the judgment is the <code class="highlighter-rouge">__name__</code> attribute of the current file. When you execute a file, the original <code class="highlighter-rouge">__name__</code> attribute of the file is replaced by the fixed <code class="highlighter-rouge">'__main__'</code>, so the relative introduction does not work, while the absolute introduction is fine. After adding -m to the command line, tell the Python interpreter to run this file as a script.</p>

<h3 id="why-the-problem-happened">Why the problem happened</h3>

<p>If there is sufficient time,I will try to explain it. Now you can read <a href="https://www.python.org/dev/peps/pep-0302/">PEP302</a> to hava a straightforward impression.</p>

<h3 id="how-we-do-properly">How We Do Properly</h3>

<p>The recommendation in PEP8 is to always use absolute references, but just like the <code class="highlighter-rouge">annoying double underscore</code>, there are a lot of people who prefer to use relative import.</p>

<p>The key is to Keep the team consistent. As for personal development, I prefer to use <code class="highlighter-rouge">.import</code> for single layer and absolute reference for others.</p>

<p>In the book “Two Scopes Of Django” <strong>, it is stipulated that the use of the **implicit import</strong> statement such as <code class="highlighter-rouge">from A import a</code> is forbidden, but considering that many times the script will not be specific to a large project but to create a directory on the server to complete a specific function or solve a temporary problem(don’t need to maintain), if this is convenient for debugging and deployment,it can also be a good choice,done is better than perfect after all.</p>

<h3 id="the-role-of-__init__py">The role of <code class="highlighter-rouge">__init__.py</code></h3>

<p>The most important role of <code class="highlighter-rouge">__init__.py</code> is to mark the folder containing the <code class="highlighter-rouge">__init__.py</code> directory as a package to complete the corresponding import.</p>

<p>In most cases, there is no need to write anything in <code class="highlighter-rouge">__init__.py</code>. If you must write it, it basically has the following three functions:</p>

<ul>
  <li>
    <p>Write <code class="highlighter-rouge">__author__</code> and other related information</p>
  </li>
  <li>
    <p>Write a <code class="highlighter-rouge">__all__</code> configuration that exactly defines what will be introduced when <code class="highlighter-rouge">from x import *</code></p>
  </li>
  <li>
    <p>If the first two are irrelevant, then the last one is much more important, and the importing method can be simplified to control the stability of the API.</p>
  </li>
</ul>

<p>Let me still take the example of [FBRank] (github.com/Allianzcortex/FBRank). Although you see that the command line tool is only supported in the README, it also provides the ability to import it in the code. for example:</p>

<p>If you need to assign the corresponding file if you need to  import an exception</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"> <span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">FBRank.utils.exceptions</span> <span class="kn">import</span> <span class="n">IllegalArgumentException</span></code></pre></figure>

<p>But if you want to import a class, you only need to identify the corresponding package, which is very convenient for subsequent development.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">FBRank.object</span> <span class="kn">import</span> <span class="n">Club</span></code></pre></figure>

<p>The key it  the following code in <code class="highlighter-rouge">__init__.py</code> of FBRank/object folder.Import something from package is equal to import something from file under this package.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">  <span class="kn">from</span> <span class="nn">.League</span> <span class="kn">import</span> <span class="n">League</span>
  <span class="kn">from</span> <span class="nn">.Club</span> <span class="kn">import</span> <span class="n">Club</span>
  <span class="kn">from</span> <span class="nn">.Player</span> <span class="kn">import</span> <span class="n">Player</span></code></pre></figure>


  </div>

</article>

        
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'allianzcortex-me'; // required: replace example with your forum shortname
        // var disqus_developer = 1; // Comment out when the site is live
        var disqus_identifier = "/2017/05/22/Python-Import-Mechanism/";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



    </main>
    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

Pro Land
    </p>

  </div>

</footer>


  </body>

</html>
