<!DOCTYPE html>

<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Data Visualizations With Flask and Highcharts</title>
  <meta name="description" content="A data visualization using the back-end Flask and front-end Highcharts 这篇文章对应的中文版 What Happened Our company uses Alibaba’s open source zeus and combines scripts to build a schedule system. There was a phenomenon of sudden collapse of the job in the evening (the early warning SMS burst), and the data could only be rewashed during the day. After research, it is found that the task is way too intensive in a certain period of time and excessive parallel pressure is the cause. The time of the ods/mds/ads table needs to be reasonably distributed. However, the zeus system itself does not provide the function of the query scheduling task, so it is necessary to implement the visualization of a task distribution. Flask Backend Framework Although usually I’m used to use Django, but it is too heavy as a Full-Stack Framework,the registration and login functions inside will not be used. So I switch to Flask:query from MySQL in real time, convert the result with the built-in jsonify and return it to the front-end page. Zeus’s scheduling time format is similar to crontab, so in order to generate the required data directly on the backend, it should convert the time into an int value. such as: original time show time 0 10 1（means 1:10） 110 0 16 0 （means 12:16） 16 0 30 23（means evening 11:30） 2330 If the time does not meet the four positions when you look at it, you need to complete the leading zero to see. The core of time is as follows: for row in cur.fetchall(): key = row[1].split() if key[2]!=&#39;0&#39; and key[1]==&#39;0&#39;: key=10*int(key[2]+key[1]) else: key = int(key[2] + key[1]) configuring post data: @app.route(&#39;/timeserialize&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;]) def get_json(): # calculate some data return jsonify(result) Highcharts FrontEnd Framework There are two famous visualization framework,one is Echarts opensourced by Baidu,and the other is Highcharts opensourced by Google(D3.js is mainly for animation).I choose the latter one. Adding the resource files firstly. &amp;lt;script src=&quot;http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js&quot;&amp;gt;&amp;lt;/script&amp;gt; &amp;lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;&quot;&amp;gt; &amp;lt;!-- jquery.min.js must put before highcharts.js 之前 --&amp;gt; &amp;lt;script src=&quot;&quot;&amp;gt;&amp;lt;/script&amp;gt; &amp;lt;script src=&quot;&quot;&amp;gt;&amp;lt;/script&amp;gt; Then use jquery to configure JSON data in POST format. &amp;lt;script&amp;gt; $(function () { $.getJSON(&#39;/timeserialize&#39;, function (data) { /*$.getJSON(&#39;/configure&#39;, function (data) {*/ $(&#39;#container&#39;).highcharts({ // legend,option...data }); }); }); &amp;lt;/script&amp;gt; First Version The display after the first version is as follows： The number of points refers to the number of jobs running at the current point in time. Drag and drop to see changes in a finer time dimension. Second Version After combining the obtained time format and the specific number of seconds, You can get the specific execution time of the task, and transfer it to unixtime and pass it to the front end, then turn it to specific time, the visual effect will be better. The key is to add a function to the JSON format in $function(). var jsonData = data; var jsonDataSuccess = new Array(); var jsonDataFailed = new Array(); # ... tempArray.push(parseInt(jsonData[i].startTime) + 28800000,parseInt(jsonData[i].spendTime)); # ... In the series, use two types to mark: series:[{ name:&#39;success&#39;, color:&#39;rgb(119,152,191)&#39;, data:jsonDataSuccess, },{ name:&#39;failed&#39;, color:&#39;rgb(255,0,0)&#39;, data:jsonDataFailed } ] Using the formatter() option in tooltip to return a more friendly expression: tooltip:{ formatter: function() { //... return &#39;jobid :&#39; + jobId + &#39;&amp;lt;br&amp;gt;&#39; + &quot;jobName:&quot; + jobName + &#39;&amp;lt;br&amp;gt;&#39; + &#39;starttime :&#39; + startTime } } The resulting visualization results are as follows:">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2016/09/08/Data-Visualize-With-Flask-And-Highcharts/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Allianzcortex-Blog" href="http://localhost:4000/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="hzcortex">
  <meta name="twitter:title" content="Data Visualizations With Flask and Highcharts">
  <meta name="twitter:description" content="A data visualization using the back-end Flask and front-end Highcharts 这篇文章对应的中文版 What Happened Our company uses Alibaba’s open source zeus and combines scripts to build a schedule system. There wa...">
  
    <meta name="twitter:creator" content="hzcortex">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Allianzcortex-Blog</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="/projects/">Projects</a>
      
        
        <a class="page-link" href="/about/">About</a>
      
        
        <a class="page-link" href="/board/">board</a>
      
        
        <a class="page-link" href="/feed.xml">RSS</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Data Visualizations With Flask and Highcharts</h1>
    
    <p class="post-meta"><time datetime="2016-09-08T11:30:05-03:00" itemprop="datePublished">Sep 8, 2016</time> • 
  
  

</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>A data visualization using the back-end Flask and front-end Highcharts</p>

<p><a href="/../translation/2016-09-08-Data-Visualize-With-Flask-And-Highcharts.html">这篇文章对应的中文版</a></p>

<!-- more -->

<h4 id="what-happened">What Happened</h4>

<p>Our company uses Alibaba’s open source <code class="highlighter-rouge">zeus</code> and combines scripts to build a schedule system. There was a phenomenon of sudden collapse of the job in the evening (the early warning SMS burst), and the data could only be rewashed during the day. After research, it is found that the task is way too intensive in a certain period of time and excessive parallel pressure is the cause. The time of the <code class="highlighter-rouge">ods/mds/ads</code> table needs to be reasonably distributed. However, the zeus system itself does not provide the function of the query scheduling task, so it is necessary to implement the visualization of a task distribution.</p>

<h4 id="flask-backend-framework">Flask Backend Framework</h4>

<p>Although usually I’m used to use <code class="highlighter-rouge">Django</code>, but it is too heavy as a <code class="highlighter-rouge">Full-Stack Framework</code>,the registration and login functions inside will not be used. So I switch to Flask:query from MySQL in real time, convert the result with the built-in <code class="highlighter-rouge">jsonify</code> and return it to the front-end page.</p>

<p>Zeus’s scheduling time format is similar to <code class="highlighter-rouge">crontab</code>, so in order to generate the required data directly on the backend, it should convert the time into an <code class="highlighter-rouge">int</code> value. such as:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>original time    show time
0 10 1（means 1:10） 110
0 16 0 （means 12:16）   16
0 30 23（means evening 11:30） 2330
</code></pre>
</div>
<p>If the time does not meet the four positions when you look at it, you need to complete the leading zero to see.</p>

<p>The core of time is as follows:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">():</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">!=</span><span class="s">'0'</span> <span class="ow">and</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s">'0'</span><span class="p">:</span>
        <span class="n">key</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></code></pre></figure>

<p>configuring post data:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s">'/timeserialize'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_json</span><span class="p">():</span>
    <span class="c"># calculate some data
</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></code></pre></figure>

<h4 id="highcharts-frontend-framework">Highcharts FrontEnd Framework</h4>

<p>There are two famous visualization framework,one is <a href="https://ecomfe.github.io/echarts-doc/public/en/index.html">Echarts</a> opensourced by Baidu,and the other is <a href="https://www.highcharts.com/">Highcharts</a> opensourced by Google(D3.js is mainly for animation).I choose the latter one.</p>

<p>Adding the resource files firstly.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"&gt;&lt;/script&gt;
    &lt;link rel="stylesheet" type="text/css" href=""&gt;
    &lt;!-- jquery.min.js must put before highcharts.js 之前 --&gt;
    &lt;script src=""&gt;&lt;/script&gt;
    &lt;script src=""&gt;&lt;/script&gt;

</code></pre>
</div>

<p>Then use <code class="highlighter-rouge">jquery</code> to configure JSON data in POST format.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;script&gt;
$(function () {
    $.getJSON('/timeserialize', function (data) {
    /*$.getJSON('/configure', function (data) {*/
        $('#container').highcharts({
            // legend,option...data
        });
    });
});
&lt;/script&gt;


</code></pre>
</div>

<h4 id="first-version">First Version</h4>

<p>The display after the first version is as follows：</p>

<p><img src="/images/figure-1.png" alt="figure-1" /></p>

<p><img src="/images/figure-2.png" alt="figure-2" /></p>

<p>The number of points refers to the number of jobs running at the current point in time. Drag and drop to see changes in a finer time dimension.</p>

<h4 id="second-version">Second Version</h4>

<p>After combining the obtained time format and the specific number of seconds,
You can get the specific execution time of the task, and transfer it to unixtime and pass it to the front end, then turn it to specific time, the visual effect will be better.</p>

<p>The key is to add a function to the JSON format in <code class="highlighter-rouge">$function()</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>var jsonData = data;
var jsonDataSuccess = new Array();
var jsonDataFailed = new Array();
# ...
tempArray.push(parseInt(jsonData[i].startTime) + 28800000,parseInt(jsonData[i].spendTime));
# ...
</code></pre>
</div>

<p>In the <code class="highlighter-rouge">series</code>, use two types to mark:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    series:[{
            name:'success',
            color:'rgb(119,152,191)',
            data:jsonDataSuccess,
            },{
            name:'failed',
            color:'rgb(255,0,0)',
            data:jsonDataFailed
            }
                    ]
</code></pre>
</div>

<p>Using the formatter() option in <code class="highlighter-rouge">tooltip</code> to return a more friendly expression:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>tooltip:{
    formatter: function() {
        //...
        return 'jobid :' + jobId + '&lt;br&gt;' + "jobName:" + jobName + '&lt;br&gt;'  + 'starttime :' + startTime
    }
}
</code></pre>
</div>

<p>The resulting visualization results are as follows:</p>

<p><img src="/images/figure-3.png" alt="figure-3" /></p>


  </div>

</article>

        


    </main>
    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

Pro Land
    </p>

  </div>

</footer>


  </body>

</html>
