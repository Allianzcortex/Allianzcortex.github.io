<!DOCTYPE html>

<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Django 学习及 cortexForum</title>
  <meta name="description" content="关于 Django 的学习资料以及 cortexForum">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2015/10/21/Django-And-CortexForum/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Allianzcortex-Blog" href="http://localhost:4000/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="hzcortex">
  <meta name="twitter:title" content="Django 学习及 cortexForum">
  <meta name="twitter:description" content="关于 Django 的学习资料以及 cortexForum">
  
    <meta name="twitter:creator" content="hzcortex">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Allianzcortex-Blog</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="/projects/">Projects</a>
      
        
        <a class="page-link" href="/about/">About</a>
      
        
        <a class="page-link" href="/board/">board</a>
      
        
        <a class="page-link" href="/feed.xml">RSS</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Django 学习及 cortexForum</h1>
    
    <p class="post-meta"><time datetime="2015-10-22T04:39:49+08:00" itemprop="datePublished">Oct 21, 2015</time> • 
  
  

</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>关于 Django 的学习资料以及 cortexForum</p>

<!-- more -->

<h5 id="学习资料">学习资料</h5>

<p>主要看的是 Django 的官方 tutorial 和 <a href="http://www.tangowithdjango.com/book17/">tango with Django</a></p>

<p>进阶的书包括：</p>

<ul>
  <li>
    <p>《Two Scopes of Django》:Django 作者是 Django 的社区开发者，汇聚了一大批的最佳实践</p>
  </li>
  <li>
    <p>《Test Driven Web Development》:以 TDD(测试驱动开发) 方式所写的关于 Django 开发的一本书，非常漂亮啊</p>
  </li>
</ul>

<hr />

<h5 id="cortexforum">cortexForum</h5>

<p>在文档的学习过程中所有遇到的问题和有必要的记录都在 Wiznote 里保存，方便进行复习balabala</p>

<p>最近在做毕设的过程中实在是看不下去论文了，便有了写一个有 Django 最佳实践的论坛的想法。在写 <a href="https://github.com/Allianzcortex/cortexForum">cortexForum</a> 的过程中，自己尽量实现了以下几点：</p>

<ul>
  <li>
    <p>在代码中将所用到的文档模块和对应的具体用法进行标志，方便查找</p>
  </li>
  <li>
    <p>标注中有 SO 的部分说明它很常用，并且 stackoverflow 上有相关的问题(比如query_set() 里的 lookup field)</p>
  </li>
  <li>
    <p>对于有多种解决方法的部分都在注释里写了出来(比如 <code class="highlighter-rouge">objects.filer().update 和 instance.save()</code>)</p>
  </li>
  <li>
    <p>用 gitbook 的格式作为 wiki，对于 forum 的设计有这样一个总体的概述</p>
  </li>
</ul>

<hr />

<ul>
  <li>Django 的 models 模型里有一个 Manager 对象，非常方便实现 OOP(实现 HighLevel 而不仅仅是具体实例的行为)，以发帖的单位 Topic 为例，定义发帖的 title 和 content 之后，再定义两个外键，一个是 node,定义帖子发表的节点；一个是 author，定义帖子发表的作者。对于一个帖子来说，我希望能通过一个 node 的名称(这里可以理解为 slug )，或者一个作者的名称(username)，就能得到所有主题的信息，所以你就需要定义：</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">get_all_topic_by_node_slug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_slug</span><span class="p">):</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">node__slug</span><span class="o">=</span><span class="n">node_slug</span><span class="p">)</span><span class="o">.</span> \
            <span class="n">select_related</span><span class="p">(</span><span class="s">'node'</span><span class="p">,</span> <span class="s">'author'</span><span class="p">,</span> <span class="s">'last_replied_by'</span><span class="p">)</span><span class="o">.</span> \
            <span class="n">order_by</span><span class="p">(</span><span class="s">'-last_replied_time'</span><span class="p">,</span> <span class="s">'-reply_count'</span><span class="p">,</span> <span class="s">'-created_at'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">query</span></code></pre></figure>

<p>通过 queryset() 的重定义，你可以用 <code class="highlighter-rouge">Node.objects.get_all_topic_by_node_slug('slug-example')</code> 来获取主题信息。而如果你不这样做的话，就需要在每个 views 的函数里来多次重新定义，并且一旦模型发生更改就很难再修正过来了，比 hard-coded 还复杂的重写。</p>

<p>而 form 里没有为我们定义更高层次的抽象，但并不妨碍我们进行 OOP，以 authen 的 registrationForm 为例，我们在 forms 里进行了 <code class="highlighter-rouge">clean_username</code>,<code class="highlighter-rouge">clean_mail</code>,重写了默认的 clean 方法，在进行 <code class="highlighter-rouge">is_valid()</code> 验证的时候就会直接提出错误信息。</p>

<hr />

<p>在前端方面，自己完全采用 bootstrap 的架构。</p>

<p>关于手写 HTML 还是用 <code class="highlighter-rouge">Crispyforms/Django-bootstrap3 </code>，这种东西见仁见智，我觉得还是用纯粹的手写 HTML 比较好，因为这样的解决方式是前后端分离的，在下次学习其他框架的时候也能用到，你只需要传给前端需要用到的 API 就行。</p>

<p>比如</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"id_"</span> <span class="na">class=</span><span class="s">"col-md-3 control-label"</span><span class="nt">&gt;&lt;/label&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-9"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"id_"</span> <span class="na">required</span> <span class="na">name=</span><span class="s">""</span> <span class="na">autofocus</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"help-block"</span><span class="nt">&gt;</span>请输入你的用户名<span class="nt">&lt;/p&gt;</span>

```<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"id_"</span> <span class="na">class=</span><span class="s">"col-md-3 control-label"</span><span class="nt">&gt;&lt;/label&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-9"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"id_"</span> <span class="na">required</span> <span class="na">name=</span><span class="s">""</span> <span class="na">autofocus</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"help-block"</span><span class="nt">&gt;</span>请输入你的用户名<span class="nt">&lt;/p&gt;</span></code></pre></figure>

<p>就要比 <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">form.as_p</span><span class="w"> </span><span class="p">}</span></code> 或者 <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">crispy</span><span class="w"> </span><span class="err">form</span><span class="w"> </span><span class="p">}</span><span class="w"> </span></code>更能实现定制化，crispy-forms 的思想是在 forms 里设置 layout 和对应的 label，想要更新前端显示需要在后端修改代码而不是 CSS 文件……</p>

<hr />

<p>Mysql 问题还是挺多的。一开始的情况下，英文发帖是正常的。之后按照 <a href="hthttps://blog.ionelmc.ro/2014/12/28/terrible-choices-mysql/tps://blog.ionelmc.ro/2014/12/28/terrible-choices-mysql/">mysql-utf-8</a> 里的方法采用 utf-8 编码之后就会发生只有管理员可以正常发帖，而其他用户在发帖时会提醒 second column not exists ,SO 上的解决方法都没有效果，最后分析下觉得有可能是因为 user 和 forumUser 对应的 id 不对其造成的，所以手动添加一个 request.User 后解决问题。</p>

<p>下次还是用 PG 吧……为什么第一次用 onetooneField 的时候就没有这种错误？要用 abstractUser 去扩展 User 模型去……</p>

<hr />

  </div>

</article>

        
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'allianzcortex-me'; // required: replace example with your forum shortname
        // var disqus_developer = 1; // Comment out when the site is live
        var disqus_identifier = "/2015/10/21/Django-And-CortexForum/";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



    </main>
    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

Pro Land
    </p>

  </div>

</footer>


  </body>

</html>
