<!DOCTYPE html>

<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  
  <title>Develop a desktop client with PyQT</title>
  <meta name="description" content="In this novel,I’ll demonstrate how to read the database and display it , with Python’s dynamic mechanism and Qt’s signal slot. 这篇文章对应的中文版 This is a program that can detect network connections. The screenshot of the interface is as follows There will be very few opportunities to write the client in the future(I mean many professional clients are mainly developed by C#/.net,although actually dropbox developed its’ client with PyQT)… So I won’t pursue the best practices. I just need to make a poke-marked GUI .⊙﹏⊙b UI and interface corresponding PyQt itself is similar to Qt’s signal slot mechanism. When a button is clicked, a signal is sent and the processing mechanism of the signal needs to be defined. The design interface is designed directly with the designer. Drag button/listview/model and customize the name. After generating the .ui file, use pyuic4 –x ping_ui.ui –o ping_ui.py to see that the ping_ui.py file contains class Ui_Form(object), which has various lengths/locations defined. It’s More convenient than handwriting Then define a pyqt_example2.py which contains the following files: class CalculateForm(QWidget): def __init__(self, parent=None): super(CalculateForm, self).__init__(parent) self.ui = Ui_Form() self.ui.setupUi(self) then define the execution function： if __name__ == &#39;__main__&#39;: app = QApplication(sys.argv) calculator = CalculateForm() calculator.show() sys.exit(app.exec_()) After execution, you can see that the interface has been successfully displayed. The next step is to establish a signal slot mechanism. For example, when the button of the ui was originally defined, there is a button named add_url . We want to associate it with the function of add_url , just define it as follows (preferably in init ): self.ui.add_url.clicked.connect(self.add_url_func) # click function CRUD and Display The model defined in PyQt is QSqlTableModel, and the definition of table is listview. For example, define the method of initialize_model() : db = QtSql.QSqlDatabase.addDatabase(&#39;QSQLITE&#39;) db.setDatabaseName(&#39;test_ping.db&#39;) def initialize_model(model): model.setTable(&#39;url_ping&#39;) model.setEditStrategy(QtSql.QSqlTableModel.OnManualSubmit) model.select() model.setHeaderData(0, QtCore.Qt.Horizontal, u&quot;url&quot;) # url link To display, just connect the listview with the corresponding model: def show_view(self): model = QSqlTableModel() initialize_model(model) self.ui.url_list.setModel(model) # self.ui.url_list is listview self.ui.url_list.show() You can see the latest database, equivalent to refreshing, by calling the self.show_view() method after each addition, deletion, and change. How to execute a query For example, to find the content containing ‘test’, the code is as follows: query = QtSql.QSqlQuery() query.exec_(&quot;select * from test where value like &#39;%test%&#39;&quot;) And if you want to show with a better way,then redefine QSqlQueryModel sqlQueryModel.setQuery(&quot;select * from test where value like &#39;%test%&#39; &quot;) self.ui.url_list.setModel(sqlQueryModel) self.ui.url_list.show() Define the popup: Use the simplest of the following functions: def show_messagebox(self): msg = QMessageBox() msg.setText(u&#39;detect successfully&#39;) msg.setStandardButtons(QMessageBox.Ok) msg.exec_() Ui and execution thread separation How to set the ui and execute task thread separation so that the application won’t be non-reactive: There are many ways to do this. I chose the following method: from PyQt4.QtCore import QThread class PingThread(QThread): &quot;&quot;&quot; define PingThread &quot;&quot;&quot; def __init__(self, url): QThread.__init__(self) self._url = url def run(self): ping_url(self._url) self.emit(SIGNAL(&#39;ping url&#39;)) return &quot;&quot;&quot; Then call it in the main thread. &quot;&quot;&quot; self.pingThread = PingThread(target_url) # self.connect(self.pingThread, SIGNAL(&#39;ping url&#39;), self.show_messagebox) 可选 self.pingThread.start() ProgressBar The progress bar in PyQt is displayed using QProgressBar. When set in ui, there will be a minimum value (default is 0) and a maximum value (default is 100). Just set it when updating self.ui.click_progrress.setValue(30) # progresses to 30% # click_progress 是 ui 里对应的 ProgressBar Other Stuffs The ping calls the ping API that comes with the system. Tracert calls the tracert API in windows (the corresponding Linux command is traceroute) Telnet is to detect if the port is open. Directly calling the system command has two drawbacks: 1 Windows requires the user to manually open the configuration 2 telnet uses the cursor to flash to determine the port status with no return value, it is not convenient for program processing. So final decision is to use socket to connect: sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) result = sock.connect_ex((url_name, 80)) port_open = True if result == 0 else False PyQt comes with a lot of demos in site-packages, and it’s faster to see the code directly than the documentation. At the time of the study, I wrote a calculator demo that adds genuine. When the input number or the selected calculation symbol changes, the calculation result is automatically changed (well, eval()~ and the Python decorator is used. characteristic.">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2015/09/14/Use-PyQt-Develop-Desktop-Web-GUI/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Allianzcortex-Blog" href="http://localhost:4000/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="hzcortex">
  <meta name="twitter:title" content="Develop a desktop client with PyQT">
  <meta name="twitter:description" content="In this novel,I’ll demonstrate how to read the database and display it , with Python’s dynamic mechanism and Qt’s signal slot. 这篇文章对应的中文版 This is a program that can detect network connections. The ...">
  
    <meta name="twitter:creator" content="hzcortex">
  
  

  <script type="text/javascript">
  WebFontConfig = {
    google: { families: [ 'Bitter:400,700,400italic:latin' ] }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Allianzcortex-Blog</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/archives/">Archives</a>
      
        
        <a class="page-link" href="/projects/">Projects</a>
      
        
        <a class="page-link" href="/about/">About</a>
      
        
        <a class="page-link" href="/board/">board</a>
      
        
        <a class="page-link" href="/feed.xml">RSS</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">Develop a desktop client with PyQT</h1>
    
    <p class="post-meta"><time datetime="2015-09-14T16:46:30-03:00" itemprop="datePublished">Sep 14, 2015</time> • 
  
  

</p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>In this novel,I’ll demonstrate how to read the database and display it , with Python’s dynamic mechanism and Qt’s signal slot.</p>

<!-- more -->

<p><a href="/../translation/2015-09-14-Use-PyQt-Develop-Desktop-Web-GUI.html">这篇文章对应的中文版</a></p>

<hr />

<p>This is a program that can detect network connections. The screenshot of the interface is as follows</p>

<p><img src="/images/pyqt-example.png" alt="PyQt" /></p>

<p>There will be very few opportunities to write the client in the future(I mean many professional clients are mainly developed by C#/.net,although actually dropbox developed its’ client with PyQT)… So I won’t pursue the best practices. I just need to make a <strong>poke-marked GUI</strong> .⊙﹏⊙b</p>

<h4 id="ui-and-interface-corresponding">UI and interface corresponding</h4>

<p>PyQt itself is similar to Qt’s signal slot mechanism. When a button is clicked, a signal is sent and the processing mechanism of the signal needs to be defined.</p>

<p>The design interface is designed directly with the <strong>designer</strong>. Drag <code class="highlighter-rouge">button/listview/model</code> and customize the name.</p>

<p>After generating the .ui file, use <code class="highlighter-rouge">pyuic4 –x ping_ui.ui –o ping_ui.py</code> to see that the ping_ui.py file contains <code class="highlighter-rouge">class Ui_Form(object)</code>, which has various lengths/locations defined. It’s More convenient than handwriting</p>

<p>Then define a <code class="highlighter-rouge">pyqt_example2.py</code> which contains the following files:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">CalculateForm</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CalculateForm</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_Form</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code></pre></figure>

<p>then define the execution function：</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">calculator</span> <span class="o">=</span> <span class="n">CalculateForm</span><span class="p">()</span>
    <span class="n">calculator</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span></code></pre></figure>

<p>After execution, you can see that the interface has been successfully displayed.</p>

<p>The next step is to establish a signal slot mechanism. For example, when the button of the ui was originally defined, there is a button named <code class="highlighter-rouge">add_url</code> . We want to associate it with the function of <code class="highlighter-rouge">add_url</code> , just define it as follows (preferably in <strong>init</strong> ):</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">add_url</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_url_func</span><span class="p">)</span> <span class="c"># click function</span></code></pre></figure>

<h4 id="crud-and-display">CRUD and Display</h4>

<p>The model defined in PyQt is <code class="highlighter-rouge">QSqlTableModel</code>, and the definition of table is <code class="highlighter-rouge">listview</code>.
For example, define the method of initialize_model() :</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">db</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlDatabase</span><span class="o">.</span><span class="n">addDatabase</span><span class="p">(</span><span class="s">'QSQLITE'</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">setDatabaseName</span><span class="p">(</span><span class="s">'test_ping.db'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">initialize_model</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setTable</span><span class="p">(</span><span class="s">'url_ping'</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setEditStrategy</span><span class="p">(</span><span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlTableModel</span><span class="o">.</span><span class="n">OnManualSubmit</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setHeaderData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">,</span> <span class="s">u"url"</span><span class="p">)</span> <span class="c"># url link</span></code></pre></figure>

<p>To display, just connect the listview with the corresponding model:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">show_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">QSqlTableModel</span><span class="p">()</span>
    <span class="n">initialize_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">url_list</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="c"># self.ui.url_list is  listview
</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">url_list</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>

<p>You can see the latest database, equivalent to refreshing, by calling the self.show_view() method after each addition, deletion, and change.</p>

<h5 id="how-to-execute-a-query">How to execute a query</h5>

<p>For example, to find the content containing ‘test’, the code is as follows:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
<span class="n">query</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="s">"select * from test where value like '</span><span class="si">%</span><span class="s">test</span><span class="si">%</span><span class="s">'"</span><span class="p">)</span></code></pre></figure>

<p>And if you want to show with a better way,then redefine QSqlQueryModel</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sqlQueryModel</span><span class="o">.</span><span class="n">setQuery</span><span class="p">(</span><span class="s">"select * from test where value like '</span><span class="si">%</span><span class="s">test</span><span class="si">%</span><span class="s">' "</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">url_list</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">sqlQueryModel</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">url_list</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>

<p>Define the popup: Use the simplest of the following functions:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">show_messagebox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">()</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">u'detect successfully'</span><span class="p">)</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></code></pre></figure>

<h4 id="ui-and-execution-thread-separation">Ui and execution thread separation</h4>

<p>How to set the ui and execute task thread separation so that the application won’t be non-reactive:</p>

<p>There are many ways to do this. I chose the following method:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="kn">import</span> <span class="n">QThread</span>

<span class="k">class</span> <span class="nc">PingThread</span><span class="p">(</span><span class="n">QThread</span><span class="p">):</span>
    <span class="s">""" define PingThread """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="n">QThread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ping_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">'ping url'</span><span class="p">))</span>
        <span class="k">return</span>

<span class="s">""" Then call it in the main thread. """</span>

<span class="bp">self</span><span class="o">.</span><span class="n">pingThread</span> <span class="o">=</span> <span class="n">PingThread</span><span class="p">(</span><span class="n">target_url</span><span class="p">)</span>
<span class="c"># self.connect(self.pingThread, SIGNAL('ping url'), self.show_messagebox) 可选
</span>
<span class="bp">self</span><span class="o">.</span><span class="n">pingThread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></code></pre></figure>

<h4 id="progressbar">ProgressBar</h4>

<p>The progress bar in PyQt is displayed using QProgressBar. When set in ui, there will be a minimum value (default is 0) and a maximum value (default is 100).</p>

<p>Just set it when updating</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">click_progrress</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="c">#  progresses to 30%
</span>
<span class="c"># click_progress 是 ui 里对应的 ProgressBar</span></code></pre></figure>

<h4 id="other-stuffs">Other Stuffs</h4>

<p>The ping calls the ping API that comes with the system.</p>

<p>Tracert calls the tracert API in windows (the corresponding Linux command is traceroute)</p>

<p>Telnet is to detect if the port is open. Directly calling the system command has two drawbacks:</p>

<p>1 Windows requires the user to manually open the configuration</p>

<p>2 telnet uses the cursor to flash to determine the port status with no return value, it is not convenient for program processing.</p>

<p>So final decision is to use socket to connect:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">url_name</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
<span class="n">port_open</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">False</span></code></pre></figure>

<p>PyQt comes with a lot of demos in site-packages, and it’s faster to see the code directly than the documentation.
At the time of the study, I wrote a calculator demo that adds genuine. When the input number or the selected calculation symbol changes, the calculation result is automatically changed (well, eval()~ and the Python decorator is used. characteristic.</p>

  </div>

</article>

        
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'allianzcortex-me'; // required: replace example with your forum shortname
        // var disqus_developer = 1; // Comment out when the site is live
        var disqus_identifier = "/2015/09/14/Use-PyQt-Develop-Desktop-Web-GUI/";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



    </main>
    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

Pro Land
    </p>

  </div>

</footer>


  </body>

</html>
